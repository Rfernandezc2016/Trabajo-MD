---
title: "Memoria del trabajo"
author: "Adrián Rochas De la Casa, Yassin Khalifa Martino y Rocío Fernández Cebrián"
date: "5/10/2021"
output: bookdown::gitbook
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#  Introducción

Este conjunto de datos incluye descripciones de muestras hipotéticas basándose en carracterísticas de hongos de la familia Agaricus y Lepiota.

Para visualizar mejor nuestro análisis necesitamos cargar las siguientes librerías:
```{r librerias,echo=TRUE,warning=FALSE}
library(ggplot2)
```

# ¿ Objetivos (del negocio)?

Nuestro objetivo será identifcar cada especie como una especie comestible o una especie venenosa/de comestibilidad desconocida.

#  Datos 

Leemos los datos mediante el siguiente comando:
```{r introduccion datos,echo=TRUE}
datos.setas<-read.table("agaricus-lepiota.data",header=FALSE,sep=",")
```

Comprobamos que se han leído correctamente los datos mirando la dimensión de los datos.
```{r dimension,echo=TRUE}
dim(datos.setas)
```

Como ya hemos visto, disponemos de 8124 observaciones de setas de las cuales hemos recogido información sobre 23 características.

Realizamos una exploración básica de los datos para comprobar que tipo de datos disponemos.
```{r tipo de variables, echo=TRUE}
summary(datos.setas)
```
Luego son variables cualitativas y por tanto habrá que tratarlas como factores. Estas variables son:


 NOMBRE VARIABLE | DESCRIPCIÓN
 --------------- | ------------
  Letalidad      | venenosa (p) o comestible(e)
  Forma del sombrebro o píleo | campana (b), cónica (c), convexa (x), plana (f), nudosa (k) o hundida (s)
  Cutícula o superficie del sombrero | fibroso (f), con surcos (g), escamosa (y) o lisa (s)
  Color del sombrero | marrón (b), ante (b), canela (c), gris (g), verde (r), rosa (p), morado (u), rojo (e), blanco (w) o amarillo (y)
  Escamas | verdadero (t) o falso (f)
  Olor | almendra (a), anís (l), creosota (c), pescado (y), asqueroso (f), mohoso (m), ninguno (n), acre(p) o picante (s)
  Fijación de las láminas | adjunto (a), descentente (d), libre (f) o entallado (n)
  Espacio entre láminas | cerca (c), atestado (w) o distante (d)
  Tamaño de las láminas | ancho (b) o estrecho (n)
  Color de las láminas | negro (k), marrón (n), ante (b), chocolate (h), gris (g), verde (r), naranja (o), rosa (p), morado (u), rojo (e), blanco (w) o amarillo (y)
  Forma del tallo | agrandado (e) o afilado (t)
  Tallo-raíz | bulboso (b), club (c), copa (u), igual (e), rizomorfos (z), enraizado (r) o faltante (?)
  Superficie del tallo por encima del anillo | fibroso (f), escamoso (y), sedoso (k) o liso (s)
  Superficie del tallo por debajo del anillo | fibroso (f), escamoso (y), sedoso (k) o liso (s)
  Color del tallo por encima del anillo | marrón (n), ante (b), canela (c), gris (g), naranja (o), rosa (p), rojo (e), blanco (w) o amarillo (y)
  Color del tallo por debajo del anillo | marrón (n), ante (b), canela (c), gris (g), naranja (o), rosa (p), rojo (e), blanco (w) o amarillo (y)
  Tipo de volva | parcial (p) o universal (u)
  Color del volva | naranja (o), blanco (w) o amarillo (y)
  Número de anillos | ninguno (n), uno (o) o dos (t)
  Tipo de anillo | telaraña (c), evanescente (e), abocinado (f), grande (l), ninguno (n), colgante (p), revestimiento (s) o zona (z)
  Color de las esporas | negro (k), marrón (n), ante (b), chocolate (c), verde (r), naranja (o), morado (u), blanco (w) o amarillo (y)
  Población | abundante (a), agrupada (c), numerosa (n), dispersa (s), varias (v) o solitaria (y)
  Habitat | pastos (g), hojas (l), prados (m), caminos (p), urbano (u), desechos (w) o bosques (d)

Vamos a llamar a las variables como la caracteristica que ejemplifican.
```{r nombre de variables}
colnames(datos.setas)=c("Letalidad","Forma_S","Cuticula","Color_S","Escamas","Olor","Fijacion_L","Espacio_L","Tamaño_L","Color_L","Forma_T","Tallo_raiz","Superficie_T1","Superficie_T2","Color_T1","Color_T2","Tipo_V","Color_V","N_anillos","Tipo_anillo","Color_esporas","Poblacion","Habitat")
```

##  Particiones.

```{r particiones}
n_totales=dim(datos.setas)[1]
n_train=floor(n_totales*0.6) # el 60% de los datos los utilizamos para entrenar los modelos
n_test=floor(n_totales*0.2) # el 20% para test
n_validacion=n_totales-n_train-n_test

set.seed(34735)

indices_totales=seq(1:n_totales)
indices_train=sample(indices_totales,n_train)
indices_test=sample(indices_totales[-indices_train],n_test)
indices_validacion=indices_totales[-c(indices_train,indices_test)]


datos.setas_train=datos.setas[indices_train,]
datos.setas_test=datos.setas[indices_test,]
datos.setas_validacion=datos.setas[indices_validacion,]


```

#  Preprocesado de datos.

Para poder tranformar las variables en factor, lo haremos mediante **as.factor()** a todas las variables de los datos.
```{r factores, echo=FALSE}
#VARIABLE RESPUESTA
datos.setas_train$Letalidad=as.factor(datos.setas_train$Letalidad)
#VARIABLE 1
datos.setas_train$Forma_S=as.factor(datos.setas_train$Forma_S)
#VARIABLE 2
datos.setas_train$Cuticula=as.factor(datos.setas_train$Cuticula)
#VARIABLE 3
datos.setas_train$Color_S=as.factor(datos.setas_train$Color_S)
#VARIABLE 4
datos.setas_train$Escamas=as.factor(datos.setas_train$Escamas)
#VARIABLE 5
datos.setas_train$Olor=as.factor(datos.setas_train$Olor)
#VARIABLE 6
datos.setas_train$Fijacion_L=as.factor(datos.setas_train$Fijacion_L)
#VARIABLE 7
datos.setas_train$Espacio_L=as.factor(datos.setas_train$Espacio_L)
#VARIABLE 8
datos.setas_train$Tamaño_L=as.factor(datos.setas_train$Tamaño_L)
#VARIABLE 9
datos.setas_train$Color_L=as.factor(datos.setas_train$Color_L)
#VARIABLE 10
datos.setas_train$Forma_T=as.factor(datos.setas_train$Forma_T)
#VARIABLE 11
datos.setas_train$Tallo_raiz=as.factor(datos.setas_train$Tallo_raiz)
#VARIABLE 12
datos.setas_train$Superficie_T1=as.factor(datos.setas_train$Superficie_T1)
#VARIABLE 13
datos.setas_train$Superficie_T2=as.factor(datos.setas_train$Superficie_T2)
#VARIABLE 14
datos.setas_train$Color_T1=as.factor(datos.setas_train$Color_T1)
#VARIABLE 15
datos.setas_train$Color_T2=as.factor(datos.setas_train$Color_T2)
#VARIABLE 16
datos.setas_train$Tipo_V=as.factor(datos.setas_train$Tipo_V)
#VARIABLE 17
datos.setas_train$Color_V=as.factor(datos.setas_train$Color_V)
#VARIABLE 18
datos.setas_train$N_anillos=as.factor(datos.setas_train$N_anillos)
#VARIABLE 19
datos.setas_train$Tipo_anillo=as.factor(datos.setas_train$Tipo_anillo)
#VARIABLE 20
datos.setas_train$Color_esporas=as.factor(datos.setas_train$Color_esporas)
#VARIABLE 21
datos.setas_train$Poblacion=as.factor(datos.setas_train$Poblacion)
#VARIABLE 22
datos.setas_train$Habitat=as.factor(datos.setas_train$Habitat)
```

Ahora podemos ver mejor como son nuestros datos.
```{r resumen datos,echo=TRUE}
summary(datos.setas_train)
```
##  EDA. Exploratory Data Analysis.

### Letalidad:
La variable **letalidad** tiene dos niveles distintos, venenosa (p) o comestible (e), la frecuencia relativa correspondiente a nuestros datos es:
```{r proporcion, echo=TRUE}
#Tabla:
table(datos.setas_train$Letalidad)
#Tabla de frecuencias:
prop.table(table(datos.setas_train$Letalidad))
#Gráfico
barplot(table(datos.setas_train$Letalidad),main="Letalidad",ylab="Número de setas",col=c("blue","magenta"),names.arg=c("Comestible","Venenosa"))
```

Podríamos transformar esta variable para que fuera interpretada como binaria numérica (0-comestible, 1-venenosa)


Una de las variables, **Tipo_v** tipo de volva, con dos niveles distintos, parcial (p) y universal (u), podríamos eliminarla de nuestros datos pues todo la frecuencia solo está en uno de los niveles, luego no aporta información alguna para determinar si es venenosa o comestible.
```{r eliminar variable}
datos.setas_train=datos.setas_train[,-17]
```

##  Correlación entre las variables.

Vamos a comprobar si existe alguna correlación entre las distintas variables. 
```{r correlacion,echo=TRUE}
#Tabla de frecuencias letalidad~habitat
table(datos.setas_train$Letalidad,datos.setas_train$Habitat)
#Gráfico letalidad~habitat
barplot(table(datos.setas_train$Letalidad,datos.setas_train$Habitat),main="Letalidad",xlab="Habitat",ylab="Número de setas",names.arg=c("pastos", "hojas", "prados", "caminos", "urbano", "desechos", "bosques"),col=c("blue","magenta"))
#legend(x = "topright", legend = c("Comestible","Venenosa"), fill = c("blue", "magenta"))


#Tabla de frecuencias letalidad~poblacion
table(datos.setas_train$Letalidad,datos.setas_train$Poblacion)
#Gráfico letalidad~poblacion
barplot(table(datos.setas_train$Letalidad,datos.setas_train$Poblacion),main="Letalidad",xlab="Poblacion",ylab="Número de setas",names.arg=c("abundante", "agrupada", "numerosa", "dispersa", "varias", "solitaria"),col=c("blue","magenta"))
#legend(x = "topright", legend = c("Comestible","Venenosa"), fill = c("blue", "magenta"))
```

##  Transformación de variables

##  Imputacion de datos (datos faltantes)

#  Modelado

##  k-NN
##  Regresión Logística
##  Clustering
##  Arboles de Decisión
##  Bosques Aleatorios
##  Support Vector Machines
##  Redes Neuronales

#  Evaluación


#  Visualización y Presentación de Resultados

#  Puesta en producción
OJO!!! al inicio del estudio, necesitamos reservar parte de la bases de datos para esta etapa. Nos referiremos a esa parte como "los datos guardados en un cajón". Normalmente esta etapa se hace "el último día de clase".

#  Actualización del modelo...
Vuelta a empezar.