<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8 Actualización del modelo… | MEMORIA.knit</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="8 Actualización del modelo… | MEMORIA.knit" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8 Actualización del modelo… | MEMORIA.knit" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="evaluación.html"/>

<script src="libs/header-attrs-2.11.3/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="memoria.html"><a href="memoria.html"><i class="fa fa-check"></i><b>1</b> MEMORIA</a></li>
<li class="chapter" data-level="2" data-path="introducción.html"><a href="introducción.html"><i class="fa fa-check"></i><b>2</b> Introducción</a></li>
<li class="chapter" data-level="3" data-path="objetivos.html"><a href="objetivos.html"><i class="fa fa-check"></i><b>3</b> Objetivos</a></li>
<li class="chapter" data-level="4" data-path="datos.html"><a href="datos.html"><i class="fa fa-check"></i><b>4</b> Datos</a></li>
<li class="chapter" data-level="5" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html"><i class="fa fa-check"></i><b>5</b> Preprocesado de datos.</a>
<ul>
<li class="chapter" data-level="5.1" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#particiones."><i class="fa fa-check"></i><b>5.1</b> Particiones.</a></li>
<li class="chapter" data-level="5.2" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#eda.-exploratory-data-analysis."><i class="fa fa-check"></i><b>5.2</b> EDA. Exploratory Data Analysis.</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#letalidad"><i class="fa fa-check"></i><b>5.2.1</b> Letalidad:</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#correlación-entre-las-variables."><i class="fa fa-check"></i><b>5.3</b> Correlación entre las variables.</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#forma-del-sombrero-forma_s"><i class="fa fa-check"></i><b>5.3.1</b> Forma del sombrero (Forma_S)</a></li>
<li class="chapter" data-level="5.3.2" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#cutícula"><i class="fa fa-check"></i><b>5.3.2</b> Cutícula</a></li>
<li class="chapter" data-level="5.3.3" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#color-del-sombrero-color_s"><i class="fa fa-check"></i><b>5.3.3</b> Color del sombrero (Color_S)</a></li>
<li class="chapter" data-level="5.3.4" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#escamas"><i class="fa fa-check"></i><b>5.3.4</b> Escamas</a></li>
<li class="chapter" data-level="5.3.5" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#olor"><i class="fa fa-check"></i><b>5.3.5</b> Olor</a></li>
<li class="chapter" data-level="5.3.6" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#fijación-de-las-láminas-fijacion_l"><i class="fa fa-check"></i><b>5.3.6</b> Fijación de las láminas (Fijacion_L)</a></li>
<li class="chapter" data-level="5.3.7" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#espacio-entre-láminas-espacio_l"><i class="fa fa-check"></i><b>5.3.7</b> Espacio entre láminas (Espacio_L)</a></li>
<li class="chapter" data-level="5.3.8" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#tamaño-de-las-láminas-tamaño_l"><i class="fa fa-check"></i><b>5.3.8</b> Tamaño de las láminas (Tamaño_L)</a></li>
<li class="chapter" data-level="5.3.9" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#color-de-las-láminas-color_l"><i class="fa fa-check"></i><b>5.3.9</b> Color de las láminas (Color_L)</a></li>
<li class="chapter" data-level="5.3.10" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#forma-del-tallo-forma_t"><i class="fa fa-check"></i><b>5.3.10</b> Forma del tallo (Forma_T)</a></li>
<li class="chapter" data-level="5.3.11" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#tallo-raíz-tallo_raiz"><i class="fa fa-check"></i><b>5.3.11</b> Tallo-Raíz (Tallo_raiz)</a></li>
<li class="chapter" data-level="5.3.12" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#superficie-del-tallo-por-encima-del-anillo-superficie_t1"><i class="fa fa-check"></i><b>5.3.12</b> Superficie del tallo por encima del anillo (Superficie_T1)</a></li>
<li class="chapter" data-level="5.3.13" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#superficie-del-tallo-por-debajo-del-anillo-superficie_t2"><i class="fa fa-check"></i><b>5.3.13</b> Superficie del tallo por debajo del anillo (Superficie_T2)</a></li>
<li class="chapter" data-level="5.3.14" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#color-del-tallo-por-encima-del-anillo-color_t1"><i class="fa fa-check"></i><b>5.3.14</b> Color del tallo por encima del anillo (Color_T1)</a></li>
<li class="chapter" data-level="5.3.15" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#color-del-tallo-por-debajo-del-anillo-color_t2"><i class="fa fa-check"></i><b>5.3.15</b> Color del tallo por debajo del anillo (Color_T2)</a></li>
<li class="chapter" data-level="5.3.16" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#color-del-volva-color_v"><i class="fa fa-check"></i><b>5.3.16</b> Color del volva (Color_V)</a></li>
<li class="chapter" data-level="5.3.17" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#número-de-anillos-n_anillos"><i class="fa fa-check"></i><b>5.3.17</b> Número de anillos (N_anillos)</a></li>
<li class="chapter" data-level="5.3.18" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#tipo-de-anillo-tipo_anillo"><i class="fa fa-check"></i><b>5.3.18</b> Tipo de anillo (Tipo_anillo)</a></li>
<li class="chapter" data-level="5.3.19" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#color-de-las-esporas"><i class="fa fa-check"></i><b>5.3.19</b> Color de las esporas</a></li>
<li class="chapter" data-level="5.3.20" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#población"><i class="fa fa-check"></i><b>5.3.20</b> Población</a></li>
<li class="chapter" data-level="5.3.21" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#habitat"><i class="fa fa-check"></i><b>5.3.21</b> Habitat</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#componentes-principales"><i class="fa fa-check"></i><b>5.4</b> Componentes principales</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#proceso-previo"><i class="fa fa-check"></i><b>5.4.1</b> Proceso previo</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#transformación-de-variables"><i class="fa fa-check"></i><b>5.5</b> Transformación de variables</a></li>
<li class="chapter" data-level="5.6" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#imputación-de-datos-datos-faltantes"><i class="fa fa-check"></i><b>5.6</b> Imputación de datos (datos faltantes)</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="modelado.html"><a href="modelado.html"><i class="fa fa-check"></i><b>6</b> Modelado</a>
<ul>
<li class="chapter" data-level="6.1" data-path="modelado.html"><a href="modelado.html#análisis-clúster"><i class="fa fa-check"></i><b>6.1</b> Análisis Clúster</a></li>
<li class="chapter" data-level="6.2" data-path="modelado.html"><a href="modelado.html#k-nn"><i class="fa fa-check"></i><b>6.2</b> k-NN</a></li>
<li class="chapter" data-level="6.3" data-path="modelado.html"><a href="modelado.html#arboles-de-decisión"><i class="fa fa-check"></i><b>6.3</b> Arboles de Decisión</a></li>
<li class="chapter" data-level="6.4" data-path="modelado.html"><a href="modelado.html#bosques-aleatorios"><i class="fa fa-check"></i><b>6.4</b> Bosques Aleatorios</a></li>
<li class="chapter" data-level="6.5" data-path="modelado.html"><a href="modelado.html#support-vector-machines"><i class="fa fa-check"></i><b>6.5</b> Support Vector Machines</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="evaluación.html"><a href="evaluación.html"><i class="fa fa-check"></i><b>7</b> Evaluación</a></li>
<li class="chapter" data-level="8" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html"><i class="fa fa-check"></i><b>8</b> Actualización del modelo…</a>
<ul>
<li class="chapter" data-level="8.1" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html#datos-sin-variable-olor"><i class="fa fa-check"></i><b>8.1</b> Datos sin variable <strong>Olor</strong></a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html#análisis-cluster"><i class="fa fa-check"></i><b>8.1.1</b> Análisis Cluster</a></li>
<li class="chapter" data-level="8.1.2" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html#k-nn-1"><i class="fa fa-check"></i><b>8.1.2</b> k-NN</a></li>
<li class="chapter" data-level="8.1.3" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html#arboles-de-decisión-1"><i class="fa fa-check"></i><b>8.1.3</b> Arboles de Decisión</a></li>
<li class="chapter" data-level="8.1.4" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html#bosques-aleatorios-1"><i class="fa fa-check"></i><b>8.1.4</b> Bosques Aleatorios</a></li>
<li class="chapter" data-level="8.1.5" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html#support-vector-machines-1"><i class="fa fa-check"></i><b>8.1.5</b> Support Vector Machines</a></li>
<li class="chapter" data-level="8.1.6" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html#evaluación-1"><i class="fa fa-check"></i><b>8.1.6</b> Evaluación</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html#datos-con-variable-olorn"><i class="fa fa-check"></i><b>8.2</b> Datos con variable <strong>Olor=n</strong></a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html#análisis-cluster-1"><i class="fa fa-check"></i><b>8.2.1</b> Análisis Cluster</a></li>
<li class="chapter" data-level="8.2.2" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html#k-nn-2"><i class="fa fa-check"></i><b>8.2.2</b> k-NN</a></li>
<li class="chapter" data-level="8.2.3" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html#arboles-de-decisión-2"><i class="fa fa-check"></i><b>8.2.3</b> Arboles de Decisión</a></li>
<li class="chapter" data-level="8.2.4" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html#bosques-aleatorios-2"><i class="fa fa-check"></i><b>8.2.4</b> Bosques Aleatorios</a></li>
<li class="chapter" data-level="8.2.5" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html#support-vector-machines-2"><i class="fa fa-check"></i><b>8.2.5</b> Support Vector Machines</a></li>
<li class="chapter" data-level="8.2.6" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html#evaluación-2"><i class="fa fa-check"></i><b>8.2.6</b> Evaluación</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html#evaluación-de-los-tres-análisis"><i class="fa fa-check"></i><b>8.3</b> Evaluación de los tres análisis</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="actualización-del-modelo" class="section level1" number="8">
<h1><span class="header-section-number">8</span> Actualización del modelo…</h1>
<p>Tras haber analizado los resultados que obtenemos al aplicar los modelos a nuestros datos, nos planteamos ciertas actualizaciones no a los modelos sino a los datos.</p>
<div id="datos-sin-variable-olor" class="section level2" number="8.1">
<h2><span class="header-section-number">8.1</span> Datos sin variable <strong>Olor</strong></h2>
<p>Cuando realizamos el análisis descriptivo, ya observamos que la variable <strong>Olor</strong> es bastante determinante a la hora de clasificar las setas según su toxicidad, pero ello nos planteamos realizar todo el análisis quitando esta variable de los datos. Las variables asociadas al olor se sitúan entre las columnas 23-31.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="actualización-del-modelo.html#cb168-1" aria-hidden="true" tabindex="-1"></a>setas_train.sin.olor<span class="ot">=</span>setas[indices_train,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">23</span><span class="sc">:</span><span class="dv">31</span>)]</span>
<span id="cb168-2"><a href="actualización-del-modelo.html#cb168-2" aria-hidden="true" tabindex="-1"></a>setas_test.sin.olor<span class="ot">=</span>setas[indices_test,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">23</span><span class="sc">:</span><span class="dv">31</span>)]</span>
<span id="cb168-3"><a href="actualización-del-modelo.html#cb168-3" aria-hidden="true" tabindex="-1"></a>setas_validacion.sin.olor<span class="ot">=</span>setas[indices_validacion,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">23</span><span class="sc">:</span><span class="dv">31</span>)]</span></code></pre></div>
<p>Recalculamos la medida de similitud</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="actualización-del-modelo.html#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Distancia Dice</span></span>
<span id="cb169-2"><a href="actualización-del-modelo.html#cb169-2" aria-hidden="true" tabindex="-1"></a>distancia_dice.sin.olor<span class="ot">=</span><span class="fu">distance</span>(setas_train.sin.olor[,<span class="dv">2</span><span class="sc">:</span><span class="fu">dim</span>(setas_train.sin.olor)[<span class="dv">2</span>]],<span class="at">method=</span><span class="st">&quot;dice&quot;</span>)</span></code></pre></div>
<p>Para seleccionar el número de medoides adecuado, hacemos cross-validation pero como sabemos que quizás el número de medoides adecuado está cuando son más de 10, probamos directamente. También usamos la distancia de todas las observaciones hasta el número de medoides que estamos probando. Nos quedaremos con aquella que tenga mayor proporción acumulada pero sin sacrificar información sobre los datos.</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="actualización-del-modelo.html#cb170-1" aria-hidden="true" tabindex="-1"></a>i<span class="ot">=</span><span class="dv">10</span></span>
<span id="cb170-2"><a href="actualización-del-modelo.html#cb170-2" aria-hidden="true" tabindex="-1"></a>datos<span class="ot">=</span><span class="fu">matrix</span>(<span class="at">nrow=</span><span class="dv">25</span>,<span class="at">ncol=</span><span class="dv">3</span>)</span>
<span id="cb170-3"><a href="actualización-del-modelo.html#cb170-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(datos)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;0&quot;</span>,<span class="st">&quot;1&quot;</span>,<span class="st">&quot;Proporción de la varianza acumulada explicada&quot;</span>)</span>
<span id="cb170-4"><a href="actualización-del-modelo.html#cb170-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(datos)<span class="ot">=</span><span class="fu">seq</span>(<span class="dv">10</span>,<span class="dv">250</span>,<span class="dv">10</span>)</span>
<span id="cb170-5"><a href="actualización-del-modelo.html#cb170-5" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span>(i<span class="sc">&lt;=</span><span class="dv">250</span>){</span>
<span id="cb170-6"><a href="actualización-del-modelo.html#cb170-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Cálculo de los medoides: </span></span>
<span id="cb170-7"><a href="actualización-del-modelo.html#cb170-7" aria-hidden="true" tabindex="-1"></a>  k<span class="ot">=</span><span class="fu">fastkmed</span>(distancia_dice.sin.olor,<span class="at">ncluster=</span>i)</span>
<span id="cb170-8"><a href="actualización-del-modelo.html#cb170-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Proporción de los medoides:</span></span>
<span id="cb170-9"><a href="actualización-del-modelo.html#cb170-9" aria-hidden="true" tabindex="-1"></a>  proporcion<span class="ot">=</span><span class="fu">c</span>(<span class="fu">sum</span>(setas_train.sin.olor[k<span class="sc">$</span>medoid,<span class="dv">1</span>]<span class="sc">==</span><span class="dv">0</span>),<span class="fu">sum</span>(setas_train.sin.olor[k<span class="sc">$</span>medoid,<span class="dv">1</span>]<span class="sc">==</span><span class="dv">1</span>))</span>
<span id="cb170-10"><a href="actualización-del-modelo.html#cb170-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb170-11"><a href="actualización-del-modelo.html#cb170-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb170-12"><a href="actualización-del-modelo.html#cb170-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Análsiis de componentes principales</span></span>
<span id="cb170-13"><a href="actualización-del-modelo.html#cb170-13" aria-hidden="true" tabindex="-1"></a>  pca.traink<span class="ot">=</span><span class="fu">prcomp</span>(distancia_dice.sin.olor[,k<span class="sc">$</span>medoid])</span>
<span id="cb170-14"><a href="actualización-del-modelo.html#cb170-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Varianza explicada</span></span>
<span id="cb170-15"><a href="actualización-del-modelo.html#cb170-15" aria-hidden="true" tabindex="-1"></a>  varianza.explicada<span class="ot">=</span>pca.traink<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="fu">sum</span>(pca.traink<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb170-16"><a href="actualización-del-modelo.html#cb170-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Proporción de la varianza acumulada explicada por las dos primeras componentes principales</span></span>
<span id="cb170-17"><a href="actualización-del-modelo.html#cb170-17" aria-hidden="true" tabindex="-1"></a>  varianza.explicada.acumulada<span class="ot">=</span>varianza.explicada[<span class="dv">1</span>]<span class="sc">+</span>varianza.explicada[<span class="dv">2</span>]</span>
<span id="cb170-18"><a href="actualización-del-modelo.html#cb170-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb170-19"><a href="actualización-del-modelo.html#cb170-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb170-20"><a href="actualización-del-modelo.html#cb170-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Almacenamos los datos</span></span>
<span id="cb170-21"><a href="actualización-del-modelo.html#cb170-21" aria-hidden="true" tabindex="-1"></a>  datos[i<span class="sc">/</span><span class="dv">10</span>,]<span class="ot">=</span><span class="fu">c</span>(proporcion,varianza.explicada.acumulada)</span>
<span id="cb170-22"><a href="actualización-del-modelo.html#cb170-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb170-23"><a href="actualización-del-modelo.html#cb170-23" aria-hidden="true" tabindex="-1"></a>i<span class="ot">=</span>i<span class="sc">+</span><span class="dv">10</span></span>
<span id="cb170-24"><a href="actualización-del-modelo.html#cb170-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb170-25"><a href="actualización-del-modelo.html#cb170-25" aria-hidden="true" tabindex="-1"></a>datos</span></code></pre></div>
<pre><code>##       0  1 Proporción de la varianza acumulada explicada
## 10    7  3                                     0.8367392
## 20   14  6                                     0.8201140
## 30   21  9                                     0.7522698
## 40   30 10                                     0.7679105
## 50   37 13                                     0.7738366
## 60   45 15                                     0.7820109
## 70   54 16                                     0.7717128
## 80   60 20                                     0.7657024
## 90   69 21                                     0.7761067
## 100  77 23                                     0.7595936
## 110  81 29                                     0.7458742
## 120  90 30                                     0.7513594
## 130  99 31                                     0.7497715
## 140 106 34                                     0.7502580
## 150 113 37                                     0.7465473
## 160 124 36                                     0.7529692
## 170 132 38                                     0.7570503
## 180 139 41                                     0.7608919
## 190 145 45                                     0.7551029
## 200 156 44                                     0.7594286
## 210 164 46                                     0.7616204
## 220 174 46                                     0.7680298
## 230 181 49                                     0.7701902
## 240 190 50                                     0.7748958
## 250 199 51                                     0.7770764</code></pre>
<p>Los resultados son bastantes parecidos al análisis en el que incluimos la variable <strong>Olor</strong>, por tanto, nos seguimos quedando con la distancia de todas las observaciones a los 60 medoides, la segunda proporción acumulada más alta, para tener más información.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="actualización-del-modelo.html#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Cálculo de los medoides: </span></span>
<span id="cb172-2"><a href="actualización-del-modelo.html#cb172-2" aria-hidden="true" tabindex="-1"></a>k60<span class="ot">=</span><span class="fu">fastkmed</span>(distancia_dice.sin.olor,<span class="at">ncluster=</span><span class="dv">60</span>)</span>
<span id="cb172-3"><a href="actualización-del-modelo.html#cb172-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(setas_train.sin.olor<span class="sc">$</span>Letalidad[k60<span class="sc">$</span>medoid])</span></code></pre></div>
<pre><code>## 
##  0  1 
## 45 15</code></pre>
<p>De los 60 medoides que hemos calculado, necesitamos 45 para explicar las setas no venenosas mientras que solo 15 para las venenosas.</p>
<p>Con estos medoides realizamos el análisis de componente principales.</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="actualización-del-modelo.html#cb174-1" aria-hidden="true" tabindex="-1"></a>distancia_medoides.sin.olor<span class="ot">=</span>distancia_dice.sin.olor[,k60<span class="sc">$</span>medoid]</span>
<span id="cb174-2"><a href="actualización-del-modelo.html#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Análisis Componentes principales:</span></span>
<span id="cb174-3"><a href="actualización-del-modelo.html#cb174-3" aria-hidden="true" tabindex="-1"></a>pca<span class="fl">.60</span><span class="ot">=</span><span class="fu">prcomp</span>(distancia_medoides.sin.olor)</span>
<span id="cb174-4"><a href="actualización-del-modelo.html#cb174-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pca<span class="fl">.60</span>)</span></code></pre></div>
<pre><code>## Importance of components:
##                           PC1    PC2     PC3     PC4     PC5     PC6     PC7
## Standard deviation     0.9644 0.4746 0.34590 0.21447 0.18715 0.16947 0.14006
## Proportion of Variance 0.6295 0.1525 0.08098 0.03113 0.02371 0.01944 0.01328
## Cumulative Proportion  0.6295 0.7820 0.86299 0.89412 0.91783 0.93727 0.95054
##                            PC8    PC9    PC10    PC11    PC12    PC13    PC14
## Standard deviation     0.11644 0.1024 0.09372 0.08355 0.08171 0.06885 0.06459
## Proportion of Variance 0.00918 0.0071 0.00595 0.00472 0.00452 0.00321 0.00282
## Cumulative Proportion  0.95972 0.9668 0.97276 0.97749 0.98201 0.98522 0.98804
##                           PC15    PC16    PC17    PC18    PC19    PC20    PC21
## Standard deviation     0.05914 0.05541 0.04681 0.04479 0.04205 0.03383 0.03124
## Proportion of Variance 0.00237 0.00208 0.00148 0.00136 0.00120 0.00077 0.00066
## Cumulative Proportion  0.99041 0.99249 0.99397 0.99533 0.99652 0.99730 0.99796
##                           PC22    PC23    PC24    PC25    PC26    PC27    PC28
## Standard deviation     0.02613 0.02272 0.02211 0.01996 0.01698 0.01349 0.01268
## Proportion of Variance 0.00046 0.00035 0.00033 0.00027 0.00020 0.00012 0.00011
## Cumulative Proportion  0.99842 0.99877 0.99910 0.99937 0.99957 0.99969 0.99980
##                           PC29     PC30     PC31     PC32      PC33      PC34
## Standard deviation     0.01123 0.009934 0.007781 0.003838 8.463e-05 1.324e-05
## Proportion of Variance 0.00009 0.000070 0.000040 0.000010 0.000e+00 0.000e+00
## Cumulative Proportion  0.99988 0.999950 0.999990 1.000000 1.000e+00 1.000e+00
##                             PC35      PC36     PC37      PC38      PC39
## Standard deviation     3.771e-15 1.907e-15 1.61e-15 1.286e-15 9.802e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.00e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.00e+00 1.000e+00 1.000e+00
##                             PC40      PC41      PC42      PC43     PC44
## Standard deviation     9.488e-16 6.754e-16 4.767e-16 3.955e-16 3.17e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.00e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.00e+00
##                             PC45      PC46      PC47      PC48      PC49
## Standard deviation     3.146e-16 2.674e-16 2.503e-16 1.995e-16 1.384e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00
##                             PC50      PC51      PC52    PC53    PC54    PC55
## Standard deviation     1.216e-16 1.109e-16 1.014e-16 6.4e-17 6.4e-17 6.4e-17
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.0e+00 0.0e+00 0.0e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.0e+00 1.0e+00 1.0e+00
##                           PC56    PC57      PC58      PC59     PC60
## Standard deviation     6.4e-17 6.4e-17 6.065e-17 4.028e-17 3.17e-17
## Proportion of Variance 0.0e+00 0.0e+00 0.000e+00 0.000e+00 0.00e+00
## Cumulative Proportion  1.0e+00 1.0e+00 1.000e+00 1.000e+00 1.00e+00</code></pre>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="actualización-del-modelo.html#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pca<span class="fl">.60</span><span class="sc">$</span>x,<span class="at">col=</span>setas_train.sin.olor<span class="sc">$</span>Letalidad<span class="sc">+</span><span class="dv">1</span>,<span class="at">pch=</span><span class="dv">19</span>)</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/pca%20sin%20olor-1.png" width="672" /></p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="actualización-del-modelo.html#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Gráfico </span></span>
<span id="cb177-2"><a href="actualización-del-modelo.html#cb177-2" aria-hidden="true" tabindex="-1"></a>comestible<span class="ot">=</span><span class="fu">which</span>(setas_train.sin.olor[,<span class="dv">1</span>]<span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb177-3"><a href="actualización-del-modelo.html#cb177-3" aria-hidden="true" tabindex="-1"></a>no.comestibles<span class="ot">=</span><span class="fu">which</span>(setas_train.sin.olor[,<span class="dv">1</span>]<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb177-4"><a href="actualización-del-modelo.html#cb177-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-5"><a href="actualización-del-modelo.html#cb177-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb177-6"><a href="actualización-del-modelo.html#cb177-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pca<span class="fl">.60</span><span class="sc">$</span>x,<span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb177-7"><a href="actualización-del-modelo.html#cb177-7" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(pca<span class="fl">.60</span><span class="sc">$</span>x[comestible,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>],<span class="at">col=</span><span class="dv">1</span>,<span class="at">pch=</span><span class="dv">19</span>)</span>
<span id="cb177-8"><a href="actualización-del-modelo.html#cb177-8" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(pca<span class="fl">.60</span><span class="sc">$</span>x[no.comestibles,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>],<span class="at">col=</span><span class="dv">2</span>,<span class="at">pch=</span><span class="dv">19</span>)</span>
<span id="cb177-9"><a href="actualización-del-modelo.html#cb177-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pca<span class="fl">.60</span><span class="sc">$</span>x,<span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb177-10"><a href="actualización-del-modelo.html#cb177-10" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(pca<span class="fl">.60</span><span class="sc">$</span>x[no.comestibles,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>],<span class="at">col=</span><span class="dv">2</span>,<span class="at">pch=</span><span class="dv">19</span>)</span>
<span id="cb177-11"><a href="actualización-del-modelo.html#cb177-11" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(pca<span class="fl">.60</span><span class="sc">$</span>x[comestible,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>],<span class="at">col=</span><span class="dv">1</span>,<span class="at">pch=</span><span class="dv">19</span>)</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/pca%20sin%20olor-2.png" width="672" /></p>
<p>Observamos una gran maraña de puntos, parecida a la que obtenemos haciendo el mismo análisis incluyendo la variable <strong>Olor</strong>, donde solo podemos ver dos grupos bien diferenciados del resto.</p>
<p>Transformamos los datos, ahora serán la distancia de cada seta a los 60 medoides que hemos calculado, esto permite utilizar la distancia euclídea en los algoritmos posteriores.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="actualización-del-modelo.html#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Datos train:</span></span>
<span id="cb178-2"><a href="actualización-del-modelo.html#cb178-2" aria-hidden="true" tabindex="-1"></a>setas60_train.sin.olor<span class="ot">=</span>distancia_dice.sin.olor[,k60<span class="sc">$</span>medoid]</span>
<span id="cb178-3"><a href="actualización-del-modelo.html#cb178-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(setas60_train.sin.olor)<span class="ot">=</span><span class="fu">rownames</span>(setas_train.sin.olor[k60<span class="sc">$</span>medoid,])</span>
<span id="cb178-4"><a href="actualización-del-modelo.html#cb178-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(setas60_train.sin.olor)<span class="ot">=</span><span class="fu">rownames</span>(setas_train.sin.olor)</span>
<span id="cb178-5"><a href="actualización-del-modelo.html#cb178-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-6"><a href="actualización-del-modelo.html#cb178-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Datos test:</span></span>
<span id="cb178-7"><a href="actualización-del-modelo.html#cb178-7" aria-hidden="true" tabindex="-1"></a>medoides_setas_test.sin.olor<span class="ot">=</span><span class="fu">rbind</span>(setas_train.sin.olor[k60<span class="sc">$</span>medoid,],setas_test.sin.olor)</span>
<span id="cb178-8"><a href="actualización-del-modelo.html#cb178-8" aria-hidden="true" tabindex="-1"></a>distancia_medoides_test.sin.olor<span class="ot">=</span><span class="fu">distance</span>(medoides_setas_test.sin.olor[,<span class="dv">2</span><span class="sc">:</span><span class="fu">dim</span>(setas_test.sin.olor)[<span class="dv">2</span>]],<span class="at">method=</span><span class="st">&quot;dice&quot;</span>)</span>
<span id="cb178-9"><a href="actualización-del-modelo.html#cb178-9" aria-hidden="true" tabindex="-1"></a>setas60_test.sin.olor<span class="ot">=</span>distancia_medoides_test.sin.olor[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">60</span>),<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">60</span>)]</span>
<span id="cb178-10"><a href="actualización-del-modelo.html#cb178-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(setas60_test.sin.olor)<span class="ot">=</span><span class="fu">colnames</span>(setas60_train.sin.olor)</span>
<span id="cb178-11"><a href="actualización-del-modelo.html#cb178-11" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(setas60_test.sin.olor)<span class="ot">=</span><span class="fu">rownames</span>(setas_test.sin.olor)</span>
<span id="cb178-12"><a href="actualización-del-modelo.html#cb178-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-13"><a href="actualización-del-modelo.html#cb178-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Datos validacion:</span></span>
<span id="cb178-14"><a href="actualización-del-modelo.html#cb178-14" aria-hidden="true" tabindex="-1"></a>medoides_setas_validacion.sin.olor<span class="ot">=</span><span class="fu">rbind</span>(setas_train.sin.olor[k60<span class="sc">$</span>medoid,],setas_validacion.sin.olor)</span>
<span id="cb178-15"><a href="actualización-del-modelo.html#cb178-15" aria-hidden="true" tabindex="-1"></a>distancia_medoides_validacion.sin.olor<span class="ot">=</span><span class="fu">distance</span>(medoides_setas_validacion.sin.olor[,<span class="dv">2</span><span class="sc">:</span><span class="fu">dim</span>(setas_validacion.sin.olor)[<span class="dv">2</span>]],<span class="at">method=</span><span class="st">&quot;dice&quot;</span>)</span>
<span id="cb178-16"><a href="actualización-del-modelo.html#cb178-16" aria-hidden="true" tabindex="-1"></a>setas60_validacion.sin.olor<span class="ot">=</span>distancia_medoides_validacion.sin.olor[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">60</span>),<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">60</span>)]</span>
<span id="cb178-17"><a href="actualización-del-modelo.html#cb178-17" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(setas60_validacion.sin.olor)<span class="ot">=</span><span class="fu">colnames</span>(setas60_train.sin.olor)</span>
<span id="cb178-18"><a href="actualización-del-modelo.html#cb178-18" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(setas60_validacion.sin.olor)<span class="ot">=</span><span class="fu">rownames</span>(setas_validacion.sin.olor)</span></code></pre></div>
<div id="análisis-cluster" class="section level3" number="8.1.1">
<h3><span class="header-section-number">8.1.1</span> Análisis Cluster</h3>
<p>Aplicamos el análisis clúster a nuestros datos con el objetivo de tener grupos de setas que contengas solo setas venenosas o comestibles, pero primero vemos por cross-validation el número adecuado de clusters a aplicar.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="actualización-del-modelo.html#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Números de clusters</span></span>
<span id="cb179-2"><a href="actualización-del-modelo.html#cb179-2" aria-hidden="true" tabindex="-1"></a>SSW <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;numeric&quot;</span>, <span class="at">length =</span> <span class="dv">15</span>)</span>
<span id="cb179-3"><a href="actualización-del-modelo.html#cb179-3" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="fu">dim</span>(<span class="fu">prcomp</span>(setas60_validacion.sin.olor)<span class="sc">$</span>x)[<span class="dv">1</span>]</span>
<span id="cb179-4"><a href="actualización-del-modelo.html#cb179-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Variabilidad de todos los datos, es decir, todos los datos como un único cluster</span></span>
<span id="cb179-5"><a href="actualización-del-modelo.html#cb179-5" aria-hidden="true" tabindex="-1"></a>SSW[<span class="dv">1</span>] <span class="ot">&lt;-</span> (n <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">apply</span>(<span class="fu">prcomp</span>(setas60_validacion.sin.olor)<span class="sc">$</span>x,<span class="dv">2</span>,var)) </span>
<span id="cb179-6"><a href="actualización-del-modelo.html#cb179-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-7"><a href="actualización-del-modelo.html#cb179-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Variabilidad de cada modelo, desde 2 clusters hasta 15 clusters</span></span>
<span id="cb179-8"><a href="actualización-del-modelo.html#cb179-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">15</span>) SSW[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">kmeans</span>(<span class="fu">prcomp</span>(setas60_validacion.sin.olor)<span class="sc">$</span>x,<span class="at">centers=</span>i,<span class="at">nstart=</span><span class="dv">25</span>)<span class="sc">$</span>withinss)</span>
<span id="cb179-9"><a href="actualización-del-modelo.html#cb179-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-10"><a href="actualización-del-modelo.html#cb179-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Dibujamos un gráfico con el resultado</span></span>
<span id="cb179-11"><a href="actualización-del-modelo.html#cb179-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>, SSW, <span class="at">type=</span><span class="st">&quot;b&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;Número de clusters&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Suma de cuadrados de los grupos&quot;</span>,<span class="at">pch=</span><span class="dv">19</span>, <span class="at">col=</span><span class="st">&quot;steelblue4&quot;</span>)</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/cluster%20sin%20olor-1.png" width="672" /></p>
<p>En el gráfico podemos observar que a partir de aplicar 5 clusters a nuestros datos la suma de los cuadrados se reduce en menor medida, por ello realizamos el análisis con ese número de clusters.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="actualización-del-modelo.html#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Análisis cluster</span></span>
<span id="cb180-2"><a href="actualización-del-modelo.html#cb180-2" aria-hidden="true" tabindex="-1"></a>clusters.datos.sin.olor<span class="ot">=</span><span class="fu">kmeans</span>(<span class="fu">prcomp</span>(setas60_train.sin.olor)<span class="sc">$</span>x,<span class="at">centers=</span><span class="dv">5</span>,<span class="at">nstart=</span><span class="dv">25</span>)</span>
<span id="cb180-3"><a href="actualización-del-modelo.html#cb180-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(clusters.datos.sin.olor<span class="sc">$</span>cluster,setas_train.sin.olor<span class="sc">$</span>Letalidad)</span></code></pre></div>
<pre><code>##    
##        0    1
##   1  885   23
##   2  532  450
##   3    0  768
##   4 1080   41
##   5   25 1070</code></pre>
<p>Podemos ver que un clúster identificar correctamente a las setas venenosas mientras que el resto de clusters las setas están un poco más repartidas.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="actualización-del-modelo.html#cb182-1" aria-hidden="true" tabindex="-1"></a>pca<span class="ot">=</span><span class="fu">prcomp</span>(setas60_train.sin.olor)<span class="sc">$</span>x</span>
<span id="cb182-2"><a href="actualización-del-modelo.html#cb182-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-3"><a href="actualización-del-modelo.html#cb182-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Gráfico de los cluster</span></span>
<span id="cb182-4"><a href="actualización-del-modelo.html#cb182-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">prcomp</span>(setas60_train.sin.olor)<span class="sc">$</span>x,<span class="at">main=</span><span class="st">&quot;Clusters&quot;</span>,<span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb182-5"><a href="actualización-del-modelo.html#cb182-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(setas60_train.sin.olor)[<span class="dv">1</span>]){</span>
<span id="cb182-6"><a href="actualización-del-modelo.html#cb182-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(pca[i,<span class="dv">1</span>],pca[i,<span class="dv">2</span>],<span class="at">pch=</span><span class="dv">19</span>,<span class="at">col=</span>clusters.datos.sin.olor<span class="sc">$</span>cluster[i]<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb182-7"><a href="actualización-del-modelo.html#cb182-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb182-8"><a href="actualización-del-modelo.html#cb182-8" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,   </span>
<span id="cb182-9"><a href="actualización-del-modelo.html#cb182-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">inset =</span> <span class="fl">0.01</span>, </span>
<span id="cb182-10"><a href="actualización-del-modelo.html#cb182-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb182-11"><a href="actualización-del-modelo.html#cb182-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">fil =</span> <span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">6</span>))</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/grafico%20cluster%205%20sin%20olor-1.png" width="672" /></p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="actualización-del-modelo.html#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Gráfico por tipo de setas:</span></span>
<span id="cb183-2"><a href="actualización-del-modelo.html#cb183-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb183-3"><a href="actualización-del-modelo.html#cb183-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">prcomp</span>(setas60_train.sin.olor)<span class="sc">$</span>x,<span class="at">main=</span><span class="st">&quot;Clusters: setas comestibles&quot;</span>,<span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb183-4"><a href="actualización-del-modelo.html#cb183-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(setas60_train.sin.olor)[<span class="dv">1</span>]){</span>
<span id="cb183-5"><a href="actualización-del-modelo.html#cb183-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(setas_train.sin.olor[i,<span class="dv">1</span>]<span class="sc">==</span><span class="dv">0</span>){</span>
<span id="cb183-6"><a href="actualización-del-modelo.html#cb183-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(pca[i,<span class="dv">1</span>],pca[i,<span class="dv">2</span>],<span class="at">pch=</span><span class="dv">19</span>,<span class="at">col=</span>clusters.datos.sin.olor<span class="sc">$</span>cluster[i]<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb183-7"><a href="actualización-del-modelo.html#cb183-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb183-8"><a href="actualización-del-modelo.html#cb183-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb183-9"><a href="actualización-del-modelo.html#cb183-9" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,   </span>
<span id="cb183-10"><a href="actualización-del-modelo.html#cb183-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">inset =</span> <span class="fl">0.01</span>, </span>
<span id="cb183-11"><a href="actualización-del-modelo.html#cb183-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb183-12"><a href="actualización-del-modelo.html#cb183-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">fil =</span> <span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">6</span>))</span>
<span id="cb183-13"><a href="actualización-del-modelo.html#cb183-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">prcomp</span>(setas60_train.sin.olor)<span class="sc">$</span>x,<span class="at">main=</span><span class="st">&quot;Clusters: setas venenosas&quot;</span>,<span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb183-14"><a href="actualización-del-modelo.html#cb183-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(setas60_train.sin.olor)[<span class="dv">1</span>]){</span>
<span id="cb183-15"><a href="actualización-del-modelo.html#cb183-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(setas_train.sin.olor[i,<span class="dv">1</span>]<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb183-16"><a href="actualización-del-modelo.html#cb183-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(pca[i,<span class="dv">1</span>],pca[i,<span class="dv">2</span>],<span class="at">pch=</span><span class="dv">19</span>,<span class="at">col=</span>clusters.datos.sin.olor<span class="sc">$</span>cluster[i]<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb183-17"><a href="actualización-del-modelo.html#cb183-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb183-18"><a href="actualización-del-modelo.html#cb183-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb183-19"><a href="actualización-del-modelo.html#cb183-19" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,   </span>
<span id="cb183-20"><a href="actualización-del-modelo.html#cb183-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">inset =</span> <span class="fl">0.01</span>, </span>
<span id="cb183-21"><a href="actualización-del-modelo.html#cb183-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb183-22"><a href="actualización-del-modelo.html#cb183-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">fil =</span> <span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">6</span>))</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/grafico%20cluster%205%20sin%20olor-2.png" width="672" /></p>
<p>En estos gráficos podemos ver lo que hemos comentado antes, tenemos un clúster que clasifica bastante bien los tipos de setas pero el resto no clasifica tan bien como, pues las setas están mezcladas, luego habría que estudiarlos para ver como diferenciar las venenosas de las comestibles.</p>
<p>Vamos a realizar otro análisis clúster pero aumentando el número de clusters con la intención de con un número mayor de clusters se clasifiquen mejor las setas.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="actualización-del-modelo.html#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Análisis cluster</span></span>
<span id="cb184-2"><a href="actualización-del-modelo.html#cb184-2" aria-hidden="true" tabindex="-1"></a>clusters.datos.train.sin.olor<span class="ot">=</span><span class="fu">kmeans</span>(<span class="fu">prcomp</span>(setas60_train.sin.olor)<span class="sc">$</span>x,<span class="at">centers=</span><span class="dv">8</span>,<span class="at">nstart=</span><span class="dv">25</span>)</span>
<span id="cb184-3"><a href="actualización-del-modelo.html#cb184-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(clusters.datos.train.sin.olor<span class="sc">$</span>cluster,setas_train.sin.olor<span class="sc">$</span>Letalidad)</span></code></pre></div>
<pre><code>##    
##       0   1
##   1   0 600
##   2 613  51
##   3 509 424
##   4 514   5
##   5 394  23
##   6 467   0
##   7   0 768
##   8  25 481</code></pre>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="actualización-del-modelo.html#cb186-1" aria-hidden="true" tabindex="-1"></a>pca<span class="ot">=</span><span class="fu">prcomp</span>(setas60_train.sin.olor)<span class="sc">$</span>x</span>
<span id="cb186-2"><a href="actualización-del-modelo.html#cb186-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-3"><a href="actualización-del-modelo.html#cb186-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Gráfico de los cluster</span></span>
<span id="cb186-4"><a href="actualización-del-modelo.html#cb186-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">prcomp</span>(setas60_train.sin.olor)<span class="sc">$</span>x,<span class="at">main=</span><span class="st">&quot;Clusters&quot;</span>,<span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb186-5"><a href="actualización-del-modelo.html#cb186-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(setas60_train.sin.olor)[<span class="dv">1</span>]){</span>
<span id="cb186-6"><a href="actualización-del-modelo.html#cb186-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(pca[i,<span class="dv">1</span>],pca[i,<span class="dv">2</span>],<span class="at">pch=</span><span class="dv">19</span>,<span class="at">col=</span>clusters.datos.train.sin.olor<span class="sc">$</span>cluster[i]<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb186-7"><a href="actualización-del-modelo.html#cb186-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb186-8"><a href="actualización-del-modelo.html#cb186-8" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,   </span>
<span id="cb186-9"><a href="actualización-del-modelo.html#cb186-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">inset =</span> <span class="fl">0.01</span>, </span>
<span id="cb186-10"><a href="actualización-del-modelo.html#cb186-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>),</span>
<span id="cb186-11"><a href="actualización-del-modelo.html#cb186-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">fil =</span> <span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">9</span>))</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/grafico%20cluster%208%20sin%20olor-1.png" width="672" /></p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="actualización-del-modelo.html#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Gráfico por tipo de setas:</span></span>
<span id="cb187-2"><a href="actualización-del-modelo.html#cb187-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb187-3"><a href="actualización-del-modelo.html#cb187-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">prcomp</span>(setas60_train.sin.olor)<span class="sc">$</span>x,<span class="at">main=</span><span class="st">&quot;Clusters: setas comestibles&quot;</span>,<span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb187-4"><a href="actualización-del-modelo.html#cb187-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(setas60_train.sin.olor)[<span class="dv">1</span>]){</span>
<span id="cb187-5"><a href="actualización-del-modelo.html#cb187-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(setas_train.sin.olor[i,<span class="dv">1</span>]<span class="sc">==</span><span class="dv">0</span>){</span>
<span id="cb187-6"><a href="actualización-del-modelo.html#cb187-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(pca[i,<span class="dv">1</span>],pca[i,<span class="dv">2</span>],<span class="at">pch=</span><span class="dv">19</span>,<span class="at">col=</span>clusters.datos.train.sin.olor<span class="sc">$</span>cluster[i]<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb187-7"><a href="actualización-del-modelo.html#cb187-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb187-8"><a href="actualización-del-modelo.html#cb187-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb187-9"><a href="actualización-del-modelo.html#cb187-9" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,   </span>
<span id="cb187-10"><a href="actualización-del-modelo.html#cb187-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">inset =</span> <span class="fl">0.01</span>, </span>
<span id="cb187-11"><a href="actualización-del-modelo.html#cb187-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>),</span>
<span id="cb187-12"><a href="actualización-del-modelo.html#cb187-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">fil =</span> <span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">9</span>))</span>
<span id="cb187-13"><a href="actualización-del-modelo.html#cb187-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">prcomp</span>(setas60_train.sin.olor)<span class="sc">$</span>x,<span class="at">main=</span><span class="st">&quot;Clusters: setas venenosas&quot;</span>,<span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb187-14"><a href="actualización-del-modelo.html#cb187-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(setas60_train.sin.olor)[<span class="dv">1</span>]){</span>
<span id="cb187-15"><a href="actualización-del-modelo.html#cb187-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(setas_train.sin.olor[i,<span class="dv">1</span>]<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb187-16"><a href="actualización-del-modelo.html#cb187-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(pca[i,<span class="dv">1</span>],pca[i,<span class="dv">2</span>],<span class="at">pch=</span><span class="dv">19</span>,<span class="at">col=</span>clusters.datos.train.sin.olor<span class="sc">$</span>cluster[i]<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb187-17"><a href="actualización-del-modelo.html#cb187-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb187-18"><a href="actualización-del-modelo.html#cb187-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb187-19"><a href="actualización-del-modelo.html#cb187-19" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,   </span>
<span id="cb187-20"><a href="actualización-del-modelo.html#cb187-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">inset =</span> <span class="fl">0.01</span>, </span>
<span id="cb187-21"><a href="actualización-del-modelo.html#cb187-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>),</span>
<span id="cb187-22"><a href="actualización-del-modelo.html#cb187-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">fil =</span> <span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">9</span>))</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/grafico%20cluster%208%20sin%20olor-2.png" width="672" /></p>
<p>Vemos que tras realizar el análisis clúster con 8 grupos, notamos un empeoramiento de la predicción a pesar que ahora tenemos tres cluster bien diferenciados, por lo que nos quedamos con el análsis clúster con <span class="math inline">\(k=5\)</span>.</p>
</div>
<div id="k-nn-1" class="section level3" number="8.1.2">
<h3><span class="header-section-number">8.1.2</span> k-NN</h3>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="actualización-del-modelo.html#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Buscamos los vecinos más cercanos</span></span>
<span id="cb188-2"><a href="actualización-del-modelo.html#cb188-2" aria-hidden="true" tabindex="-1"></a>prediccion_knn.sin.olor<span class="ot">=</span><span class="fu">knn</span>(setas60_train.sin.olor,setas60_test.sin.olor,<span class="at">cl=</span>setas_train.sin.olor<span class="sc">$</span>Letalidad,<span class="at">k=</span><span class="dv">1</span>)</span>
<span id="cb188-3"><a href="actualización-del-modelo.html#cb188-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(prediccion_knn.sin.olor,setas_test.sin.olor<span class="sc">$</span>Letalidad)</span></code></pre></div>
<pre><code>##                        
## prediccion_knn.sin.olor   0   1
##                       0 838   2
##                       1   0 784</code></pre>
<p>La predicción con el 1-vecino más próximo, es bastante buena, lo podemos ver a simple vista en la tabla. Pero vamos a realizar un análisis con distintas medidas de precisión.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="actualización-del-modelo.html#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exactitud/Error</span></span>
<span id="cb190-2"><a href="actualización-del-modelo.html#cb190-2" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">=</span> <span class="fu">sum</span>(prediccion_knn.sin.olor <span class="sc">==</span> setas_test.sin.olor<span class="sc">$</span>Letalidad)<span class="sc">/</span><span class="fu">nrow</span>(setas_test.sin.olor)</span>
<span id="cb190-3"><a href="actualización-del-modelo.html#cb190-3" aria-hidden="true" tabindex="-1"></a>error <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span>accuracy</span>
<span id="cb190-4"><a href="actualización-del-modelo.html#cb190-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-5"><a href="actualización-del-modelo.html#cb190-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas VENENOSAS, sensitivity o recall</span></span>
<span id="cb190-6"><a href="actualización-del-modelo.html#cb190-6" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="ot">=</span> <span class="fu">sum</span>((prediccion_knn.sin.olor <span class="sc">==</span> setas_test.sin.olor<span class="sc">$</span>Letalidad) <span class="sc">&amp;</span> (setas_test.sin.olor<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.sin.olor<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb190-7"><a href="actualización-del-modelo.html#cb190-7" aria-hidden="true" tabindex="-1"></a>recall <span class="ot">=</span> sensitivity</span>
<span id="cb190-8"><a href="actualización-del-modelo.html#cb190-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-9"><a href="actualización-del-modelo.html#cb190-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas COMESTIBLES</span></span>
<span id="cb190-10"><a href="actualización-del-modelo.html#cb190-10" aria-hidden="true" tabindex="-1"></a>specificity <span class="ot">=</span>  <span class="fu">sum</span>(prediccion_knn.sin.olor <span class="sc">==</span> setas_test.sin.olor<span class="sc">$</span>Letalidad <span class="sc">&amp;</span> setas_test.sin.olor<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.sin.olor<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb190-11"><a href="actualización-del-modelo.html#cb190-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-12"><a href="actualización-del-modelo.html#cb190-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es VENENOSAS</span></span>
<span id="cb190-13"><a href="actualización-del-modelo.html#cb190-13" aria-hidden="true" tabindex="-1"></a>precision <span class="ot">=</span> <span class="fu">sum</span>( (prediccion_knn.sin.olor<span class="sc">==</span> setas_test.sin.olor<span class="sc">$</span>Letalidad) <span class="sc">&amp;</span> (prediccion_knn.sin.olor <span class="sc">==</span> <span class="dv">1</span>))<span class="sc">/</span> <span class="fu">sum</span>(prediccion_knn.sin.olor <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb190-14"><a href="actualización-del-modelo.html#cb190-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-15"><a href="actualización-del-modelo.html#cb190-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es COMESTIBLE</span></span>
<span id="cb190-16"><a href="actualización-del-modelo.html#cb190-16" aria-hidden="true" tabindex="-1"></a>npv <span class="ot">=</span> <span class="fu">sum</span>(prediccion_knn.sin.olor <span class="sc">==</span> setas_test.sin.olor<span class="sc">$</span>Letalidad <span class="sc">&amp;</span> prediccion_knn.sin.olor <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(prediccion_knn.sin.olor <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb190-17"><a href="actualización-del-modelo.html#cb190-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-18"><a href="actualización-del-modelo.html#cb190-18" aria-hidden="true" tabindex="-1"></a><span class="co"># F1_score</span></span>
<span id="cb190-19"><a href="actualización-del-modelo.html#cb190-19" aria-hidden="true" tabindex="-1"></a>f1score <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>precision<span class="sc">*</span>recall <span class="sc">/</span>(precision<span class="sc">+</span>recall)</span>
<span id="cb190-20"><a href="actualización-del-modelo.html#cb190-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-21"><a href="actualización-del-modelo.html#cb190-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla de medidas de precisión</span></span>
<span id="cb190-22"><a href="actualización-del-modelo.html#cb190-22" aria-hidden="true" tabindex="-1"></a>medidas.knn.sin.olor<span class="ot">=</span><span class="fu">c</span>(<span class="at">accuracy =</span> accuracy, <span class="at">error =</span> error, <span class="at">sensitivity =</span> sensitivity, <span class="at">specificity =</span> specificity, <span class="at">precision =</span> precision, <span class="at">npv =</span> npv, <span class="at">f1=</span>f1score)</span>
<span id="cb190-23"><a href="actualización-del-modelo.html#cb190-23" aria-hidden="true" tabindex="-1"></a>medidas.knn.sin.olor</span></code></pre></div>
<pre><code>##    accuracy       error sensitivity specificity   precision         npv 
## 0.998768473 0.001231527 0.997455471 1.000000000 1.000000000 0.997619048 
##          f1 
## 0.998726115</code></pre>
<p>Si usamos el 1 vecino más cercano, podemos ver en sus medidas de precisión que el ajuste es como decíamos, es decir, predice la toxicidad de las setas con un grado de acierto muy alto pero predice dos setas como comestibles que realmente son venenosas, lo que supondría un problema a pesar que solo comete un error del 0.1%,</p>
<p>Pero vamos a probar a calcular todas estas medidas con un número distinto de vecinos más cercano, por si acaso disminuyese ese pequeño error.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="actualización-del-modelo.html#cb192-1" aria-hidden="true" tabindex="-1"></a>k<span class="ot">=</span>(<span class="fu">dim</span>(setas60_train.sin.olor)[<span class="dv">1</span>]<span class="sc">^</span>(<span class="dv">4</span><span class="sc">/</span>(<span class="dv">4</span><span class="sc">+</span><span class="fu">dim</span>(setas60_train.sin.olor)[<span class="dv">2</span>])))<span class="sc">*</span><span class="dv">10</span></span>
<span id="cb192-2"><a href="actualización-del-modelo.html#cb192-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-3"><a href="actualización-del-modelo.html#cb192-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Matriz de las medidas de precisión:</span></span>
<span id="cb192-4"><a href="actualización-del-modelo.html#cb192-4" aria-hidden="true" tabindex="-1"></a>medidas_presicision<span class="ot">=</span><span class="fu">matrix</span>(<span class="at">nrow=</span><span class="fu">round</span>(k),<span class="at">ncol=</span><span class="dv">7</span>)</span>
<span id="cb192-5"><a href="actualización-del-modelo.html#cb192-5" aria-hidden="true" tabindex="-1"></a>nombres_medidas<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;accuracy&quot;</span>, <span class="st">&quot;error&quot;</span>, <span class="st">&quot;sensitivity&quot;</span>, <span class="st">&quot;specificity&quot;</span>, <span class="st">&quot;precision&quot;</span>, <span class="st">&quot;npv&quot;</span>, <span class="st">&quot;f1score&quot;</span>)</span>
<span id="cb192-6"><a href="actualización-del-modelo.html#cb192-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(medidas_presicision)<span class="ot">=</span>nombres_medidas</span>
<span id="cb192-7"><a href="actualización-del-modelo.html#cb192-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(medidas_presicision)<span class="ot">=</span><span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">round</span>(k),<span class="dv">1</span>)</span>
<span id="cb192-8"><a href="actualización-del-modelo.html#cb192-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">round</span>(k)){</span>
<span id="cb192-9"><a href="actualización-del-modelo.html#cb192-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb192-10"><a href="actualización-del-modelo.html#cb192-10" aria-hidden="true" tabindex="-1"></a>  prediccion_knn<span class="ot">=</span><span class="fu">knn</span>(setas60_train.sin.olor,setas60_test.sin.olor,<span class="at">cl=</span>setas_train.sin.olor<span class="sc">$</span>Letalidad,<span class="at">k=</span>i)</span>
<span id="cb192-11"><a href="actualización-del-modelo.html#cb192-11" aria-hidden="true" tabindex="-1"></a>  medidas_presicision[i,<span class="dv">1</span>] <span class="ot">=</span> <span class="fu">sum</span>(prediccion_knn <span class="sc">==</span> setas_test.sin.olor<span class="sc">$</span>Letalidad)<span class="sc">/</span><span class="fu">nrow</span>(setas_test.sin.olor)</span>
<span id="cb192-12"><a href="actualización-del-modelo.html#cb192-12" aria-hidden="true" tabindex="-1"></a>  medidas_presicision[i,<span class="dv">2</span>] <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span>medidas_presicision[i,<span class="dv">1</span>]</span>
<span id="cb192-13"><a href="actualización-del-modelo.html#cb192-13" aria-hidden="true" tabindex="-1"></a>  medidas_presicision[i,<span class="dv">3</span>] <span class="ot">=</span> <span class="fu">sum</span>((prediccion_knn <span class="sc">==</span> setas_test.sin.olor<span class="sc">$</span>Letalidad) <span class="sc">&amp;</span> (setas_test.sin.olor<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">/</span><span class="fu">sum</span>(setas_test<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb192-14"><a href="actualización-del-modelo.html#cb192-14" aria-hidden="true" tabindex="-1"></a>  medidas_presicision[i,<span class="dv">4</span>] <span class="ot">=</span>  <span class="fu">sum</span>(prediccion_knn <span class="sc">==</span> setas_test.sin.olor<span class="sc">$</span>Letalidad <span class="sc">&amp;</span> setas_test.sin.olor<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(setas_test<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb192-15"><a href="actualización-del-modelo.html#cb192-15" aria-hidden="true" tabindex="-1"></a>  medidas_presicision[i,<span class="dv">5</span>] <span class="ot">=</span> <span class="fu">sum</span>( (prediccion_knn<span class="sc">==</span> setas_test.sin.olor<span class="sc">$</span>Letalidad) <span class="sc">&amp;</span> (prediccion_knn <span class="sc">==</span> <span class="dv">1</span>))<span class="sc">/</span> <span class="fu">sum</span>(prediccion_knn <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb192-16"><a href="actualización-del-modelo.html#cb192-16" aria-hidden="true" tabindex="-1"></a>  medidas_presicision[i,<span class="dv">6</span>] <span class="ot">=</span> <span class="fu">sum</span>(prediccion_knn <span class="sc">==</span> setas_test.sin.olor<span class="sc">$</span>Letalidad <span class="sc">&amp;</span> prediccion_knn <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(prediccion_knn <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb192-17"><a href="actualización-del-modelo.html#cb192-17" aria-hidden="true" tabindex="-1"></a>  medidas_presicision[i,<span class="dv">7</span>] <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>medidas_presicision[i,<span class="dv">5</span>]<span class="sc">*</span>medidas_presicision[i,<span class="dv">3</span>] <span class="sc">/</span>(medidas_presicision[i,<span class="dv">5</span>]<span class="sc">+</span>medidas_presicision[i,<span class="dv">3</span>])</span>
<span id="cb192-18"><a href="actualización-del-modelo.html#cb192-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb192-19"><a href="actualización-del-modelo.html#cb192-19" aria-hidden="true" tabindex="-1"></a>medidas_presicision</span></code></pre></div>
<pre><code>##     accuracy       error sensitivity specificity precision       npv   f1score
## 1  0.9987685 0.001231527   0.9974555   1.0000000 1.0000000 0.9976190 0.9987261
## 2  0.9969212 0.003078818   0.9961832   0.9976134 0.9974522 0.9964243 0.9968173
## 3  0.9956897 0.004310345   0.9961832   0.9952267 0.9949174 0.9964158 0.9955499
## 4  0.9969212 0.003078818   1.0000000   0.9940334 0.9936789 1.0000000 0.9968294
## 5  0.9956897 0.004310345   0.9987277   0.9928401 0.9924147 0.9987995 0.9955612
## 6  0.9950739 0.004926108   0.9987277   0.9916468 0.9911616 0.9987981 0.9949303
## 7  0.9956897 0.004310345   1.0000000   0.9916468 0.9911728 1.0000000 0.9955668
## 8  0.9956897 0.004310345   1.0000000   0.9916468 0.9911728 1.0000000 0.9955668
## 9  0.9956897 0.004310345   1.0000000   0.9916468 0.9911728 1.0000000 0.9955668
## 10 0.9944581 0.005541872   0.9987277   0.9904535 0.9899117 0.9987966 0.9943002
## 11 0.9938424 0.006157635   0.9987277   0.9892601 0.9886650 0.9987952 0.9936709
## 12 0.9932266 0.006773399   0.9974555   0.9892601 0.9886507 0.9975933 0.9930336
## 13 0.9932266 0.006773399   0.9974555   0.9892601 0.9886507 0.9975933 0.9930336
## 14 0.9938424 0.006157635   0.9961832   0.9916468 0.9911392 0.9964029 0.9936548
## 15 0.9938424 0.006157635   0.9961832   0.9916468 0.9911392 0.9964029 0.9936548
## 16 0.9926108 0.007389163   0.9961832   0.9892601 0.9886364 0.9963942 0.9923954
## 17 0.9907635 0.009236453   0.9923664   0.9892601 0.9885932 0.9928144 0.9904762</code></pre>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="actualización-del-modelo.html#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Grafico de las medidas de precisión</span></span>
<span id="cb194-2"><a href="actualización-del-modelo.html#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">round</span>(k)),medidas_presicision[,<span class="dv">1</span>],<span class="at">main=</span><span class="st">&quot;Medidas de precision&quot;</span>,<span class="at">type=</span><span class="st">&quot;n&quot;</span>,<span class="at">xlab=</span><span class="st">&quot;Número de k vecinos&quot;</span>,<span class="at">ylab=</span><span class="st">&quot;&quot;</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="fu">round</span>(k)<span class="sc">+</span><span class="dv">2</span>))</span>
<span id="cb194-3"><a href="actualización-del-modelo.html#cb194-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) {</span>
<span id="cb194-4"><a href="actualización-del-modelo.html#cb194-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(<span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">round</span>(k)),medidas_presicision[,i],<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">col=</span>i<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb194-5"><a href="actualización-del-modelo.html#cb194-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">round</span>(k)),medidas_presicision[,i],<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">col=</span>i<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb194-6"><a href="actualización-del-modelo.html#cb194-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb194-7"><a href="actualización-del-modelo.html#cb194-7" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,   </span>
<span id="cb194-8"><a href="actualización-del-modelo.html#cb194-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">inset =</span> <span class="fl">0.01</span>, </span>
<span id="cb194-9"><a href="actualización-del-modelo.html#cb194-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Ac&quot;</span>,<span class="st">&quot;Er&quot;</span>, <span class="st">&quot;Se&quot;</span>,<span class="st">&quot;Sp&quot;</span>,<span class="st">&quot;Pr&quot;</span>,<span class="st">&quot;NPV&quot;</span>,<span class="st">&quot;F1&quot;</span>),</span>
<span id="cb194-10"><a href="actualización-del-modelo.html#cb194-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">fil =</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="fu">round</span>(k)<span class="sc">+</span><span class="dv">1</span>))</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/knn%20cross-validation%20sin%20olor-1.png" width="672" /></p>
<p>Observamos que al ir aumentando el número de k-vecinos el error va aumentando pero sigue siendo muy pequeño, el mayor error cometido con el número de k-vecinos probado es de 0,9%, bastante despreciable como para descartar este modelo por ello, es más pequeño que el error cometido cuando incluimos la variable <strong>Olor</strong>.</p>
</div>
<div id="arboles-de-decisión-1" class="section level3" number="8.1.3">
<h3><span class="header-section-number">8.1.3</span> Arboles de Decisión</h3>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="actualización-del-modelo.html#cb195-1" aria-hidden="true" tabindex="-1"></a>setas60_train.respuesta.sin.olor<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">cbind</span>(setas_train.sin.olor[,<span class="dv">1</span>],setas60_train.sin.olor))</span>
<span id="cb195-2"><a href="actualización-del-modelo.html#cb195-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(setas60_train.respuesta.sin.olor)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;Letalidad&quot;</span>,<span class="fu">colnames</span>(setas60_train.sin.olor))</span>
<span id="cb195-3"><a href="actualización-del-modelo.html#cb195-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-4"><a href="actualización-del-modelo.html#cb195-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Árbol de decisión:</span></span>
<span id="cb195-5"><a href="actualización-del-modelo.html#cb195-5" aria-hidden="true" tabindex="-1"></a>arbol.sin.olor<span class="ot">=</span><span class="fu">rpart</span>(<span class="fu">as.factor</span>(setas60_train.respuesta.sin.olor<span class="sc">$</span>Letalidad)<span class="sc">~</span>., <span class="at">data=</span>setas60_train.respuesta.sin.olor,<span class="at">method=</span><span class="st">&quot;class&quot;</span>)</span>
<span id="cb195-6"><a href="actualización-del-modelo.html#cb195-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(arbol.sin.olor)</span></code></pre></div>
<pre><code>## Call:
## rpart(formula = as.factor(setas60_train.respuesta.sin.olor$Letalidad) ~ 
##     ., data = setas60_train.respuesta.sin.olor, method = &quot;class&quot;)
##   n= 4874 
## 
##            CP nsplit  rel error    xerror        xstd
## 1  0.72023810      0 1.00000000 1.0000000 0.014832389
## 2  0.03698980      1 0.27976190 0.2797619 0.010143391
## 3  0.02423469      3 0.20578231 0.2074830 0.008909722
## 4  0.01955782      4 0.18154762 0.1840986 0.008445089
## 5  0.01743197      5 0.16198980 0.1738946 0.008229857
## 6  0.01700680      6 0.14455782 0.1619898 0.007968024
## 7  0.01318027      7 0.12755102 0.1352041 0.007330361
## 8  0.01275510      8 0.11437075 0.1271259 0.007122805
## 9  0.01062925      9 0.10161565 0.1126701 0.006730483
## 10 0.01000000     10 0.09098639 0.1033163 0.006460415
## 
## Variable importance
##  246   88 5513  421 7546 1090 6649 7370 4895 2676 1376 6137 2966 1338 3375 2816 
##   16   16   14   13   12   12    3    2    1    1    1    1    1    1    1    1 
## 3294 2696  617 3150 2656 2391 3078 
##    1    1    1    1    1    1    1 
## 
## Node number 1: 4874 observations,    complexity param=0.7202381
##   predicted class=0  expected loss=0.4825605  P(node) =1
##     class counts:  2522  2352
##    probabilities: 0.517 0.483 
##   left son=2 (2994 obs) right son=3 (1880 obs)
##   Primary splits:
##       246  &lt; 0.5894737  to the left,  improve=1340.4800, (0 missing)
##       88   &lt; 0.5894737  to the left,  improve=1330.1000, (0 missing)
##       421  &lt; 0.5894737  to the left,  improve=1143.0300, (0 missing)
##       7546 &lt; 0.5361345  to the right, improve=1041.9290, (0 missing)
##       1090 &lt; 0.5615616  to the left,  improve= 956.7019, (0 missing)
##   Surrogate splits:
##       88   &lt; 0.5894737  to the left,  agree=0.995, adj=0.988, (0 split)
##       5513 &lt; 0.5492063  to the left,  agree=0.939, adj=0.842, (0 split)
##       421  &lt; 0.5894737  to the left,  agree=0.932, adj=0.823, (0 split)
##       1090 &lt; 0.5615616  to the left,  agree=0.905, adj=0.755, (0 split)
##       7546 &lt; 0.5941176  to the right, agree=0.884, adj=0.700, (0 split)
## 
## Node number 2: 2994 observations,    complexity param=0.0369898
##   predicted class=0  expected loss=0.1887108  P(node) =0.6142799
##     class counts:  2429   565
##    probabilities: 0.811 0.189 
##   left son=4 (2518 obs) right son=5 (476 obs)
##   Primary splits:
##       6649 &lt; 0.4781513  to the right, improve=180.6841, (0 missing)
##       1376 &lt; 0.2859477  to the right, improve=161.8533, (0 missing)
##       7370 &lt; 0.402852   to the right, improve=138.4766, (0 missing)
##       5513 &lt; 0.2327327  to the right, improve=137.8909, (0 missing)
##       7546 &lt; 0.5147059  to the right, improve=107.7395, (0 missing)
##   Surrogate splits:
##       7370 &lt; 0.4330357  to the right, agree=0.919, adj=0.489, (0 split)
##       7546 &lt; 0.5147059  to the right, agree=0.868, adj=0.170, (0 split)
##       6137 &lt; 0.3133929  to the right, agree=0.867, adj=0.162, (0 split)
##       2308 &lt; 0.1547619  to the right, agree=0.851, adj=0.061, (0 split)
##       2367 &lt; 0.1547619  to the right, agree=0.850, adj=0.055, (0 split)
## 
## Node number 3: 1880 observations,    complexity param=0.0170068
##   predicted class=1  expected loss=0.04946809  P(node) =0.3857201
##     class counts:    93  1787
##    probabilities: 0.049 0.951 
##   left son=6 (46 obs) right son=7 (1834 obs)
##   Primary splits:
##       7546 &lt; 0.7321429  to the right, improve=73.91652, (0 missing)
##       617  &lt; 0.40625    to the left,  improve=70.08341, (0 missing)
##       4031 &lt; 0.7941176  to the right, improve=47.64144, (0 missing)
##       3871 &lt; 0.7472178  to the right, improve=33.68476, (0 missing)
##       2450 &lt; 0.4928571  to the left,  improve=19.14245, (0 missing)
##   Surrogate splits:
##       617  &lt; 0.40625    to the left,  agree=0.996, adj=0.826, (0 split)
##       4031 &lt; 0.7941176  to the right, agree=0.989, adj=0.565, (0 split)
##       3871 &lt; 0.7472178  to the right, agree=0.981, adj=0.239, (0 split)
##       5690 &lt; 0.7472178  to the right, agree=0.981, adj=0.239, (0 split)
##       88   &lt; 0.5714286  to the left,  agree=0.980, adj=0.174, (0 split)
## 
## Node number 4: 2518 observations,    complexity param=0.02423469
##   predicted class=0  expected loss=0.1131851  P(node) =0.5166188
##     class counts:  2233   285
##    probabilities: 0.887 0.113 
##   left son=8 (2443 obs) right son=9 (75 obs)
##   Primary splits:
##       5513 &lt; 0.2327327  to the right, improve=90.90853, (0 missing)
##       1376 &lt; 0.2859477  to the right, improve=76.78259, (0 missing)
##       1708 &lt; 0.2327327  to the right, improve=64.38235, (0 missing)
##       246  &lt; 0.424812   to the right, improve=57.17467, (0 missing)
##       88   &lt; 0.424812   to the right, improve=44.62425, (0 missing)
##   Surrogate splits:
##       246  &lt; 0.02631579 to the right, agree=0.971, adj=0.027, (0 split)
##       6137 &lt; 0.701426   to the left,  agree=0.971, adj=0.027, (0 split)
## 
## Node number 5: 476 observations,    complexity param=0.0369898
##   predicted class=1  expected loss=0.4117647  P(node) =0.09766106
##     class counts:   196   280
##    probabilities: 0.412 0.588 
##   left son=10 (100 obs) right son=11 (376 obs)
##   Primary splits:
##       2966 &lt; 0.3042017  to the left,  improve=73.34887, (0 missing)
##       3578 &lt; 0.352381   to the left,  improve=69.57042, (0 missing)
##       2816 &lt; 0.3042017  to the left,  improve=69.57042, (0 missing)
##       3294 &lt; 0.3621849  to the left,  improve=69.37825, (0 missing)
##       2696 &lt; 0.3621849  to the left,  improve=68.34782, (0 missing)
##   Surrogate splits:
##       1338 &lt; 0.3621849  to the left,  agree=0.975, adj=0.88, (0 split)
##       3375 &lt; 0.3621849  to the left,  agree=0.975, adj=0.88, (0 split)
##       2816 &lt; 0.3621849  to the left,  agree=0.973, adj=0.87, (0 split)
##       3294 &lt; 0.3621849  to the left,  agree=0.968, adj=0.85, (0 split)
##       2696 &lt; 0.3621849  to the left,  agree=0.966, adj=0.84, (0 split)
## 
## Node number 6: 46 observations
##   predicted class=0  expected loss=0.06521739  P(node) =0.009437833
##     class counts:    43     3
##    probabilities: 0.935 0.065 
## 
## Node number 7: 1834 observations
##   predicted class=1  expected loss=0.02726281  P(node) =0.3762823
##     class counts:    50  1784
##    probabilities: 0.027 0.973 
## 
## Node number 8: 2443 observations,    complexity param=0.01743197
##   predicted class=0  expected loss=0.08964388  P(node) =0.501231
##     class counts:  2224   219
##    probabilities: 0.910 0.090 
##   left son=16 (2334 obs) right son=17 (109 obs)
##   Primary splits:
##       1376 &lt; 0.2859477  to the right, improve=81.71563, (0 missing)
##       1708 &lt; 0.2327327  to the right, improve=69.88437, (0 missing)
##       7546 &lt; 0.8517857  to the left,  improve=45.25254, (0 missing)
##       4895 &lt; 0.2237077  to the right, improve=42.11791, (0 missing)
##       246  &lt; 0.424812   to the right, improve=32.58705, (0 missing)
##   Surrogate splits:
##       1708 &lt; 0.2327327  to the right, agree=0.972, adj=0.376, (0 split)
##       6137 &lt; 0.3042017  to the right, agree=0.956, adj=0.018, (0 split)
##       3559 &lt; 0.08333333 to the right, agree=0.956, adj=0.009, (0 split)
## 
## Node number 9: 75 observations
##   predicted class=1  expected loss=0.12  P(node) =0.01538777
##     class counts:     9    66
##    probabilities: 0.120 0.880 
## 
## Node number 10: 100 observations
##   predicted class=0  expected loss=0.05  P(node) =0.02051703
##     class counts:    95     5
##    probabilities: 0.950 0.050 
## 
## Node number 11: 376 observations,    complexity param=0.01955782
##   predicted class=1  expected loss=0.268617  P(node) =0.07714403
##     class counts:   101   275
##    probabilities: 0.269 0.731 
##   left son=22 (108 obs) right son=23 (268 obs)
##   Primary splits:
##       2676 &lt; 0.6163664  to the right, improve=59.83417, (0 missing)
##       3294 &lt; 0.6163664  to the right, improve=57.87019, (0 missing)
##       4895 &lt; 0.5222816  to the right, improve=57.46581, (0 missing)
##       1252 &lt; 0.4781513  to the right, improve=53.52919, (0 missing)
##       3375 &lt; 0.5361345  to the right, improve=52.69246, (0 missing)
##   Surrogate splits:
##       3150 &lt; 0.5067568  to the right, agree=0.947, adj=0.815, (0 split)
##       2656 &lt; 0.5067568  to the right, agree=0.941, adj=0.796, (0 split)
##       2391 &lt; 0.5067568  to the right, agree=0.934, adj=0.769, (0 split)
##       3078 &lt; 0.451952   to the right, agree=0.926, adj=0.741, (0 split)
##       2992 &lt; 0.451952   to the right, agree=0.912, adj=0.694, (0 split)
## 
## Node number 16: 2334 observations,    complexity param=0.01062925
##   predicted class=0  expected loss=0.06169666  P(node) =0.4788675
##     class counts:  2190   144
##    probabilities: 0.938 0.062 
##   left son=32 (2285 obs) right son=33 (49 obs)
##   Primary splits:
##       4895 &lt; 0.2237077  to the right, improve=48.12992, (0 missing)
##       7546 &lt; 0.8517857  to the left,  improve=48.09872, (0 missing)
##       246  &lt; 0.424812   to the right, improve=11.71622, (0 missing)
##       3871 &lt; 0.4085851  to the left,  improve=11.68121, (0 missing)
##       3578 &lt; 0.3971471  to the left,  improve=11.63774, (0 missing)
##   Surrogate splits:
##       7546 &lt; 0.8517857  to the left,  agree=0.981, adj=0.102, (0 split)
## 
## Node number 17: 109 observations,    complexity param=0.0127551
##   predicted class=1  expected loss=0.3119266  P(node) =0.02236356
##     class counts:    34    75
##    probabilities: 0.312 0.688 
##   left son=34 (30 obs) right son=35 (79 obs)
##   Primary splits:
##       4895 &lt; 0.3621849  to the left,  improve=39.19405, (0 missing)
##       4585 &lt; 0.6619048  to the left,  improve=37.41138, (0 missing)
##       246  &lt; 0.413229   to the right, improve=33.68808, (0 missing)
##       88   &lt; 0.413229   to the right, improve=33.68808, (0 missing)
##       2450 &lt; 0.3801587  to the left,  improve=27.52181, (0 missing)
##   Surrogate splits:
##       246  &lt; 0.4327485  to the right, agree=0.954, adj=0.833, (0 split)
##       88   &lt; 0.4327485  to the right, agree=0.954, adj=0.833, (0 split)
##       3017 &lt; 0.6619048  to the left,  agree=0.917, adj=0.700, (0 split)
##       2676 &lt; 0.4365079  to the left,  agree=0.917, adj=0.700, (0 split)
##       4585 &lt; 0.6619048  to the left,  agree=0.917, adj=0.700, (0 split)
## 
## Node number 22: 108 observations,    complexity param=0.01318027
##   predicted class=0  expected loss=0.287037  P(node) =0.02215839
##     class counts:    77    31
##    probabilities: 0.713 0.287 
##   left son=44 (77 obs) right son=45 (31 obs)
##   Primary splits:
##       7370 &lt; 0.2508929  to the right, improve=44.20370, (0 missing)
##       6137 &lt; 0.3419643  to the right, improve=44.20370, (0 missing)
##       6649 &lt; 0.2508929  to the right, improve=44.20370, (0 missing)
##       7546 &lt; 0.4901786  to the right, improve=44.20370, (0 missing)
##       1090 &lt; 0.5345865  to the left,  improve=34.67513, (0 missing)
##   Surrogate splits:
##       6137 &lt; 0.3419643  to the right, agree=1.000, adj=1.000, (0 split)
##       6649 &lt; 0.2508929  to the right, agree=1.000, adj=1.000, (0 split)
##       7546 &lt; 0.4901786  to the right, agree=1.000, adj=1.000, (0 split)
##       1090 &lt; 0.5345865  to the left,  agree=0.954, adj=0.839, (0 split)
##       421  &lt; 0.5894737  to the left,  agree=0.917, adj=0.710, (0 split)
## 
## Node number 23: 268 observations
##   predicted class=1  expected loss=0.08955224  P(node) =0.05498564
##     class counts:    24   244
##    probabilities: 0.090 0.910 
## 
## Node number 32: 2285 observations
##   predicted class=0  expected loss=0.04682713  P(node) =0.4688141
##     class counts:  2178   107
##    probabilities: 0.953 0.047 
## 
## Node number 33: 49 observations
##   predicted class=1  expected loss=0.244898  P(node) =0.01005334
##     class counts:    12    37
##    probabilities: 0.245 0.755 
## 
## Node number 34: 30 observations
##   predicted class=0  expected loss=0  P(node) =0.006155109
##     class counts:    30     0
##    probabilities: 1.000 0.000 
## 
## Node number 35: 79 observations
##   predicted class=1  expected loss=0.05063291  P(node) =0.01620845
##     class counts:     4    75
##    probabilities: 0.051 0.949 
## 
## Node number 44: 77 observations
##   predicted class=0  expected loss=0  P(node) =0.01579811
##     class counts:    77     0
##    probabilities: 1.000 0.000 
## 
## Node number 45: 31 observations
##   predicted class=1  expected loss=0  P(node) =0.006360279
##     class counts:     0    31
##    probabilities: 0.000 1.000</code></pre>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="actualización-del-modelo.html#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(arbol.sin.olor)</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/arbol%20de%20decision%20sin%20olor-1.png" width="672" /></p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="actualización-del-modelo.html#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla comparativa:</span></span>
<span id="cb198-2"><a href="actualización-del-modelo.html#cb198-2" aria-hidden="true" tabindex="-1"></a>setas60_test.data.sin.olor<span class="ot">=</span><span class="fu">as.data.frame</span>(setas60_test.sin.olor)</span>
<span id="cb198-3"><a href="actualización-del-modelo.html#cb198-3" aria-hidden="true" tabindex="-1"></a>prediccion.arbol.sin.olor<span class="ot">=</span><span class="fu">round</span>(<span class="fu">predict</span>(arbol.sin.olor,setas60_test.data.sin.olor)[,<span class="dv">2</span>])</span>
<span id="cb198-4"><a href="actualización-del-modelo.html#cb198-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(prediccion.arbol.sin.olor,setas_test[,<span class="dv">1</span>])</span></code></pre></div>
<pre><code>##                          
## prediccion.arbol.sin.olor   0   1
##                         0 797  53
##                         1  41 733</code></pre>
<p>El gráfico resultante podemos interpretarlo basándonos en cuánto se parece una seta a los medoides más importantes como son las observaciones 246, 88, 5513 y 421, son observaciones distintas que cuando hemos aplicado el modelo a los datos con la variable <strong>Olor</strong></p>
<p>En la tabla podemos ver que a la hora de predecir nuestro árbol de decisión comete cierto error, a continuación analizamos ese error con distintas medidas de precisión.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="actualización-del-modelo.html#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exactitud/Error</span></span>
<span id="cb200-2"><a href="actualización-del-modelo.html#cb200-2" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">=</span> <span class="fu">sum</span>(prediccion.arbol.sin.olor <span class="sc">==</span> setas_test[,<span class="dv">1</span>])<span class="sc">/</span><span class="fu">nrow</span>(setas_test.sin.olor)</span>
<span id="cb200-3"><a href="actualización-del-modelo.html#cb200-3" aria-hidden="true" tabindex="-1"></a>error <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span>accuracy</span>
<span id="cb200-4"><a href="actualización-del-modelo.html#cb200-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-5"><a href="actualización-del-modelo.html#cb200-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas VENENOSAS, sensitivity o recall</span></span>
<span id="cb200-6"><a href="actualización-del-modelo.html#cb200-6" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="ot">=</span> <span class="fu">sum</span>((prediccion.arbol.sin.olor <span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb200-7"><a href="actualización-del-modelo.html#cb200-7" aria-hidden="true" tabindex="-1"></a>recall <span class="ot">=</span> sensitivity</span>
<span id="cb200-8"><a href="actualización-del-modelo.html#cb200-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-9"><a href="actualización-del-modelo.html#cb200-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas COMESTIBLES</span></span>
<span id="cb200-10"><a href="actualización-del-modelo.html#cb200-10" aria-hidden="true" tabindex="-1"></a>specificity <span class="ot">=</span>  <span class="fu">sum</span>(prediccion.arbol.sin.olor <span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb200-11"><a href="actualización-del-modelo.html#cb200-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-12"><a href="actualización-del-modelo.html#cb200-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es VENENOSAS</span></span>
<span id="cb200-13"><a href="actualización-del-modelo.html#cb200-13" aria-hidden="true" tabindex="-1"></a>precision <span class="ot">=</span> <span class="fu">sum</span>( (prediccion.arbol.sin.olor<span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (prediccion.arbol.sin.olor <span class="sc">==</span> <span class="dv">1</span>))<span class="sc">/</span> <span class="fu">sum</span>(prediccion.arbol.sin.olor <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb200-14"><a href="actualización-del-modelo.html#cb200-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-15"><a href="actualización-del-modelo.html#cb200-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es COMESTIBLE</span></span>
<span id="cb200-16"><a href="actualización-del-modelo.html#cb200-16" aria-hidden="true" tabindex="-1"></a>npv <span class="ot">=</span> <span class="fu">sum</span>(prediccion.arbol.sin.olor<span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> prediccion.arbol.sin.olor <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(prediccion.arbol.sin.olor <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb200-17"><a href="actualización-del-modelo.html#cb200-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-18"><a href="actualización-del-modelo.html#cb200-18" aria-hidden="true" tabindex="-1"></a><span class="co"># F1_score</span></span>
<span id="cb200-19"><a href="actualización-del-modelo.html#cb200-19" aria-hidden="true" tabindex="-1"></a>f1score <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>precision<span class="sc">*</span>recall <span class="sc">/</span>(precision<span class="sc">+</span>recall)</span>
<span id="cb200-20"><a href="actualización-del-modelo.html#cb200-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-21"><a href="actualización-del-modelo.html#cb200-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla de medidas de precisión</span></span>
<span id="cb200-22"><a href="actualización-del-modelo.html#cb200-22" aria-hidden="true" tabindex="-1"></a>medidas.arboles.sin.olor<span class="ot">=</span><span class="fu">c</span>(<span class="at">accuracy =</span> accuracy, <span class="at">error =</span> error, <span class="at">sensitivity =</span> sensitivity, <span class="at">specificity =</span> specificity, <span class="at">precision =</span> precision, <span class="at">npv =</span> npv, <span class="at">f1=</span>f1score)</span>
<span id="cb200-23"><a href="actualización-del-modelo.html#cb200-23" aria-hidden="true" tabindex="-1"></a>medidas.arboles.sin.olor</span></code></pre></div>
<pre><code>##    accuracy       error sensitivity specificity   precision         npv 
##  0.94211823  0.05788177  0.93256997  0.95107399  0.94702842  0.93764706 
##          f1 
##  0.93974359</code></pre>
<p>El error que se comete es superior,5%, que en el caso del modelo k-NN con el vecino más próximo, por lo que podemos determinar que el árbol de decisión predice peor. Además el error cometido es inferior al cometido por el mismo modelo pero con la variable <strong>Olor</strong>.</p>
</div>
<div id="bosques-aleatorios-1" class="section level3" number="8.1.4">
<h3><span class="header-section-number">8.1.4</span> Bosques Aleatorios</h3>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="actualización-del-modelo.html#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">34735</span>)</span>
<span id="cb202-2"><a href="actualización-del-modelo.html#cb202-2" aria-hidden="true" tabindex="-1"></a>setas.rf.sin.olor<span class="ot">=</span><span class="fu">randomForest</span>(setas60_train.sin.olor, <span class="fu">as.factor</span>(setas60_train.respuesta.sin.olor<span class="sc">$</span>Letalidad), <span class="at">ntree=</span><span class="dv">100</span>, <span class="at">importance=</span><span class="cn">FALSE</span>, <span class="at">proximity=</span><span class="cn">TRUE</span>, <span class="at">mtry=</span><span class="dv">4</span>, <span class="at">replace=</span><span class="cn">FALSE</span>,<span class="at">method=</span><span class="st">&quot;class&quot;</span>)</span>
<span id="cb202-3"><a href="actualización-del-modelo.html#cb202-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-4"><a href="actualización-del-modelo.html#cb202-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla comparativa</span></span>
<span id="cb202-5"><a href="actualización-del-modelo.html#cb202-5" aria-hidden="true" tabindex="-1"></a>prediccion.rf.sin.olor<span class="ot">=</span><span class="fu">predict</span>(setas.rf.sin.olor, setas60_test.data.sin.olor)</span>
<span id="cb202-6"><a href="actualización-del-modelo.html#cb202-6" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(prediccion.rf.sin.olor,<span class="fu">as.factor</span>(setas_test.sin.olor[,<span class="dv">1</span>]))</span></code></pre></div>
<pre><code>##                       
## prediccion.rf.sin.olor   0   1
##                      0 831   2
##                      1   7 784</code></pre>
<p>La predicción se equivoca clasificando ciertas setas, empeora respecto la predicción con la variable <strong>Olor</strong>, ahora predice 7 setas como venenosas cuando son comestibles, pero este error es mejor que si fuese a la inversa. Analizamos la precisión de los bosques aleatorios con las medidas de precisión.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="actualización-del-modelo.html#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exactitud/Error</span></span>
<span id="cb204-2"><a href="actualización-del-modelo.html#cb204-2" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">=</span> <span class="fu">sum</span>(prediccion.rf.sin.olor <span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>])<span class="sc">/</span><span class="fu">nrow</span>(setas_test.sin.olor)</span>
<span id="cb204-3"><a href="actualización-del-modelo.html#cb204-3" aria-hidden="true" tabindex="-1"></a>error <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span>accuracy</span>
<span id="cb204-4"><a href="actualización-del-modelo.html#cb204-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-5"><a href="actualización-del-modelo.html#cb204-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Sensibilidad: acierto sobre el total de las setas VENENOSAS</span></span>
<span id="cb204-6"><a href="actualización-del-modelo.html#cb204-6" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="ot">=</span> <span class="fu">sum</span>((prediccion.rf.sin.olor <span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb204-7"><a href="actualización-del-modelo.html#cb204-7" aria-hidden="true" tabindex="-1"></a>recall <span class="ot">=</span> sensitivity</span>
<span id="cb204-8"><a href="actualización-del-modelo.html#cb204-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-9"><a href="actualización-del-modelo.html#cb204-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Especifidad: acierto sobre el total de las setas COMESTIBLES</span></span>
<span id="cb204-10"><a href="actualización-del-modelo.html#cb204-10" aria-hidden="true" tabindex="-1"></a>specificity <span class="ot">=</span>  <span class="fu">sum</span>(prediccion.rf.sin.olor <span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb204-11"><a href="actualización-del-modelo.html#cb204-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-12"><a href="actualización-del-modelo.html#cb204-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Precisión: acierto cuando el predicho es VENENOSAS</span></span>
<span id="cb204-13"><a href="actualización-del-modelo.html#cb204-13" aria-hidden="true" tabindex="-1"></a>precision <span class="ot">=</span> <span class="fu">sum</span>( (prediccion.rf.sin.olor<span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (prediccion.rf.sin.olor <span class="sc">==</span> <span class="dv">1</span>))<span class="sc">/</span> <span class="fu">sum</span>(prediccion.rf.sin.olor <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb204-14"><a href="actualización-del-modelo.html#cb204-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-15"><a href="actualización-del-modelo.html#cb204-15" aria-hidden="true" tabindex="-1"></a><span class="co"># NPV: acierto cuando el predicho es COMESTIBLE</span></span>
<span id="cb204-16"><a href="actualización-del-modelo.html#cb204-16" aria-hidden="true" tabindex="-1"></a>npv <span class="ot">=</span> <span class="fu">sum</span>(prediccion.rf.sin.olor<span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> prediccion.rf.sin.olor <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(prediccion.rf.sin.olor <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb204-17"><a href="actualización-del-modelo.html#cb204-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-18"><a href="actualización-del-modelo.html#cb204-18" aria-hidden="true" tabindex="-1"></a><span class="co"># F1_score</span></span>
<span id="cb204-19"><a href="actualización-del-modelo.html#cb204-19" aria-hidden="true" tabindex="-1"></a>f1score <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>precision<span class="sc">*</span>recall <span class="sc">/</span>(precision<span class="sc">+</span>recall)</span>
<span id="cb204-20"><a href="actualización-del-modelo.html#cb204-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-21"><a href="actualización-del-modelo.html#cb204-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla de medidas de precisión</span></span>
<span id="cb204-22"><a href="actualización-del-modelo.html#cb204-22" aria-hidden="true" tabindex="-1"></a>medidas.bosques.sin.olor<span class="ot">=</span><span class="fu">c</span>(<span class="at">accuracy =</span> accuracy, <span class="at">error =</span> error, <span class="at">sensitivity =</span> sensitivity, <span class="at">specificity =</span> specificity, <span class="at">precision =</span> precision, <span class="at">npv =</span> npv, <span class="at">f1=</span>f1score)</span>
<span id="cb204-23"><a href="actualización-del-modelo.html#cb204-23" aria-hidden="true" tabindex="-1"></a>medidas.bosques.sin.olor</span></code></pre></div>
<pre><code>##    accuracy       error sensitivity specificity   precision         npv 
## 0.994458128 0.005541872 0.997455471 0.991646778 0.991150442 0.997599040 
##          f1 
## 0.994292961</code></pre>
<p>El error que se comete mejora respecto al algoritmo anterior, pero es superior al error cometido por el modelo k-NN.</p>
</div>
<div id="support-vector-machines-1" class="section level3" number="8.1.5">
<h3><span class="header-section-number">8.1.5</span> Support Vector Machines</h3>
<p>Para determinar el valor de gamma y el coste, usamos los datos que hemos reservado para validación y realizamos una estimación con ellos.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="actualización-del-modelo.html#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Para estimar el gamma: </span></span>
<span id="cb206-2"><a href="actualización-del-modelo.html#cb206-2" aria-hidden="true" tabindex="-1"></a>gamma_est<span class="ot">=</span><span class="dv">1</span><span class="sc">/</span><span class="fu">apply</span>(setas60_validacion.sin.olor,<span class="dv">2</span>,sd)</span>
<span id="cb206-3"><a href="actualización-del-modelo.html#cb206-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Para estimar el coste: </span></span>
<span id="cb206-4"><a href="actualización-del-modelo.html#cb206-4" aria-hidden="true" tabindex="-1"></a>norma2<span class="ot">&lt;-</span><span class="cf">function</span>(x) <span class="fu">sqrt</span>(<span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb206-5"><a href="actualización-del-modelo.html#cb206-5" aria-hidden="true" tabindex="-1"></a>cost_est<span class="ot">=</span><span class="fu">apply</span>(setas60_validacion.sin.olor,<span class="dv">2</span>,norma2)</span>
<span id="cb206-6"><a href="actualización-del-modelo.html#cb206-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-7"><a href="actualización-del-modelo.html#cb206-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Ajustamos el modelo</span></span>
<span id="cb206-8"><a href="actualización-del-modelo.html#cb206-8" aria-hidden="true" tabindex="-1"></a>setas.svm.sin.olor<span class="ot">=</span><span class="fu">svm</span>(setas60_train.sin.olor,setas_train.sin.olor[,<span class="dv">1</span>],<span class="at">type=</span><span class="st">&quot;C-classification&quot;</span>,<span class="at">kernel=</span><span class="st">&quot;radial&quot;</span>,<span class="at">gamma=</span><span class="fu">mean</span>(gamma_est),<span class="at">cost=</span><span class="fu">mean</span>(cost_est),<span class="at">scale=</span>F)</span>
<span id="cb206-9"><a href="actualización-del-modelo.html#cb206-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Vectores soporte</span></span>
<span id="cb206-10"><a href="actualización-del-modelo.html#cb206-10" aria-hidden="true" tabindex="-1"></a>setas.svm.sin.olor<span class="sc">$</span>tot.nSV</span></code></pre></div>
<pre><code>## [1] 1160</code></pre>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="actualización-del-modelo.html#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla comparativa</span></span>
<span id="cb208-2"><a href="actualización-del-modelo.html#cb208-2" aria-hidden="true" tabindex="-1"></a>prediccion_svm.sin.olor<span class="ot">=</span><span class="fu">predict</span>(setas.svm.sin.olor,setas60_test.sin.olor)</span>
<span id="cb208-3"><a href="actualización-del-modelo.html#cb208-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(prediccion_svm.sin.olor,setas_test.sin.olor[,<span class="dv">1</span>])</span></code></pre></div>
<pre><code>##                        
## prediccion_svm.sin.olor   0   1
##                       0 838   0
##                       1   0 786</code></pre>
<p>La tabla nos dice que el modelo predice a la perfección los datos, utiliza 1160 vectores como soporte, lo que supone un 23% de las observaciones, por lo que descartamos que la precisión del modelo se deba a un sobre ajuste de los datos. Las medidas de precisión no van a aportar nada que no sepamos con mirar simplemente la tabla.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="actualización-del-modelo.html#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Medidas de precisión</span></span>
<span id="cb210-2"><a href="actualización-del-modelo.html#cb210-2" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">=</span> <span class="fu">sum</span>(prediccion_svm.sin.olor <span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>])<span class="sc">/</span><span class="fu">nrow</span>(setas_test.sin.olor)</span>
<span id="cb210-3"><a href="actualización-del-modelo.html#cb210-3" aria-hidden="true" tabindex="-1"></a>error <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span>accuracy</span>
<span id="cb210-4"><a href="actualización-del-modelo.html#cb210-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-5"><a href="actualización-del-modelo.html#cb210-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas VENENOSAS, sensitivity o recall</span></span>
<span id="cb210-6"><a href="actualización-del-modelo.html#cb210-6" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="ot">=</span> <span class="fu">sum</span>((prediccion_svm.sin.olor <span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb210-7"><a href="actualización-del-modelo.html#cb210-7" aria-hidden="true" tabindex="-1"></a>recall <span class="ot">=</span> sensitivity</span>
<span id="cb210-8"><a href="actualización-del-modelo.html#cb210-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-9"><a href="actualización-del-modelo.html#cb210-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas COMESTIBLES</span></span>
<span id="cb210-10"><a href="actualización-del-modelo.html#cb210-10" aria-hidden="true" tabindex="-1"></a>specificity <span class="ot">=</span>  <span class="fu">sum</span>(prediccion_svm.sin.olor <span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb210-11"><a href="actualización-del-modelo.html#cb210-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-12"><a href="actualización-del-modelo.html#cb210-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es VENENOSAS</span></span>
<span id="cb210-13"><a href="actualización-del-modelo.html#cb210-13" aria-hidden="true" tabindex="-1"></a>precision <span class="ot">=</span> <span class="fu">sum</span>((prediccion_svm.sin.olor<span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (prediccion_svm.sin.olor <span class="sc">==</span> <span class="dv">1</span>))<span class="sc">/</span> <span class="fu">sum</span>(prediccion_svm.sin.olor <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb210-14"><a href="actualización-del-modelo.html#cb210-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-15"><a href="actualización-del-modelo.html#cb210-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es COMESTIBLE</span></span>
<span id="cb210-16"><a href="actualización-del-modelo.html#cb210-16" aria-hidden="true" tabindex="-1"></a>npv <span class="ot">=</span> <span class="fu">sum</span>(prediccion_svm.sin.olor<span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> prediccion_svm.sin.olor <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(prediccion_svm.sin.olor <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb210-17"><a href="actualización-del-modelo.html#cb210-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-18"><a href="actualización-del-modelo.html#cb210-18" aria-hidden="true" tabindex="-1"></a><span class="co"># F1_score</span></span>
<span id="cb210-19"><a href="actualización-del-modelo.html#cb210-19" aria-hidden="true" tabindex="-1"></a>f1score <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>precision<span class="sc">*</span>recall <span class="sc">/</span>(precision<span class="sc">+</span>recall)</span>
<span id="cb210-20"><a href="actualización-del-modelo.html#cb210-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-21"><a href="actualización-del-modelo.html#cb210-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla de medidas de precisión</span></span>
<span id="cb210-22"><a href="actualización-del-modelo.html#cb210-22" aria-hidden="true" tabindex="-1"></a>medidas.svmradial.sin.olor<span class="ot">=</span><span class="fu">c</span>(<span class="at">accuracy =</span> accuracy, <span class="at">error =</span> error, <span class="at">sensitivity =</span> sensitivity, <span class="at">specificity =</span> specificity, <span class="at">precision =</span> precision, <span class="at">npv =</span> npv, <span class="at">f1=</span>f1score)</span>
<span id="cb210-23"><a href="actualización-del-modelo.html#cb210-23" aria-hidden="true" tabindex="-1"></a>medidas.svmradial.sin.olor</span></code></pre></div>
<pre><code>##    accuracy       error sensitivity specificity   precision         npv 
##           1           0           1           1           1           1 
##          f1 
##           1</code></pre>
<p>Si realizamos el ajuste de SVM pero establecemos que el kernel es lineal, obtenemos lo siguiente:</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="actualización-del-modelo.html#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Para estimar el coste: </span></span>
<span id="cb212-2"><a href="actualización-del-modelo.html#cb212-2" aria-hidden="true" tabindex="-1"></a>norma2<span class="ot">&lt;-</span><span class="cf">function</span>(x) <span class="fu">sqrt</span>(<span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb212-3"><a href="actualización-del-modelo.html#cb212-3" aria-hidden="true" tabindex="-1"></a>cost_est<span class="ot">=</span><span class="fu">apply</span>(setas60_validacion.sin.olor,<span class="dv">2</span>,norma2)</span>
<span id="cb212-4"><a href="actualización-del-modelo.html#cb212-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-5"><a href="actualización-del-modelo.html#cb212-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Ajustamos el modelo</span></span>
<span id="cb212-6"><a href="actualización-del-modelo.html#cb212-6" aria-hidden="true" tabindex="-1"></a>setas.svm.lineal.sin.olor<span class="ot">=</span><span class="fu">svm</span>(setas60_train.sin.olor,setas_train.sin.olor[,<span class="dv">1</span>],<span class="at">type=</span><span class="st">&quot;C-classification&quot;</span>,<span class="at">kernel=</span><span class="st">&quot;linear&quot;</span>,<span class="at">cost=</span><span class="fu">mean</span>(cost_est),<span class="at">scale=</span>F)</span>
<span id="cb212-7"><a href="actualización-del-modelo.html#cb212-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Vectores soporte</span></span>
<span id="cb212-8"><a href="actualización-del-modelo.html#cb212-8" aria-hidden="true" tabindex="-1"></a>setas.svm.lineal.sin.olor<span class="sc">$</span>tot.nSV</span></code></pre></div>
<pre><code>## [1] 552</code></pre>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="actualización-del-modelo.html#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla comparativa</span></span>
<span id="cb214-2"><a href="actualización-del-modelo.html#cb214-2" aria-hidden="true" tabindex="-1"></a>prediccion_svm.lineal.sin.olor<span class="ot">=</span><span class="fu">predict</span>(setas.svm.lineal.sin.olor,setas60_test.sin.olor)</span>
<span id="cb214-3"><a href="actualización-del-modelo.html#cb214-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(prediccion_svm.lineal.sin.olor,setas_test.sin.olor[,<span class="dv">1</span>])</span></code></pre></div>
<pre><code>##                               
## prediccion_svm.lineal.sin.olor   0   1
##                              0 811  37
##                              1  27 749</code></pre>
<p>Podemos ver que respecto al kernel radial, las predicciones empeoran. Esto lo podemos observar en las medidas de precisión.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="actualización-del-modelo.html#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Medidas de precisión</span></span>
<span id="cb216-2"><a href="actualización-del-modelo.html#cb216-2" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">=</span> <span class="fu">sum</span>(prediccion_svm.lineal.sin.olor <span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>])<span class="sc">/</span><span class="fu">nrow</span>(setas_test.sin.olor)</span>
<span id="cb216-3"><a href="actualización-del-modelo.html#cb216-3" aria-hidden="true" tabindex="-1"></a>error <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span>accuracy</span>
<span id="cb216-4"><a href="actualización-del-modelo.html#cb216-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-5"><a href="actualización-del-modelo.html#cb216-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas VENENOSAS, sensitivity o recall</span></span>
<span id="cb216-6"><a href="actualización-del-modelo.html#cb216-6" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="ot">=</span> <span class="fu">sum</span>((prediccion_svm.lineal.sin.olor <span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb216-7"><a href="actualización-del-modelo.html#cb216-7" aria-hidden="true" tabindex="-1"></a>recall <span class="ot">=</span> sensitivity</span>
<span id="cb216-8"><a href="actualización-del-modelo.html#cb216-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-9"><a href="actualización-del-modelo.html#cb216-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas COMESTIBLES</span></span>
<span id="cb216-10"><a href="actualización-del-modelo.html#cb216-10" aria-hidden="true" tabindex="-1"></a>specificity <span class="ot">=</span>  <span class="fu">sum</span>(prediccion_svm.lineal.sin.olor <span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb216-11"><a href="actualización-del-modelo.html#cb216-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-12"><a href="actualización-del-modelo.html#cb216-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es VENENOSAS</span></span>
<span id="cb216-13"><a href="actualización-del-modelo.html#cb216-13" aria-hidden="true" tabindex="-1"></a>precision <span class="ot">=</span> <span class="fu">sum</span>((prediccion_svm.lineal.sin.olor<span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (prediccion_svm.lineal.sin.olor <span class="sc">==</span> <span class="dv">1</span>))<span class="sc">/</span> <span class="fu">sum</span>(prediccion_svm.lineal.sin.olor <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb216-14"><a href="actualización-del-modelo.html#cb216-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-15"><a href="actualización-del-modelo.html#cb216-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es COMESTIBLE</span></span>
<span id="cb216-16"><a href="actualización-del-modelo.html#cb216-16" aria-hidden="true" tabindex="-1"></a>npv <span class="ot">=</span> <span class="fu">sum</span>(prediccion_svm.lineal.sin.olor<span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> prediccion_svm.lineal.sin.olor <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(prediccion_svm.lineal.sin.olor <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb216-17"><a href="actualización-del-modelo.html#cb216-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-18"><a href="actualización-del-modelo.html#cb216-18" aria-hidden="true" tabindex="-1"></a><span class="co"># F1_score</span></span>
<span id="cb216-19"><a href="actualización-del-modelo.html#cb216-19" aria-hidden="true" tabindex="-1"></a>f1score <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>precision<span class="sc">*</span>recall <span class="sc">/</span>(precision<span class="sc">+</span>recall)</span>
<span id="cb216-20"><a href="actualización-del-modelo.html#cb216-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-21"><a href="actualización-del-modelo.html#cb216-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla de medidas de precisión</span></span>
<span id="cb216-22"><a href="actualización-del-modelo.html#cb216-22" aria-hidden="true" tabindex="-1"></a>medidas.svmlineal.sin.olor<span class="ot">=</span><span class="fu">c</span>(<span class="at">accuracy =</span> accuracy, <span class="at">error =</span> error, <span class="at">sensitivity =</span> sensitivity, <span class="at">specificity =</span> specificity, <span class="at">precision =</span> precision, <span class="at">npv =</span> npv, <span class="at">f1=</span>f1score)</span>
<span id="cb216-23"><a href="actualización-del-modelo.html#cb216-23" aria-hidden="true" tabindex="-1"></a>medidas.svmlineal.sin.olor</span></code></pre></div>
<pre><code>##    accuracy       error sensitivity specificity   precision         npv 
##  0.96059113  0.03940887  0.95292621  0.96778043  0.96520619  0.95636792 
##          f1 
##  0.95902689</code></pre>
<p>Por tanto descartaríamos usar un SVM con kernel lineal.</p>
</div>
<div id="evaluación-1" class="section level3" number="8.1.6">
<h3><span class="header-section-number">8.1.6</span> Evaluación</h3>
<p>Por lo tanto si comparamos todos los modelos que hemos aplicado usando las medidas de precisión vemos lo siguiente</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="actualización-del-modelo.html#cb218-1" aria-hidden="true" tabindex="-1"></a>medidas.precision.sin.olor<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">c</span>(medidas.knn.sin.olor,medidas.arboles.sin.olor,medidas.bosques.sin.olor,medidas.svmradial.sin.olor,medidas.svmlineal.sin.olor),<span class="at">nrow=</span><span class="dv">5</span>,<span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb218-2"><a href="actualización-del-modelo.html#cb218-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(medidas.precision.sin.olor)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;accuracy&quot;</span>, <span class="st">&quot;error&quot;</span>, <span class="st">&quot;sensitivity&quot;</span>, <span class="st">&quot;specificity&quot;</span>, <span class="st">&quot;precision&quot;</span>, <span class="st">&quot;npv&quot;</span>, <span class="st">&quot;f1score&quot;</span>)</span>
<span id="cb218-3"><a href="actualización-del-modelo.html#cb218-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(medidas.precision.sin.olor)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;k-NN&quot;</span>,<span class="st">&quot;Arboles de decision&quot;</span>,<span class="st">&quot;Bosques aleatorios&quot;</span>,<span class="st">&quot;SVM radial&quot;</span>,<span class="st">&quot;SVM lineal&quot;</span>)</span>
<span id="cb218-4"><a href="actualización-del-modelo.html#cb218-4" aria-hidden="true" tabindex="-1"></a>medidas.precision.sin.olor</span></code></pre></div>
<pre><code>##                      accuracy       error sensitivity specificity precision
## k-NN                0.9987685 0.001231527   0.9974555   1.0000000 1.0000000
## Arboles de decision 0.9421182 0.057881773   0.9325700   0.9510740 0.9470284
## Bosques aleatorios  0.9944581 0.005541872   0.9974555   0.9916468 0.9911504
## SVM radial          1.0000000 0.000000000   1.0000000   1.0000000 1.0000000
## SVM lineal          0.9605911 0.039408867   0.9529262   0.9677804 0.9652062
##                           npv   f1score
## k-NN                0.9976190 0.9987261
## Arboles de decision 0.9376471 0.9397436
## Bosques aleatorios  0.9975990 0.9942930
## SVM radial          1.0000000 1.0000000
## SVM lineal          0.9563679 0.9590269</code></pre>
<p>El mejor modelo para aplicar a nuestros datos es el SVM con el kernel radial, pues predice a la perfección los datos tanto los de entrenamiento como los de test, pero el modelo k-NN también es un buen modelo para aplicar ya que tiene una especificidad del 100% a pesar de que comete cierto error.</p>
</div>
</div>
<div id="datos-con-variable-olorn" class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> Datos con variable <strong>Olor=n</strong></h2>
<p>Cuando realizamos el análisis descriptivo, ya observamos que la variable <strong>Olor</strong> es bastante determinante a la hora de clasificar las setas según su toxicidad, por ello nos planteamos realizar todo el análisis dejando solo las setas cuyo olor sea ninguno.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="actualización-del-modelo.html#cb220-1" aria-hidden="true" tabindex="-1"></a>setas.olor<span class="ot">=</span>setas[<span class="fu">which</span>(setas[,<span class="dv">29</span>]<span class="sc">==</span><span class="dv">1</span>),]</span>
<span id="cb220-2"><a href="actualización-del-modelo.html#cb220-2" aria-hidden="true" tabindex="-1"></a>setas.olor<span class="ot">=</span>setas.olor[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">23</span><span class="sc">:</span><span class="dv">31</span>)]</span>
<span id="cb220-3"><a href="actualización-del-modelo.html#cb220-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(setas.olor)<span class="ot">=</span><span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">dim</span>(setas.olor)[<span class="dv">1</span>])</span>
<span id="cb220-4"><a href="actualización-del-modelo.html#cb220-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(setas.olor<span class="sc">$</span>Letalidad)</span></code></pre></div>
<pre><code>## 
##    0    1 
## 3408  120</code></pre>
<p>Pero vemos que no hay la misma proporción de setas que tengan olor ninguno que sean comestibles o venenosas, por ello vamos a reducir los datos con los que vamos a trabajar a partir de ahora.</p>
<p>De las setas comestibles elegimos 120 setas de forma aleatoria para que se unan a las setas venenosas que tienen olor ninguno y usar esos datos para realizar el análisis.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="actualización-del-modelo.html#cb222-1" aria-hidden="true" tabindex="-1"></a>setas.olor.comestible<span class="ot">=</span><span class="fu">sample</span>(<span class="fu">dim</span>(setas.olor)[<span class="dv">1</span>],<span class="fu">sum</span>(setas.olor<span class="sc">$</span>Letalidad<span class="sc">==</span><span class="dv">1</span>))</span>
<span id="cb222-2"><a href="actualización-del-modelo.html#cb222-2" aria-hidden="true" tabindex="-1"></a>setas.olor.venenosa<span class="ot">=</span><span class="fu">which</span>(setas.olor<span class="sc">$</span>Letalidad<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb222-3"><a href="actualización-del-modelo.html#cb222-3" aria-hidden="true" tabindex="-1"></a>setas.olor.nueva<span class="ot">=</span><span class="fu">rbind</span>(setas.olor[setas.olor.comestible,],setas.olor[setas.olor.venenosa,])</span></code></pre></div>
<p>Ahora hacemos las particiones con el mismo porcentaje que en el análisis original, es decir, 60% para entrenamiento, 20% para test y validacion.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="actualización-del-modelo.html#cb223-1" aria-hidden="true" tabindex="-1"></a>n_totales.olor<span class="ot">=</span><span class="fu">dim</span>(setas.olor.nueva)[<span class="dv">1</span>]</span>
<span id="cb223-2"><a href="actualización-del-modelo.html#cb223-2" aria-hidden="true" tabindex="-1"></a>n_train.olor<span class="ot">=</span><span class="fu">floor</span>(n_totales.olor<span class="sc">*</span><span class="fl">0.6</span>) </span>
<span id="cb223-3"><a href="actualización-del-modelo.html#cb223-3" aria-hidden="true" tabindex="-1"></a>n_test.olor<span class="ot">=</span><span class="fu">floor</span>(n_totales.olor<span class="sc">*</span><span class="fl">0.2</span>) </span>
<span id="cb223-4"><a href="actualización-del-modelo.html#cb223-4" aria-hidden="true" tabindex="-1"></a>n_validacion.olor<span class="ot">=</span>n_totales.olor<span class="sc">-</span>n_train.olor<span class="sc">-</span>n_test.olor</span>
<span id="cb223-5"><a href="actualización-del-modelo.html#cb223-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-6"><a href="actualización-del-modelo.html#cb223-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">34735</span>)</span>
<span id="cb223-7"><a href="actualización-del-modelo.html#cb223-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-8"><a href="actualización-del-modelo.html#cb223-8" aria-hidden="true" tabindex="-1"></a>indices_totales.olor<span class="ot">=</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span>n_totales.olor)</span>
<span id="cb223-9"><a href="actualización-del-modelo.html#cb223-9" aria-hidden="true" tabindex="-1"></a>indices_train.olor<span class="ot">=</span><span class="fu">sort</span>(<span class="fu">sample</span>(indices_totales.olor,n_train.olor))</span>
<span id="cb223-10"><a href="actualización-del-modelo.html#cb223-10" aria-hidden="true" tabindex="-1"></a>indices_test.olor<span class="ot">=</span><span class="fu">sort</span>(<span class="fu">sample</span>(indices_totales.olor[<span class="sc">-</span>indices_train.olor],n_test.olor))</span>
<span id="cb223-11"><a href="actualización-del-modelo.html#cb223-11" aria-hidden="true" tabindex="-1"></a>indices_validacion.olor<span class="ot">=</span>indices_totales.olor[<span class="sc">-</span><span class="fu">c</span>(indices_train.olor,indices_test.olor)]</span>
<span id="cb223-12"><a href="actualización-del-modelo.html#cb223-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-13"><a href="actualización-del-modelo.html#cb223-13" aria-hidden="true" tabindex="-1"></a>setas_train.olor<span class="ot">=</span>setas.olor.nueva[indices_train.olor,]</span>
<span id="cb223-14"><a href="actualización-del-modelo.html#cb223-14" aria-hidden="true" tabindex="-1"></a>setas_test.olor<span class="ot">=</span>setas.olor.nueva[indices_test.olor,]</span>
<span id="cb223-15"><a href="actualización-del-modelo.html#cb223-15" aria-hidden="true" tabindex="-1"></a>setas_validacion.olor<span class="ot">=</span>setas.olor.nueva[indices_validacion.olor,]</span></code></pre></div>
<p>Recalculamos la medida de similitud</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="actualización-del-modelo.html#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Distancia Dice</span></span>
<span id="cb224-2"><a href="actualización-del-modelo.html#cb224-2" aria-hidden="true" tabindex="-1"></a>distancia_dice.olor<span class="ot">=</span><span class="fu">distance</span>(setas_train.olor[,<span class="dv">2</span><span class="sc">:</span><span class="fu">dim</span>(setas_train.olor)[<span class="dv">2</span>]],<span class="at">method=</span><span class="st">&quot;dice&quot;</span>)</span></code></pre></div>
<p>Como se ha reducido la dimensión de nuestros datos ya no hace falta calcular los medoides para tomarlos como puntos de referencia, ahora podemos aplicar todos los análisis a nuestros datos sin tener que hacer ninguna modificación.</p>
<p>Aplicamos el análisis de componentes principales a nuestros datos</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="actualización-del-modelo.html#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Análisis Componentes principales:</span></span>
<span id="cb225-2"><a href="actualización-del-modelo.html#cb225-2" aria-hidden="true" tabindex="-1"></a>pca<span class="ot">=</span><span class="fu">prcomp</span>(distancia_dice.olor)</span>
<span id="cb225-3"><a href="actualización-del-modelo.html#cb225-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pca)</span></code></pre></div>
<pre><code>## Importance of components:
##                           PC1    PC2    PC3     PC4    PC5     PC6     PC7
## Standard deviation     1.6512 1.0204 0.7473 0.50589 0.3582 0.26425 0.24972
## Proportion of Variance 0.5418 0.2069 0.1110 0.05086 0.0255 0.01388 0.01239
## Cumulative Proportion  0.5418 0.7487 0.8597 0.91054 0.9360 0.94991 0.96231
##                            PC8     PC9    PC10   PC11    PC12    PC13    PC14
## Standard deviation     0.18946 0.17493 0.12339 0.1208 0.11494 0.10212 0.09628
## Proportion of Variance 0.00713 0.00608 0.00303 0.0029 0.00263 0.00207 0.00184
## Cumulative Proportion  0.96944 0.97552 0.97855 0.9814 0.98407 0.98614 0.98798
##                           PC15    PC16    PC17    PC18    PC19    PC20    PC21
## Standard deviation     0.09045 0.08164 0.07905 0.07753 0.07223 0.06584 0.06158
## Proportion of Variance 0.00163 0.00132 0.00124 0.00119 0.00104 0.00086 0.00075
## Cumulative Proportion  0.98961 0.99093 0.99218 0.99337 0.99441 0.99527 0.99602
##                           PC22    PC23    PC24    PC25    PC26    PC27    PC28
## Standard deviation     0.05598 0.05522 0.05015 0.04550 0.04273 0.03919 0.03468
## Proportion of Variance 0.00062 0.00061 0.00050 0.00041 0.00036 0.00031 0.00024
## Cumulative Proportion  0.99665 0.99725 0.99775 0.99816 0.99853 0.99883 0.99907
##                           PC29    PC30    PC31    PC32    PC33    PC34    PC35
## Standard deviation     0.02949 0.02581 0.02300 0.02278 0.02108 0.01844 0.01798
## Proportion of Variance 0.00017 0.00013 0.00011 0.00010 0.00009 0.00007 0.00006
## Cumulative Proportion  0.99924 0.99937 0.99948 0.99958 0.99967 0.99974 0.99980
##                           PC36    PC37    PC38    PC39     PC40     PC41
## Standard deviation     0.01499 0.01458 0.01270 0.01089 0.009423 0.008386
## Proportion of Variance 0.00004 0.00004 0.00003 0.00002 0.000020 0.000010
## Cumulative Proportion  0.99985 0.99989 0.99992 0.99995 0.999960 0.999980
##                           PC42     PC43     PC44     PC45     PC46    PC47
## Standard deviation     0.00751 0.005277 0.003361 0.003019 0.002441 0.00157
## Proportion of Variance 0.00001 0.000010 0.000000 0.000000 0.000000 0.00000
## Cumulative Proportion  0.99999 0.999990 1.000000 1.000000 1.000000 1.00000
##                            PC48      PC49      PC50      PC51      PC52
## Standard deviation     0.001221 0.0001001 7.037e-05 4.323e-05 2.546e-05
## Proportion of Variance 0.000000 0.0000000 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000000 1.0000000 1.000e+00 1.000e+00 1.000e+00
##                             PC53      PC54      PC55      PC56      PC57
## Standard deviation     2.315e-05 2.086e-05 1.957e-05 8.141e-06 3.925e-06
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00
##                             PC58      PC59      PC60     PC61      PC62
## Standard deviation     3.474e-08 5.994e-09 3.988e-09 7.05e-16 3.222e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.00e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.00e+00 1.000e+00
##                             PC63      PC64      PC65      PC66      PC67
## Standard deviation     2.704e-16 2.607e-16 2.224e-16 1.689e-16 1.273e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00
##                             PC68      PC69      PC70      PC71      PC72
## Standard deviation     1.208e-16 1.208e-16 1.208e-16 1.208e-16 1.208e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00
##                             PC73      PC74      PC75      PC76      PC77
## Standard deviation     1.208e-16 1.208e-16 1.208e-16 1.208e-16 1.208e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00
##                             PC78      PC79      PC80      PC81      PC82
## Standard deviation     1.208e-16 1.208e-16 1.208e-16 1.208e-16 1.208e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00
##                             PC83      PC84      PC85      PC86      PC87
## Standard deviation     1.208e-16 1.208e-16 1.208e-16 1.208e-16 1.208e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00
##                             PC88      PC89      PC90      PC91      PC92
## Standard deviation     1.208e-16 1.208e-16 1.208e-16 1.208e-16 1.208e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00
##                             PC93      PC94      PC95      PC96      PC97
## Standard deviation     1.208e-16 1.208e-16 1.208e-16 1.208e-16 1.208e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00
##                             PC98      PC99     PC100     PC101     PC102
## Standard deviation     1.208e-16 1.208e-16 1.208e-16 1.208e-16 1.208e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00
##                            PC103     PC104     PC105     PC106     PC107
## Standard deviation     1.208e-16 1.208e-16 1.208e-16 1.208e-16 1.208e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00
##                            PC108     PC109     PC110     PC111     PC112
## Standard deviation     1.208e-16 1.208e-16 1.208e-16 1.208e-16 1.208e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00
##                            PC113     PC114     PC115     PC116     PC117
## Standard deviation     1.208e-16 1.208e-16 1.208e-16 1.208e-16 1.208e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00
##                            PC118     PC119     PC120     PC121     PC122
## Standard deviation     1.208e-16 1.208e-16 1.208e-16 1.208e-16 1.208e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00
##                            PC123     PC124     PC125     PC126     PC127
## Standard deviation     1.208e-16 1.208e-16 1.208e-16 1.208e-16 1.208e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00
##                            PC128     PC129     PC130     PC131     PC132
## Standard deviation     1.208e-16 1.208e-16 1.208e-16 1.208e-16 1.208e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00
##                            PC133     PC134     PC135     PC136     PC137
## Standard deviation     1.208e-16 1.208e-16 1.208e-16 1.208e-16 1.208e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00
##                            PC138     PC139     PC140     PC141     PC142
## Standard deviation     1.208e-16 1.208e-16 1.208e-16 1.208e-16 1.208e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00
##                            PC143     PC144
## Standard deviation     7.322e-17 2.437e-17
## Proportion of Variance 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00</code></pre>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="actualización-del-modelo.html#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pca<span class="sc">$</span>x,<span class="at">col=</span>setas_train.olor<span class="sc">$</span>Letalidad<span class="sc">+</span><span class="dv">1</span>,<span class="at">pch=</span><span class="dv">19</span>)</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/pca%20olor-1.png" width="672" /></p>
<p>Con solo las dos primeras componentes principales explicamos un 74% de la variabilidad de los datos, es decir un nivel parecido que teníamos en análsis anteriores.</p>
<p>En la gráfica que enfrenta las dos primeras componentes principales vemos que las setas venenosas están ubicadas en grupos pequeños, mientras que hay algunas comestibles más esparcidas.</p>
<p>Transformamos nuestro datos calculándo la medida Dice en el conjunto de datos de test y validación, esto permite utilizar la distancia euclínea en los algoritmos posteriores.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="actualización-del-modelo.html#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Datos train:</span></span>
<span id="cb228-2"><a href="actualización-del-modelo.html#cb228-2" aria-hidden="true" tabindex="-1"></a>setas.dice_train.olor<span class="ot">=</span>distancia_dice.olor</span>
<span id="cb228-3"><a href="actualización-del-modelo.html#cb228-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(setas.dice_train.olor)<span class="ot">=</span><span class="fu">rownames</span>(setas_train.olor)</span>
<span id="cb228-4"><a href="actualización-del-modelo.html#cb228-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(setas.dice_train.olor)<span class="ot">=</span><span class="fu">rownames</span>(setas_train.olor)</span>
<span id="cb228-5"><a href="actualización-del-modelo.html#cb228-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-6"><a href="actualización-del-modelo.html#cb228-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Datos test:</span></span>
<span id="cb228-7"><a href="actualización-del-modelo.html#cb228-7" aria-hidden="true" tabindex="-1"></a>setas_test.olor_train<span class="ot">=</span><span class="fu">rbind</span>(setas_train.olor,setas_test.olor)</span>
<span id="cb228-8"><a href="actualización-del-modelo.html#cb228-8" aria-hidden="true" tabindex="-1"></a>setas.dice_test.olor<span class="ot">=</span><span class="fu">distance</span>(setas_test.olor_train[,<span class="dv">2</span><span class="sc">:</span><span class="fu">dim</span>(setas_test.olor)[<span class="dv">2</span>]],<span class="at">method=</span><span class="st">&quot;dice&quot;</span>)</span>
<span id="cb228-9"><a href="actualización-del-modelo.html#cb228-9" aria-hidden="true" tabindex="-1"></a>setas.dice_test.olor<span class="ot">=</span>setas.dice_test.olor[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(setas_train.olor)[<span class="dv">1</span>]),<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(setas_train.olor)[<span class="dv">1</span>])]</span>
<span id="cb228-10"><a href="actualización-del-modelo.html#cb228-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(setas.dice_test.olor)<span class="ot">=</span><span class="fu">rownames</span>(setas_train.olor)</span>
<span id="cb228-11"><a href="actualización-del-modelo.html#cb228-11" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(setas.dice_test.olor)<span class="ot">=</span><span class="fu">rownames</span>(setas_test.olor)</span>
<span id="cb228-12"><a href="actualización-del-modelo.html#cb228-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-13"><a href="actualización-del-modelo.html#cb228-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Datos validation:</span></span>
<span id="cb228-14"><a href="actualización-del-modelo.html#cb228-14" aria-hidden="true" tabindex="-1"></a>setas_validacion.olor_train<span class="ot">=</span><span class="fu">rbind</span>(setas_train.olor,setas_validacion.olor)</span>
<span id="cb228-15"><a href="actualización-del-modelo.html#cb228-15" aria-hidden="true" tabindex="-1"></a>setas.dice_validacion.olor<span class="ot">=</span><span class="fu">distance</span>(setas_validacion.olor_train[,<span class="dv">2</span><span class="sc">:</span><span class="fu">dim</span>(setas_validacion.olor)[<span class="dv">2</span>]],<span class="at">method=</span><span class="st">&quot;dice&quot;</span>)</span>
<span id="cb228-16"><a href="actualización-del-modelo.html#cb228-16" aria-hidden="true" tabindex="-1"></a>setas.dice_validacion.olor<span class="ot">=</span>setas.dice_validacion.olor[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(setas_train.olor)[<span class="dv">1</span>]),<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(setas_train.olor)[<span class="dv">1</span>])]</span>
<span id="cb228-17"><a href="actualización-del-modelo.html#cb228-17" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(setas.dice_validacion.olor)<span class="ot">=</span><span class="fu">rownames</span>(setas_train.olor)</span>
<span id="cb228-18"><a href="actualización-del-modelo.html#cb228-18" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(setas.dice_validacion.olor)<span class="ot">=</span><span class="fu">rownames</span>(setas_validacion.olor)</span></code></pre></div>
<div id="análisis-cluster-1" class="section level3" number="8.2.1">
<h3><span class="header-section-number">8.2.1</span> Análisis Cluster</h3>
<p>Aplicamos el análsis cluster a nuestros datos con el objetivo de tener grupos de setas que contengas solo setas venenosas o comestibles, pero primero vemos por cross-validation el número adecuado de cluster a aplicar.</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="actualización-del-modelo.html#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Números de clusters</span></span>
<span id="cb229-2"><a href="actualización-del-modelo.html#cb229-2" aria-hidden="true" tabindex="-1"></a>SSW <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;numeric&quot;</span>, <span class="at">length =</span> <span class="dv">15</span>)</span>
<span id="cb229-3"><a href="actualización-del-modelo.html#cb229-3" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="fu">dim</span>(<span class="fu">prcomp</span>(setas.dice_validacion.olor)<span class="sc">$</span>x)[<span class="dv">1</span>]</span>
<span id="cb229-4"><a href="actualización-del-modelo.html#cb229-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Variabilidad de todos los datos, es decir, todos los datos como un único cluster</span></span>
<span id="cb229-5"><a href="actualización-del-modelo.html#cb229-5" aria-hidden="true" tabindex="-1"></a>SSW[<span class="dv">1</span>] <span class="ot">&lt;-</span> (n <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">apply</span>(<span class="fu">prcomp</span>(setas.dice_validacion.olor)<span class="sc">$</span>x,<span class="dv">2</span>,var)) </span>
<span id="cb229-6"><a href="actualización-del-modelo.html#cb229-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-7"><a href="actualización-del-modelo.html#cb229-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Variabilidad de cada modelo, desde 2 clusters hasta 15 clusters</span></span>
<span id="cb229-8"><a href="actualización-del-modelo.html#cb229-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">15</span>) SSW[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">kmeans</span>(<span class="fu">prcomp</span>(setas.dice_validacion.olor)<span class="sc">$</span>x,<span class="at">centers=</span>i,<span class="at">nstart=</span><span class="dv">25</span>)<span class="sc">$</span>withinss)</span>
<span id="cb229-9"><a href="actualización-del-modelo.html#cb229-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-10"><a href="actualización-del-modelo.html#cb229-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Dibujamos un gráfico con el resultado</span></span>
<span id="cb229-11"><a href="actualización-del-modelo.html#cb229-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>, SSW, <span class="at">type=</span><span class="st">&quot;b&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;Número de clusters&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Suma de cuadrados de los grupos&quot;</span>,<span class="at">pch=</span><span class="dv">19</span>, <span class="at">col=</span><span class="st">&quot;steelblue4&quot;</span>)</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/cluster%20sin%20olor%20olor-1.png" width="672" /></p>
<p>En el gráfico podemos observar que a partir del aplicar 5 o 6 clusters a nuestros datos la suma de los cuadrados se reduce en menor medida, por ello realizamos el análisis con ese número de clusters.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="actualización-del-modelo.html#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Análisis cluster</span></span>
<span id="cb230-2"><a href="actualización-del-modelo.html#cb230-2" aria-hidden="true" tabindex="-1"></a>clusters.datos.olor<span class="ot">=</span><span class="fu">kmeans</span>(pca<span class="sc">$</span>x,<span class="at">centers=</span><span class="dv">6</span>,<span class="at">nstart=</span><span class="dv">25</span>)</span>
<span id="cb230-3"><a href="actualización-del-modelo.html#cb230-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(clusters.datos.olor<span class="sc">$</span>cluster,setas_train.olor<span class="sc">$</span>Letalidad)</span></code></pre></div>
<pre><code>##    
##      0  1
##   1 45  0
##   2  0 48
##   3  9  0
##   4  0  4
##   5 16  0
##   6  2 20</code></pre>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="actualización-del-modelo.html#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Gráfico de los cluster</span></span>
<span id="cb232-2"><a href="actualización-del-modelo.html#cb232-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pca<span class="sc">$</span>x,<span class="at">main=</span><span class="st">&quot;Clusters&quot;</span>,<span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb232-3"><a href="actualización-del-modelo.html#cb232-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(setas_train.olor)[<span class="dv">1</span>]){</span>
<span id="cb232-4"><a href="actualización-del-modelo.html#cb232-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(pca<span class="sc">$</span>x[i,<span class="dv">1</span>],pca<span class="sc">$</span>x[i,<span class="dv">2</span>],<span class="at">pch=</span><span class="dv">19</span>,<span class="at">col=</span>clusters.datos.olor<span class="sc">$</span>cluster[i]<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb232-5"><a href="actualización-del-modelo.html#cb232-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb232-6"><a href="actualización-del-modelo.html#cb232-6" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,   </span>
<span id="cb232-7"><a href="actualización-del-modelo.html#cb232-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">inset =</span> <span class="fl">0.01</span>, </span>
<span id="cb232-8"><a href="actualización-del-modelo.html#cb232-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>),</span>
<span id="cb232-9"><a href="actualización-del-modelo.html#cb232-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">fil =</span> <span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">7</span>))</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/grafico%20cluster%206%20olor-1.png" width="672" /></p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="actualización-del-modelo.html#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Gráfico por tipo de setas:</span></span>
<span id="cb233-2"><a href="actualización-del-modelo.html#cb233-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb233-3"><a href="actualización-del-modelo.html#cb233-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pca<span class="sc">$</span>x,<span class="at">main=</span><span class="st">&quot;Clusters: setas comestibles&quot;</span>,<span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb233-4"><a href="actualización-del-modelo.html#cb233-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(setas_train.olor)[<span class="dv">1</span>]){</span>
<span id="cb233-5"><a href="actualización-del-modelo.html#cb233-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(setas_train.olor[i,<span class="dv">1</span>]<span class="sc">==</span><span class="dv">0</span>){</span>
<span id="cb233-6"><a href="actualización-del-modelo.html#cb233-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(pca<span class="sc">$</span>x[i,<span class="dv">1</span>],pca<span class="sc">$</span>x[i,<span class="dv">2</span>],<span class="at">pch=</span><span class="dv">19</span>,<span class="at">col=</span>clusters.datos.olor<span class="sc">$</span>cluster[i]<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb233-7"><a href="actualización-del-modelo.html#cb233-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb233-8"><a href="actualización-del-modelo.html#cb233-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb233-9"><a href="actualización-del-modelo.html#cb233-9" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,   </span>
<span id="cb233-10"><a href="actualización-del-modelo.html#cb233-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">inset =</span> <span class="fl">0.01</span>, </span>
<span id="cb233-11"><a href="actualización-del-modelo.html#cb233-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>),</span>
<span id="cb233-12"><a href="actualización-del-modelo.html#cb233-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">fil =</span> <span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">7</span>))</span>
<span id="cb233-13"><a href="actualización-del-modelo.html#cb233-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pca<span class="sc">$</span>x,<span class="at">main=</span><span class="st">&quot;Clusters: setas venenosas&quot;</span>,<span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb233-14"><a href="actualización-del-modelo.html#cb233-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(setas_train.olor)[<span class="dv">1</span>]){</span>
<span id="cb233-15"><a href="actualización-del-modelo.html#cb233-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(setas_train.olor[i,<span class="dv">1</span>]<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb233-16"><a href="actualización-del-modelo.html#cb233-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(pca<span class="sc">$</span>x[i,<span class="dv">1</span>],pca<span class="sc">$</span>x[i,<span class="dv">2</span>],<span class="at">pch=</span><span class="dv">19</span>,<span class="at">col=</span>clusters.datos.olor<span class="sc">$</span>cluster[i]<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb233-17"><a href="actualización-del-modelo.html#cb233-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb233-18"><a href="actualización-del-modelo.html#cb233-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb233-19"><a href="actualización-del-modelo.html#cb233-19" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,   </span>
<span id="cb233-20"><a href="actualización-del-modelo.html#cb233-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">inset =</span> <span class="fl">0.01</span>, </span>
<span id="cb233-21"><a href="actualización-del-modelo.html#cb233-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>),</span>
<span id="cb233-22"><a href="actualización-del-modelo.html#cb233-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">fil =</span> <span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">7</span>))</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/grafico%20cluster%206%20olor-2.png" width="672" /></p>
<p>Hemos conseguido una muy buena clasificación de las setas, solos un cluster tienen setas mezcladas, hay dos setas comestibles dentro de un cluster de setas venenosas. Quizás aumentando el número de cluster podamos clasificar correctamente estas pocas setas.</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="actualización-del-modelo.html#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Análisis cluster</span></span>
<span id="cb234-2"><a href="actualización-del-modelo.html#cb234-2" aria-hidden="true" tabindex="-1"></a>clusters.datos.train.olor<span class="ot">=</span><span class="fu">kmeans</span>(pca<span class="sc">$</span>x,<span class="at">centers=</span><span class="dv">8</span>,<span class="at">nstart=</span><span class="dv">25</span>)</span>
<span id="cb234-3"><a href="actualización-del-modelo.html#cb234-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(clusters.datos.train.olor<span class="sc">$</span>cluster,setas_train.olor<span class="sc">$</span>Letalidad)</span></code></pre></div>
<pre><code>##    
##      0  1
##   1 11  0
##   2  9  0
##   3  5  6
##   4  2 20
##   5  0  4
##   6 27  0
##   7  0 42
##   8 18  0</code></pre>
<p>Seguimos sin poder separar las setas que no estaban en su debido cluster en el análisis con 6 clusters, además de que ha aparecido otro cluster con setas mezcladas.</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="actualización-del-modelo.html#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Gráfico de los cluster</span></span>
<span id="cb236-2"><a href="actualización-del-modelo.html#cb236-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pca<span class="sc">$</span>x,<span class="at">main=</span><span class="st">&quot;Clusters&quot;</span>,<span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb236-3"><a href="actualización-del-modelo.html#cb236-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(setas_train.olor)[<span class="dv">1</span>]){</span>
<span id="cb236-4"><a href="actualización-del-modelo.html#cb236-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(pca<span class="sc">$</span>x[i,<span class="dv">1</span>],pca<span class="sc">$</span>x[i,<span class="dv">2</span>],<span class="at">pch=</span><span class="dv">19</span>,<span class="at">col=</span>clusters.datos.train.olor<span class="sc">$</span>cluster[i]<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb236-5"><a href="actualización-del-modelo.html#cb236-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb236-6"><a href="actualización-del-modelo.html#cb236-6" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,   </span>
<span id="cb236-7"><a href="actualización-del-modelo.html#cb236-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">inset =</span> <span class="fl">0.01</span>, </span>
<span id="cb236-8"><a href="actualización-del-modelo.html#cb236-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>),</span>
<span id="cb236-9"><a href="actualización-del-modelo.html#cb236-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">fil =</span> <span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">9</span>))</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/grafico%20cluster%208%20olor-1.png" width="672" /></p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="actualización-del-modelo.html#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Gráfico por tipo de setas:</span></span>
<span id="cb237-2"><a href="actualización-del-modelo.html#cb237-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb237-3"><a href="actualización-del-modelo.html#cb237-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pca<span class="sc">$</span>x,<span class="at">main=</span><span class="st">&quot;Clusters: setas comestibles&quot;</span>,<span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb237-4"><a href="actualización-del-modelo.html#cb237-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(setas_train.olor)[<span class="dv">1</span>]){</span>
<span id="cb237-5"><a href="actualización-del-modelo.html#cb237-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(setas_train.olor[i,<span class="dv">1</span>]<span class="sc">==</span><span class="dv">0</span>){</span>
<span id="cb237-6"><a href="actualización-del-modelo.html#cb237-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(pca<span class="sc">$</span>x[i,<span class="dv">1</span>],pca<span class="sc">$</span>x[i,<span class="dv">2</span>],<span class="at">pch=</span><span class="dv">19</span>,<span class="at">col=</span>clusters.datos.train.olor<span class="sc">$</span>cluster[i]<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb237-7"><a href="actualización-del-modelo.html#cb237-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb237-8"><a href="actualización-del-modelo.html#cb237-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb237-9"><a href="actualización-del-modelo.html#cb237-9" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,   </span>
<span id="cb237-10"><a href="actualización-del-modelo.html#cb237-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">inset =</span> <span class="fl">0.01</span>, </span>
<span id="cb237-11"><a href="actualización-del-modelo.html#cb237-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>),</span>
<span id="cb237-12"><a href="actualización-del-modelo.html#cb237-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">fil =</span> <span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">9</span>))</span>
<span id="cb237-13"><a href="actualización-del-modelo.html#cb237-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pca<span class="sc">$</span>x,<span class="at">main=</span><span class="st">&quot;Clusters: setas venenosas&quot;</span>,<span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb237-14"><a href="actualización-del-modelo.html#cb237-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(setas_train.olor)[<span class="dv">1</span>]){</span>
<span id="cb237-15"><a href="actualización-del-modelo.html#cb237-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(setas_train.olor[i,<span class="dv">1</span>]<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb237-16"><a href="actualización-del-modelo.html#cb237-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(pca<span class="sc">$</span>x[i,<span class="dv">1</span>],pca<span class="sc">$</span>x[i,<span class="dv">2</span>],<span class="at">pch=</span><span class="dv">19</span>,<span class="at">col=</span>clusters.datos.train.olor<span class="sc">$</span>cluster[i]<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb237-17"><a href="actualización-del-modelo.html#cb237-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb237-18"><a href="actualización-del-modelo.html#cb237-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb237-19"><a href="actualización-del-modelo.html#cb237-19" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,   </span>
<span id="cb237-20"><a href="actualización-del-modelo.html#cb237-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">inset =</span> <span class="fl">0.01</span>, </span>
<span id="cb237-21"><a href="actualización-del-modelo.html#cb237-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>),</span>
<span id="cb237-22"><a href="actualización-del-modelo.html#cb237-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">fil =</span> <span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">9</span>))</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/grafico%20cluster%208%20olor-2.png" width="672" /></p>
<p>Luego no mejorar nada, por lo que nos quedamos con el análisis más parsimonioso.</p>
</div>
<div id="k-nn-2" class="section level3" number="8.2.2">
<h3><span class="header-section-number">8.2.2</span> k-NN</h3>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="actualización-del-modelo.html#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Buscamos los vecinos más cercanos</span></span>
<span id="cb238-2"><a href="actualización-del-modelo.html#cb238-2" aria-hidden="true" tabindex="-1"></a>prediccion_knn.olor<span class="ot">=</span><span class="fu">knn</span>(setas.dice_train.olor,setas.dice_test.olor,<span class="at">cl=</span>setas_train.olor<span class="sc">$</span>Letalidad,<span class="at">k=</span><span class="dv">1</span>)</span>
<span id="cb238-3"><a href="actualización-del-modelo.html#cb238-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(prediccion_knn.olor,setas_test.olor<span class="sc">$</span>Letalidad)</span></code></pre></div>
<pre><code>##                    
## prediccion_knn.olor  0  1
##                   0 23  0
##                   1  1 24</code></pre>
<p>La predicción con el 1-vecino más próximo, se equivoca muy poco, predice una seta como venenosa cuando es comestible, lo que no supondría un problema. Aplicamos un análisis con distintas medidas de precisión.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="actualización-del-modelo.html#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exactitud/Error</span></span>
<span id="cb240-2"><a href="actualización-del-modelo.html#cb240-2" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">=</span> <span class="fu">sum</span>(prediccion_knn.olor <span class="sc">==</span> setas_test.olor<span class="sc">$</span>Letalidad)<span class="sc">/</span><span class="fu">nrow</span>(setas_test.olor)</span>
<span id="cb240-3"><a href="actualización-del-modelo.html#cb240-3" aria-hidden="true" tabindex="-1"></a>error <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span>accuracy</span>
<span id="cb240-4"><a href="actualización-del-modelo.html#cb240-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-5"><a href="actualización-del-modelo.html#cb240-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas VENENOSAS, sensitivity o recall</span></span>
<span id="cb240-6"><a href="actualización-del-modelo.html#cb240-6" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="ot">=</span> <span class="fu">sum</span>((prediccion_knn.olor <span class="sc">==</span> setas_test.olor<span class="sc">$</span>Letalidad) <span class="sc">&amp;</span> (setas_test.olor<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.olor<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb240-7"><a href="actualización-del-modelo.html#cb240-7" aria-hidden="true" tabindex="-1"></a>recall <span class="ot">=</span> sensitivity</span>
<span id="cb240-8"><a href="actualización-del-modelo.html#cb240-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-9"><a href="actualización-del-modelo.html#cb240-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas COMESTIBLES</span></span>
<span id="cb240-10"><a href="actualización-del-modelo.html#cb240-10" aria-hidden="true" tabindex="-1"></a>specificity <span class="ot">=</span>  <span class="fu">sum</span>(prediccion_knn.olor <span class="sc">==</span> setas_test.olor<span class="sc">$</span>Letalidad <span class="sc">&amp;</span> setas_test.olor<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.olor<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb240-11"><a href="actualización-del-modelo.html#cb240-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-12"><a href="actualización-del-modelo.html#cb240-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es VENENOSAS</span></span>
<span id="cb240-13"><a href="actualización-del-modelo.html#cb240-13" aria-hidden="true" tabindex="-1"></a>precision <span class="ot">=</span> <span class="fu">sum</span>( (prediccion_knn.olor<span class="sc">==</span> setas_test.olor<span class="sc">$</span>Letalidad) <span class="sc">&amp;</span> (prediccion_knn.olor <span class="sc">==</span> <span class="dv">1</span>))<span class="sc">/</span> <span class="fu">sum</span>(prediccion_knn.olor <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb240-14"><a href="actualización-del-modelo.html#cb240-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-15"><a href="actualización-del-modelo.html#cb240-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es COMESTIBLE</span></span>
<span id="cb240-16"><a href="actualización-del-modelo.html#cb240-16" aria-hidden="true" tabindex="-1"></a>npv <span class="ot">=</span> <span class="fu">sum</span>(prediccion_knn.olor <span class="sc">==</span> setas_test.olor<span class="sc">$</span>Letalidad <span class="sc">&amp;</span> prediccion_knn.olor <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(prediccion_knn.olor <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb240-17"><a href="actualización-del-modelo.html#cb240-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-18"><a href="actualización-del-modelo.html#cb240-18" aria-hidden="true" tabindex="-1"></a><span class="co"># F1_score</span></span>
<span id="cb240-19"><a href="actualización-del-modelo.html#cb240-19" aria-hidden="true" tabindex="-1"></a>f1score <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>precision<span class="sc">*</span>recall <span class="sc">/</span>(precision<span class="sc">+</span>recall)</span>
<span id="cb240-20"><a href="actualización-del-modelo.html#cb240-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-21"><a href="actualización-del-modelo.html#cb240-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla de medidas de precisión</span></span>
<span id="cb240-22"><a href="actualización-del-modelo.html#cb240-22" aria-hidden="true" tabindex="-1"></a>medidas.knn.olor<span class="ot">=</span><span class="fu">c</span>(<span class="at">accuracy =</span> accuracy, <span class="at">error =</span> error, <span class="at">sensitivity =</span> sensitivity, <span class="at">specificity =</span> specificity, <span class="at">precision =</span> precision, <span class="at">npv =</span> npv, <span class="at">f1=</span>f1score)</span>
<span id="cb240-23"><a href="actualización-del-modelo.html#cb240-23" aria-hidden="true" tabindex="-1"></a>medidas.knn.olor</span></code></pre></div>
<pre><code>##    accuracy       error sensitivity specificity   precision         npv 
##  0.97916667  0.02083333  1.00000000  0.95833333  0.96000000  1.00000000 
##          f1 
##  0.97959184</code></pre>
<p>Pero vamos a probar a calcular todas estas medidas con un número distinto de vecinos más cercano, por si a caso obtuviesemos resultados parecidos.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="actualización-del-modelo.html#cb242-1" aria-hidden="true" tabindex="-1"></a>k<span class="ot">=</span>(<span class="fu">dim</span>(setas_train.olor)[<span class="dv">1</span>]<span class="sc">^</span>(<span class="dv">4</span><span class="sc">/</span>(<span class="dv">4</span><span class="sc">+</span><span class="fu">dim</span>(setas_train.olor)[<span class="dv">2</span>])))<span class="sc">*</span><span class="dv">10</span></span>
<span id="cb242-2"><a href="actualización-del-modelo.html#cb242-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-3"><a href="actualización-del-modelo.html#cb242-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Matriz de las medidas de precision:</span></span>
<span id="cb242-4"><a href="actualización-del-modelo.html#cb242-4" aria-hidden="true" tabindex="-1"></a>medidas_presicision<span class="ot">=</span><span class="fu">matrix</span>(<span class="at">nrow=</span><span class="fu">round</span>(k),<span class="at">ncol=</span><span class="dv">7</span>)</span>
<span id="cb242-5"><a href="actualización-del-modelo.html#cb242-5" aria-hidden="true" tabindex="-1"></a>nombres_medidas<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;accuracy&quot;</span>, <span class="st">&quot;error&quot;</span>, <span class="st">&quot;sensitivity&quot;</span>, <span class="st">&quot;specificity&quot;</span>, <span class="st">&quot;precision&quot;</span>, <span class="st">&quot;npv&quot;</span>, <span class="st">&quot;f1score&quot;</span>)</span>
<span id="cb242-6"><a href="actualización-del-modelo.html#cb242-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(medidas_presicision)<span class="ot">=</span>nombres_medidas</span>
<span id="cb242-7"><a href="actualización-del-modelo.html#cb242-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(medidas_presicision)<span class="ot">=</span><span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">round</span>(k),<span class="dv">1</span>)</span>
<span id="cb242-8"><a href="actualización-del-modelo.html#cb242-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">round</span>(k)){</span>
<span id="cb242-9"><a href="actualización-del-modelo.html#cb242-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb242-10"><a href="actualización-del-modelo.html#cb242-10" aria-hidden="true" tabindex="-1"></a>  prediccion_knn<span class="ot">=</span><span class="fu">knn</span>(setas.dice_train.olor,setas.dice_test.olor,<span class="at">cl=</span>setas_train.olor<span class="sc">$</span>Letalidad,<span class="at">k=</span>i)</span>
<span id="cb242-11"><a href="actualización-del-modelo.html#cb242-11" aria-hidden="true" tabindex="-1"></a>  medidas_presicision[i,<span class="dv">1</span>] <span class="ot">=</span> <span class="fu">sum</span>(prediccion_knn <span class="sc">==</span> setas_test.olor<span class="sc">$</span>Letalidad)<span class="sc">/</span><span class="fu">nrow</span>(setas.dice_test.olor)</span>
<span id="cb242-12"><a href="actualización-del-modelo.html#cb242-12" aria-hidden="true" tabindex="-1"></a>  medidas_presicision[i,<span class="dv">2</span>] <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span>medidas_presicision[i,<span class="dv">1</span>]</span>
<span id="cb242-13"><a href="actualización-del-modelo.html#cb242-13" aria-hidden="true" tabindex="-1"></a>  medidas_presicision[i,<span class="dv">3</span>] <span class="ot">=</span> <span class="fu">sum</span>((prediccion_knn <span class="sc">==</span> setas_test.olor<span class="sc">$</span>Letalidad) <span class="sc">&amp;</span> (setas_test.olor<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">/</span><span class="fu">sum</span>(setas_test.olor<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb242-14"><a href="actualización-del-modelo.html#cb242-14" aria-hidden="true" tabindex="-1"></a>  medidas_presicision[i,<span class="dv">4</span>] <span class="ot">=</span>  <span class="fu">sum</span>(prediccion_knn <span class="sc">==</span> setas_test.olor<span class="sc">$</span>Letalidad <span class="sc">&amp;</span> setas_test.olor<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.olor<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb242-15"><a href="actualización-del-modelo.html#cb242-15" aria-hidden="true" tabindex="-1"></a>  medidas_presicision[i,<span class="dv">5</span>] <span class="ot">=</span> <span class="fu">sum</span>( (prediccion_knn<span class="sc">==</span> setas_test.olor<span class="sc">$</span>Letalidad) <span class="sc">&amp;</span> (prediccion_knn <span class="sc">==</span> <span class="dv">1</span>))<span class="sc">/</span> <span class="fu">sum</span>(prediccion_knn <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb242-16"><a href="actualización-del-modelo.html#cb242-16" aria-hidden="true" tabindex="-1"></a>  medidas_presicision[i,<span class="dv">6</span>] <span class="ot">=</span> <span class="fu">sum</span>(prediccion_knn <span class="sc">==</span> setas_test.olor<span class="sc">$</span>Letalidad <span class="sc">&amp;</span> prediccion_knn <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(prediccion_knn <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb242-17"><a href="actualización-del-modelo.html#cb242-17" aria-hidden="true" tabindex="-1"></a>  medidas_presicision[i,<span class="dv">7</span>] <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>medidas_presicision[i,<span class="dv">5</span>]<span class="sc">*</span>medidas_presicision[i,<span class="dv">3</span>] <span class="sc">/</span>(medidas_presicision[i,<span class="dv">5</span>]<span class="sc">+</span>medidas_presicision[i,<span class="dv">3</span>])</span>
<span id="cb242-18"><a href="actualización-del-modelo.html#cb242-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb242-19"><a href="actualización-del-modelo.html#cb242-19" aria-hidden="true" tabindex="-1"></a>medidas_presicision</span></code></pre></div>
<pre><code>##     accuracy      error sensitivity specificity precision npv   f1score
## 1  0.9791667 0.02083333           1   0.9583333 0.9600000   1 0.9795918
## 2  0.9166667 0.08333333           1   0.8333333 0.8571429   1 0.9230769
## 3  0.9166667 0.08333333           1   0.8333333 0.8571429   1 0.9230769
## 4  0.9166667 0.08333333           1   0.8333333 0.8571429   1 0.9230769
## 5  0.9375000 0.06250000           1   0.8750000 0.8888889   1 0.9411765
## 6  0.9375000 0.06250000           1   0.8750000 0.8888889   1 0.9411765
## 7  0.9375000 0.06250000           1   0.8750000 0.8888889   1 0.9411765
## 8  0.9375000 0.06250000           1   0.8750000 0.8888889   1 0.9411765
## 9  0.9375000 0.06250000           1   0.8750000 0.8888889   1 0.9411765
## 10 0.9375000 0.06250000           1   0.8750000 0.8888889   1 0.9411765
## 11 0.9375000 0.06250000           1   0.8750000 0.8888889   1 0.9411765
## 12 0.9583333 0.04166667           1   0.9166667 0.9230769   1 0.9600000</code></pre>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="actualización-del-modelo.html#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Grafico de las medidas de precision</span></span>
<span id="cb244-2"><a href="actualización-del-modelo.html#cb244-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">round</span>(k)),medidas_presicision[,<span class="dv">1</span>],<span class="at">main=</span><span class="st">&quot;Medidas de precision&quot;</span>,<span class="at">type=</span><span class="st">&quot;n&quot;</span>,<span class="at">xlab=</span><span class="st">&quot;Número de k vecinos&quot;</span>,<span class="at">ylab=</span><span class="st">&quot;&quot;</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="fu">round</span>(k)<span class="sc">+</span><span class="dv">2</span>))</span>
<span id="cb244-3"><a href="actualización-del-modelo.html#cb244-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) {</span>
<span id="cb244-4"><a href="actualización-del-modelo.html#cb244-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(<span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">round</span>(k)),medidas_presicision[,i],<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">col=</span>i<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb244-5"><a href="actualización-del-modelo.html#cb244-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">round</span>(k)),medidas_presicision[,i],<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">col=</span>i<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb244-6"><a href="actualización-del-modelo.html#cb244-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb244-7"><a href="actualización-del-modelo.html#cb244-7" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,   </span>
<span id="cb244-8"><a href="actualización-del-modelo.html#cb244-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">inset =</span> <span class="fl">0.01</span>, </span>
<span id="cb244-9"><a href="actualización-del-modelo.html#cb244-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Ac&quot;</span>,<span class="st">&quot;Er&quot;</span>, <span class="st">&quot;Se&quot;</span>,<span class="st">&quot;Sp&quot;</span>,<span class="st">&quot;Pr&quot;</span>,<span class="st">&quot;NPV&quot;</span>,<span class="st">&quot;F1&quot;</span>),</span>
<span id="cb244-10"><a href="actualización-del-modelo.html#cb244-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">fil =</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="fu">round</span>(k)<span class="sc">+</span><span class="dv">1</span>))</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/knn%20cross-validation%20olor-1.png" width="672" /></p>
<p>Observamos que al ir aumentando el número de k-vecinos el error ha aumentando pero sigue siendo muy pequeño, el mayor error cometido con el número de k-vecinos probado es de 8%.</p>
</div>
<div id="arboles-de-decisión-2" class="section level3" number="8.2.3">
<h3><span class="header-section-number">8.2.3</span> Arboles de Decisión</h3>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="actualización-del-modelo.html#cb245-1" aria-hidden="true" tabindex="-1"></a>setas_train.olor.data<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">cbind</span>(setas_train.olor<span class="sc">$</span>Letalidad,setas.dice_train.olor))</span>
<span id="cb245-2"><a href="actualización-del-modelo.html#cb245-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(setas_train.olor.data)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;Letalidad&quot;</span>,<span class="fu">rownames</span>(setas_train.olor))</span>
<span id="cb245-3"><a href="actualización-del-modelo.html#cb245-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Árbol de decisión:</span></span>
<span id="cb245-4"><a href="actualización-del-modelo.html#cb245-4" aria-hidden="true" tabindex="-1"></a>arbol.olor<span class="ot">=</span><span class="fu">rpart</span>(<span class="fu">as.factor</span>(setas_train.olor.data<span class="sc">$</span>Letalidad)<span class="sc">~</span>., <span class="at">data=</span>setas_train.olor.data,<span class="at">method=</span><span class="st">&quot;class&quot;</span>)</span>
<span id="cb245-5"><a href="actualización-del-modelo.html#cb245-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(arbol.olor)</span></code></pre></div>
<pre><code>## Call:
## rpart(formula = as.factor(setas_train.olor.data$Letalidad) ~ 
##     ., data = setas_train.olor.data, method = &quot;class&quot;)
##   n= 144 
## 
##           CP nsplit  rel error    xerror       xstd
## 1 0.69444444      0 1.00000000 1.2222222 0.08124967
## 2 0.18055556      1 0.30555556 0.3194444 0.06105804
## 3 0.04166667      2 0.12500000 0.2222222 0.05237828
## 4 0.01000000      3 0.08333333 0.1250000 0.04034358
## 
## Variable importance
## 1822 1689 1623  445  738 1132 2776 2969 2733 2753 2762 2924 3497 3011 3177 3189 
##   11   11   11   11   11   11    5    5    4    4    4    4    2    1    1    1 
## 3413 3451 
##    1    1 
## 
## Node number 1: 144 observations,    complexity param=0.6944444
##   predicted class=0  expected loss=0.5  P(node) =1
##     class counts:    72    72
##    probabilities: 0.500 0.500 
##   left son=2 (50 obs) right son=3 (94 obs)
##   Primary splits:
##       1822 &lt; 0.4920509 to the left,  improve=38.29787, (0 missing)
##       1689 &lt; 0.4920509 to the left,  improve=37.13684, (0 missing)
##       445  &lt; 0.4996139 to the left,  improve=36.00000, (0 missing)
##       738  &lt; 0.5552124 to the left,  improve=36.00000, (0 missing)
##       1623 &lt; 0.5552124 to the left,  improve=36.00000, (0 missing)
##   Surrogate splits:
##       1689 &lt; 0.4920509 to the left,  agree=0.993, adj=0.98, (0 split)
##       445  &lt; 0.4996139 to the left,  agree=0.986, adj=0.96, (0 split)
##       738  &lt; 0.5552124 to the left,  agree=0.986, adj=0.96, (0 split)
##       1623 &lt; 0.5552124 to the left,  agree=0.986, adj=0.96, (0 split)
##       1132 &lt; 0.451952  to the left,  agree=0.979, adj=0.94, (0 split)
## 
## Node number 2: 50 observations
##   predicted class=0  expected loss=0  P(node) =0.3472222
##     class counts:    50     0
##    probabilities: 1.000 0.000 
## 
## Node number 3: 94 observations,    complexity param=0.1805556
##   predicted class=1  expected loss=0.2340426  P(node) =0.6527778
##     class counts:    22    72
##    probabilities: 0.234 0.766 
##   left son=6 (13 obs) right son=7 (81 obs)
##   Primary splits:
##       2776  &lt; 0.739899  to the right, improve=17.70213, (0 missing)
##       2969  &lt; 0.739899  to the right, improve=17.70213, (0 missing)
##       2669  &lt; 0.6922348 to the right, improve=16.14115, (0 missing)
##       25771 &lt; 0.6568627 to the right, improve=16.14115, (0 missing)
##       2807  &lt; 0.6568627 to the right, improve=16.14115, (0 missing)
##   Surrogate splits:
##       2969 &lt; 0.739899  to the right, agree=1.000, adj=1.000, (0 split)
##       2733 &lt; 0.739899  to the right, agree=0.979, adj=0.846, (0 split)
##       2753 &lt; 0.739899  to the right, agree=0.979, adj=0.846, (0 split)
##       2762 &lt; 0.739899  to the right, agree=0.968, adj=0.769, (0 split)
##       2924 &lt; 0.739899  to the right, agree=0.968, adj=0.769, (0 split)
## 
## Node number 6: 13 observations
##   predicted class=0  expected loss=0  P(node) =0.09027778
##     class counts:    13     0
##    probabilities: 1.000 0.000 
## 
## Node number 7: 81 observations,    complexity param=0.04166667
##   predicted class=1  expected loss=0.1111111  P(node) =0.5625
##     class counts:     9    72
##    probabilities: 0.111 0.889 
##   left son=14 (7 obs) right son=15 (74 obs)
##   Primary splits:
##       3497 &lt; 0.5672515 to the left,  improve=5.575290, (0 missing)
##       2673 &lt; 0.6568627 to the right, improve=5.575290, (0 missing)
##       2678 &lt; 0.6568627 to the right, improve=5.575290, (0 missing)
##       2515 &lt; 0.6664093 to the right, improve=5.453521, (0 missing)
##       2487 &lt; 0.6664093 to the right, improve=4.769100, (0 missing)
##   Surrogate splits:
##       3011 &lt; 0.4108187 to the left,  agree=0.975, adj=0.714, (0 split)
##       3451 &lt; 0.3684211 to the left,  agree=0.975, adj=0.714, (0 split)
##       3413 &lt; 0.3684211 to the left,  agree=0.975, adj=0.714, (0 split)
##       3177 &lt; 0.4108187 to the left,  agree=0.975, adj=0.714, (0 split)
##       3189 &lt; 0.3947368 to the left,  agree=0.975, adj=0.714, (0 split)
## 
## Node number 14: 7 observations
##   predicted class=0  expected loss=0.2857143  P(node) =0.04861111
##     class counts:     5     2
##    probabilities: 0.714 0.286 
## 
## Node number 15: 74 observations
##   predicted class=1  expected loss=0.05405405  P(node) =0.5138889
##     class counts:     4    70
##    probabilities: 0.054 0.946</code></pre>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="actualización-del-modelo.html#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(arbol.olor)</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/arbol%20de%20decision%20olor-1.png" width="672" /></p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="actualización-del-modelo.html#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla comparativa:</span></span>
<span id="cb248-2"><a href="actualización-del-modelo.html#cb248-2" aria-hidden="true" tabindex="-1"></a>setas_test.olor.data<span class="ot">=</span><span class="fu">data.frame</span>(setas.dice_test.olor)</span>
<span id="cb248-3"><a href="actualización-del-modelo.html#cb248-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(setas_test.olor.data)<span class="ot">=</span><span class="fu">rownames</span>(setas_train.olor)</span>
<span id="cb248-4"><a href="actualización-del-modelo.html#cb248-4" aria-hidden="true" tabindex="-1"></a>prediccion.arbol.olor<span class="ot">=</span><span class="fu">round</span>(<span class="fu">predict</span>(arbol.olor,setas_test.olor.data)[,<span class="dv">2</span>])</span>
<span id="cb248-5"><a href="actualización-del-modelo.html#cb248-5" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(prediccion.arbol.olor,setas_test.olor[,<span class="dv">1</span>])</span></code></pre></div>
<pre><code>##                      
## prediccion.arbol.olor  0  1
##                     0 19  0
##                     1  5 24</code></pre>
<p>El gráfico resultante podemos interpretarlo basándonos en cuánto se parece una seta al resto, las más importantes como son las observaciones 1822, 1689, 1623, 445, 738 y 1132.</p>
<p>En la tabla podemos ver que a la hora de predecir nuestro árbol de decisión comete cierto error, a continuación analizamos ese error con distintas medidas de precisión.</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="actualización-del-modelo.html#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exactitud/Error</span></span>
<span id="cb250-2"><a href="actualización-del-modelo.html#cb250-2" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">=</span> <span class="fu">sum</span>(prediccion.arbol.olor <span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>])<span class="sc">/</span><span class="fu">nrow</span>(setas.dice_test.olor)</span>
<span id="cb250-3"><a href="actualización-del-modelo.html#cb250-3" aria-hidden="true" tabindex="-1"></a>error <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span>accuracy</span>
<span id="cb250-4"><a href="actualización-del-modelo.html#cb250-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-5"><a href="actualización-del-modelo.html#cb250-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas VENENOSAS, sensitivity o recall</span></span>
<span id="cb250-6"><a href="actualización-del-modelo.html#cb250-6" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="ot">=</span> <span class="fu">sum</span>((prediccion.arbol.olor <span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb250-7"><a href="actualización-del-modelo.html#cb250-7" aria-hidden="true" tabindex="-1"></a>recall <span class="ot">=</span> sensitivity</span>
<span id="cb250-8"><a href="actualización-del-modelo.html#cb250-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-9"><a href="actualización-del-modelo.html#cb250-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas COMESTIBLES</span></span>
<span id="cb250-10"><a href="actualización-del-modelo.html#cb250-10" aria-hidden="true" tabindex="-1"></a>specificity <span class="ot">=</span>  <span class="fu">sum</span>(prediccion.arbol.olor <span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb250-11"><a href="actualización-del-modelo.html#cb250-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-12"><a href="actualización-del-modelo.html#cb250-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es VENENOSAS</span></span>
<span id="cb250-13"><a href="actualización-del-modelo.html#cb250-13" aria-hidden="true" tabindex="-1"></a>precision <span class="ot">=</span> <span class="fu">sum</span>( (prediccion.arbol.olor<span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (prediccion.arbol.olor <span class="sc">==</span> <span class="dv">1</span>))<span class="sc">/</span> <span class="fu">sum</span>(prediccion.arbol.olor <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb250-14"><a href="actualización-del-modelo.html#cb250-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-15"><a href="actualización-del-modelo.html#cb250-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es COMESTIBLE</span></span>
<span id="cb250-16"><a href="actualización-del-modelo.html#cb250-16" aria-hidden="true" tabindex="-1"></a>npv <span class="ot">=</span> <span class="fu">sum</span>(prediccion.arbol.olor<span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> prediccion.arbol.olor <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(prediccion.arbol.olor <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb250-17"><a href="actualización-del-modelo.html#cb250-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-18"><a href="actualización-del-modelo.html#cb250-18" aria-hidden="true" tabindex="-1"></a><span class="co"># F1_score</span></span>
<span id="cb250-19"><a href="actualización-del-modelo.html#cb250-19" aria-hidden="true" tabindex="-1"></a>f1score <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>precision<span class="sc">*</span>recall <span class="sc">/</span>(precision<span class="sc">+</span>recall)</span>
<span id="cb250-20"><a href="actualización-del-modelo.html#cb250-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-21"><a href="actualización-del-modelo.html#cb250-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla de medidas de precisión</span></span>
<span id="cb250-22"><a href="actualización-del-modelo.html#cb250-22" aria-hidden="true" tabindex="-1"></a>medidas.arboles.olor<span class="ot">=</span><span class="fu">c</span>(<span class="at">accuracy =</span> accuracy, <span class="at">error =</span> error, <span class="at">sensitivity =</span> sensitivity, <span class="at">specificity =</span> specificity, <span class="at">precision =</span> precision, <span class="at">npv =</span> npv, <span class="at">f1=</span>f1score)</span>
<span id="cb250-23"><a href="actualización-del-modelo.html#cb250-23" aria-hidden="true" tabindex="-1"></a>medidas.arboles.olor</span></code></pre></div>
<pre><code>##    accuracy       error sensitivity specificity   precision         npv 
##   0.8958333   0.1041667   1.0000000   0.7916667   0.8275862   1.0000000 
##          f1 
##   0.9056604</code></pre>
<p>El error que se comete es del 10%, pero solo se equivoca en 5 setas, así que el modelo predice bien.</p>
</div>
<div id="bosques-aleatorios-2" class="section level3" number="8.2.4">
<h3><span class="header-section-number">8.2.4</span> Bosques Aleatorios</h3>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="actualización-del-modelo.html#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">34735</span>)</span>
<span id="cb252-2"><a href="actualización-del-modelo.html#cb252-2" aria-hidden="true" tabindex="-1"></a>setas.rf.olor<span class="ot">=</span><span class="fu">randomForest</span>(setas.dice_train.olor, <span class="fu">as.factor</span>(setas_train.olor.data<span class="sc">$</span>Letalidad), <span class="at">ntree=</span><span class="dv">100</span>, <span class="at">importance=</span><span class="cn">FALSE</span>, <span class="at">proximity=</span><span class="cn">TRUE</span>, <span class="at">mtry=</span><span class="dv">4</span>, <span class="at">replace=</span><span class="cn">FALSE</span>,<span class="at">method=</span><span class="st">&quot;class&quot;</span>)</span>
<span id="cb252-3"><a href="actualización-del-modelo.html#cb252-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-4"><a href="actualización-del-modelo.html#cb252-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla comparativa</span></span>
<span id="cb252-5"><a href="actualización-del-modelo.html#cb252-5" aria-hidden="true" tabindex="-1"></a>prediccion.rf.olor<span class="ot">=</span><span class="fu">predict</span>(setas.rf.olor, setas_test.olor.data)</span>
<span id="cb252-6"><a href="actualización-del-modelo.html#cb252-6" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(prediccion.rf.olor,<span class="fu">as.factor</span>(setas_test.olor[,<span class="dv">1</span>]))</span></code></pre></div>
<pre><code>##                   
## prediccion.rf.olor  0  1
##                  0 22  0
##                  1  2 24</code></pre>
<p>La predicción se equivoca clasificando ciertas setas como venenosas cuando son comestibles. Analizamos la precisión de los bosques aleatorios con las medidas de precisión.</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="actualización-del-modelo.html#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exactitud/Error</span></span>
<span id="cb254-2"><a href="actualización-del-modelo.html#cb254-2" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">=</span> <span class="fu">sum</span>(prediccion.rf.olor <span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>])<span class="sc">/</span><span class="fu">nrow</span>(setas_test.olor)</span>
<span id="cb254-3"><a href="actualización-del-modelo.html#cb254-3" aria-hidden="true" tabindex="-1"></a>error <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span>accuracy</span>
<span id="cb254-4"><a href="actualización-del-modelo.html#cb254-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-5"><a href="actualización-del-modelo.html#cb254-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Sensibilidad: acierto sobre el total de las setas VENENOSAS</span></span>
<span id="cb254-6"><a href="actualización-del-modelo.html#cb254-6" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="ot">=</span> <span class="fu">sum</span>((prediccion.rf.olor <span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb254-7"><a href="actualización-del-modelo.html#cb254-7" aria-hidden="true" tabindex="-1"></a>recall <span class="ot">=</span> sensitivity</span>
<span id="cb254-8"><a href="actualización-del-modelo.html#cb254-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-9"><a href="actualización-del-modelo.html#cb254-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Especifidad: acierto sobre el total de las setas COMESTIBLES</span></span>
<span id="cb254-10"><a href="actualización-del-modelo.html#cb254-10" aria-hidden="true" tabindex="-1"></a>specificity <span class="ot">=</span>  <span class="fu">sum</span>(prediccion.rf.olor <span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb254-11"><a href="actualización-del-modelo.html#cb254-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-12"><a href="actualización-del-modelo.html#cb254-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Precisión: acierto cuando el predicho es VENENOSAS</span></span>
<span id="cb254-13"><a href="actualización-del-modelo.html#cb254-13" aria-hidden="true" tabindex="-1"></a>precision <span class="ot">=</span> <span class="fu">sum</span>( (prediccion.rf.olor<span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (prediccion.rf.olor <span class="sc">==</span> <span class="dv">1</span>))<span class="sc">/</span> <span class="fu">sum</span>(prediccion.rf.olor <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb254-14"><a href="actualización-del-modelo.html#cb254-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-15"><a href="actualización-del-modelo.html#cb254-15" aria-hidden="true" tabindex="-1"></a><span class="co"># NPV: acierto cuando el predicho es COMESTIBLE</span></span>
<span id="cb254-16"><a href="actualización-del-modelo.html#cb254-16" aria-hidden="true" tabindex="-1"></a>npv <span class="ot">=</span> <span class="fu">sum</span>(prediccion.rf.olor<span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> prediccion.rf.olor <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(prediccion.rf.olor <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb254-17"><a href="actualización-del-modelo.html#cb254-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-18"><a href="actualización-del-modelo.html#cb254-18" aria-hidden="true" tabindex="-1"></a><span class="co"># F1_score</span></span>
<span id="cb254-19"><a href="actualización-del-modelo.html#cb254-19" aria-hidden="true" tabindex="-1"></a>f1score <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>precision<span class="sc">*</span>recall <span class="sc">/</span>(precision<span class="sc">+</span>recall)</span>
<span id="cb254-20"><a href="actualización-del-modelo.html#cb254-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-21"><a href="actualización-del-modelo.html#cb254-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla de medidas de precisión</span></span>
<span id="cb254-22"><a href="actualización-del-modelo.html#cb254-22" aria-hidden="true" tabindex="-1"></a>medidas.bosques.olor<span class="ot">=</span><span class="fu">c</span>(<span class="at">accuracy =</span> accuracy, <span class="at">error =</span> error, <span class="at">sensitivity =</span> sensitivity, <span class="at">specificity =</span> specificity, <span class="at">precision =</span> precision, <span class="at">npv =</span> npv, <span class="at">f1=</span>f1score)</span>
<span id="cb254-23"><a href="actualización-del-modelo.html#cb254-23" aria-hidden="true" tabindex="-1"></a>medidas.bosques.olor</span></code></pre></div>
<pre><code>##    accuracy       error sensitivity specificity   precision         npv 
##  0.95833333  0.04166667  1.00000000  0.91666667  0.92307692  1.00000000 
##          f1 
##  0.96000000</code></pre>
<p>El error que se comete es del 4%, el error cometido es menor que en el caso del árbol de decisión.</p>
</div>
<div id="support-vector-machines-2" class="section level3" number="8.2.5">
<h3><span class="header-section-number">8.2.5</span> Support Vector Machines</h3>
<p>Para determinar el valor de gamma y el coste, usamos los datos que hemos reservado para validación y realizamos una estimación con ellos.</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="actualización-del-modelo.html#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Para estimar el gamma: </span></span>
<span id="cb256-2"><a href="actualización-del-modelo.html#cb256-2" aria-hidden="true" tabindex="-1"></a>gamma_est<span class="ot">=</span><span class="dv">1</span><span class="sc">/</span><span class="fu">apply</span>(setas.dice_validacion.olor,<span class="dv">2</span>,sd)</span>
<span id="cb256-3"><a href="actualización-del-modelo.html#cb256-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Para estimar el coste: </span></span>
<span id="cb256-4"><a href="actualización-del-modelo.html#cb256-4" aria-hidden="true" tabindex="-1"></a>norma2<span class="ot">&lt;-</span><span class="cf">function</span>(x) <span class="fu">sqrt</span>(<span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb256-5"><a href="actualización-del-modelo.html#cb256-5" aria-hidden="true" tabindex="-1"></a>cost_est<span class="ot">=</span><span class="fu">apply</span>(setas.dice_validacion.olor,<span class="dv">2</span>,norma2)</span>
<span id="cb256-6"><a href="actualización-del-modelo.html#cb256-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-7"><a href="actualización-del-modelo.html#cb256-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Ajustamos el modelo</span></span>
<span id="cb256-8"><a href="actualización-del-modelo.html#cb256-8" aria-hidden="true" tabindex="-1"></a>setas.svm.olor<span class="ot">=</span><span class="fu">svm</span>(setas.dice_train.olor,setas_train.olor[,<span class="dv">1</span>],<span class="at">type=</span><span class="st">&quot;C-classification&quot;</span>,<span class="at">kernel=</span><span class="st">&quot;radial&quot;</span>,<span class="at">gamma=</span><span class="fu">mean</span>(gamma_est),<span class="at">cost=</span><span class="fu">mean</span>(cost_est),<span class="at">scale=</span>F)</span>
<span id="cb256-9"><a href="actualización-del-modelo.html#cb256-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Vectores soporte</span></span>
<span id="cb256-10"><a href="actualización-del-modelo.html#cb256-10" aria-hidden="true" tabindex="-1"></a>setas.svm.olor<span class="sc">$</span>tot.nSV</span></code></pre></div>
<pre><code>## [1] 143</code></pre>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="actualización-del-modelo.html#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla comparativa</span></span>
<span id="cb258-2"><a href="actualización-del-modelo.html#cb258-2" aria-hidden="true" tabindex="-1"></a>prediccion_svm.olor<span class="ot">=</span><span class="fu">predict</span>(setas.svm.olor,setas.dice_test.olor)</span>
<span id="cb258-3"><a href="actualización-del-modelo.html#cb258-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(prediccion_svm.olor,setas_test.olor[,<span class="dv">1</span>])</span></code></pre></div>
<pre><code>##                    
## prediccion_svm.olor  0  1
##                   0 24  0
##                   1  0 24</code></pre>
<p>La tabla nos dice que el modelo predice a la perfección los datos pero el modelo está sobre ajustado, pues requiere de demasiados vectores soporte cuando el número de observaciones es 144. Las medidas de precisión van a aportar el error cometido.</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="actualización-del-modelo.html#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Medidas de precisión</span></span>
<span id="cb260-2"><a href="actualización-del-modelo.html#cb260-2" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">=</span> <span class="fu">sum</span>(prediccion_svm.olor <span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>])<span class="sc">/</span><span class="fu">nrow</span>(setas_test.olor)</span>
<span id="cb260-3"><a href="actualización-del-modelo.html#cb260-3" aria-hidden="true" tabindex="-1"></a>error <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span>accuracy</span>
<span id="cb260-4"><a href="actualización-del-modelo.html#cb260-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-5"><a href="actualización-del-modelo.html#cb260-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas VENENOSAS, sensitivity o recall</span></span>
<span id="cb260-6"><a href="actualización-del-modelo.html#cb260-6" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="ot">=</span> <span class="fu">sum</span>((prediccion_svm.olor <span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb260-7"><a href="actualización-del-modelo.html#cb260-7" aria-hidden="true" tabindex="-1"></a>recall <span class="ot">=</span> sensitivity</span>
<span id="cb260-8"><a href="actualización-del-modelo.html#cb260-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-9"><a href="actualización-del-modelo.html#cb260-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas COMESTIBLES</span></span>
<span id="cb260-10"><a href="actualización-del-modelo.html#cb260-10" aria-hidden="true" tabindex="-1"></a>specificity <span class="ot">=</span>  <span class="fu">sum</span>(prediccion_svm.olor <span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb260-11"><a href="actualización-del-modelo.html#cb260-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-12"><a href="actualización-del-modelo.html#cb260-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es VENENOSAS</span></span>
<span id="cb260-13"><a href="actualización-del-modelo.html#cb260-13" aria-hidden="true" tabindex="-1"></a>precision <span class="ot">=</span> <span class="fu">sum</span>((prediccion_svm.olor<span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (prediccion_svm.olor <span class="sc">==</span> <span class="dv">1</span>))<span class="sc">/</span> <span class="fu">sum</span>(prediccion_svm.olor <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb260-14"><a href="actualización-del-modelo.html#cb260-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-15"><a href="actualización-del-modelo.html#cb260-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es COMESTIBLE</span></span>
<span id="cb260-16"><a href="actualización-del-modelo.html#cb260-16" aria-hidden="true" tabindex="-1"></a>npv <span class="ot">=</span> <span class="fu">sum</span>(prediccion_svm.olor<span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> prediccion_svm.olor <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(prediccion_svm.olor <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb260-17"><a href="actualización-del-modelo.html#cb260-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-18"><a href="actualización-del-modelo.html#cb260-18" aria-hidden="true" tabindex="-1"></a><span class="co"># F1_score</span></span>
<span id="cb260-19"><a href="actualización-del-modelo.html#cb260-19" aria-hidden="true" tabindex="-1"></a>f1score <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>precision<span class="sc">*</span>recall <span class="sc">/</span>(precision<span class="sc">+</span>recall)</span>
<span id="cb260-20"><a href="actualización-del-modelo.html#cb260-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-21"><a href="actualización-del-modelo.html#cb260-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla de medidas de precisión</span></span>
<span id="cb260-22"><a href="actualización-del-modelo.html#cb260-22" aria-hidden="true" tabindex="-1"></a>medidas.svmradial.olor<span class="ot">=</span><span class="fu">c</span>(<span class="at">accuracy =</span> accuracy, <span class="at">error =</span> error, <span class="at">sensitivity =</span> sensitivity, <span class="at">specificity =</span> specificity, <span class="at">precision =</span> precision, <span class="at">npv =</span> npv, <span class="at">f1=</span>f1score)</span>
<span id="cb260-23"><a href="actualización-del-modelo.html#cb260-23" aria-hidden="true" tabindex="-1"></a>medidas.svmradial.olor</span></code></pre></div>
<pre><code>##    accuracy       error sensitivity specificity   precision         npv 
##           1           0           1           1           1           1 
##          f1 
##           1</code></pre>
<p>Si realizamos el ajuste de SVM pero establecemos que el kernel es lineal, obtenemos lo siguiente:</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="actualización-del-modelo.html#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Para estimar el coste: </span></span>
<span id="cb262-2"><a href="actualización-del-modelo.html#cb262-2" aria-hidden="true" tabindex="-1"></a>norma2<span class="ot">&lt;-</span><span class="cf">function</span>(x) <span class="fu">sqrt</span>(<span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb262-3"><a href="actualización-del-modelo.html#cb262-3" aria-hidden="true" tabindex="-1"></a>cost_est<span class="ot">=</span><span class="fu">apply</span>(setas.dice_validacion.olor,<span class="dv">2</span>,norma2)</span>
<span id="cb262-4"><a href="actualización-del-modelo.html#cb262-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-5"><a href="actualización-del-modelo.html#cb262-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Ajustamos el modelo</span></span>
<span id="cb262-6"><a href="actualización-del-modelo.html#cb262-6" aria-hidden="true" tabindex="-1"></a>setas.svm.lineal.olor<span class="ot">=</span><span class="fu">svm</span>(setas.dice_train.olor,setas_train.olor[,<span class="dv">1</span>],<span class="at">type=</span><span class="st">&quot;C-classification&quot;</span>,<span class="at">kernel=</span><span class="st">&quot;linear&quot;</span>,<span class="at">cost=</span><span class="fu">mean</span>(cost_est),<span class="at">scale=</span>F)</span>
<span id="cb262-7"><a href="actualización-del-modelo.html#cb262-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Vectores soporte</span></span>
<span id="cb262-8"><a href="actualización-del-modelo.html#cb262-8" aria-hidden="true" tabindex="-1"></a>setas.svm.lineal.olor<span class="sc">$</span>tot.nSV</span></code></pre></div>
<pre><code>## [1] 12</code></pre>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="actualización-del-modelo.html#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla comparativa</span></span>
<span id="cb264-2"><a href="actualización-del-modelo.html#cb264-2" aria-hidden="true" tabindex="-1"></a>prediccion_svm.lineal.olor<span class="ot">=</span><span class="fu">predict</span>(setas.svm.lineal.olor,setas.dice_test.olor)</span>
<span id="cb264-3"><a href="actualización-del-modelo.html#cb264-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(prediccion_svm.lineal.olor,setas_test.olor[,<span class="dv">1</span>])</span></code></pre></div>
<pre><code>##                           
## prediccion_svm.lineal.olor  0  1
##                          0 21  0
##                          1  3 24</code></pre>
<p>Podemos ver que respecto al kernel radial, las predicciones son peores pero necesita de menos vectores soportes para ajustar el modelo.</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="actualización-del-modelo.html#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Medidas de precisión</span></span>
<span id="cb266-2"><a href="actualización-del-modelo.html#cb266-2" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">=</span> <span class="fu">sum</span>(prediccion_svm.lineal.olor <span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>])<span class="sc">/</span><span class="fu">nrow</span>(setas_test.olor)</span>
<span id="cb266-3"><a href="actualización-del-modelo.html#cb266-3" aria-hidden="true" tabindex="-1"></a>error <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span>accuracy</span>
<span id="cb266-4"><a href="actualización-del-modelo.html#cb266-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-5"><a href="actualización-del-modelo.html#cb266-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas VENENOSAS, sensitivity o recall</span></span>
<span id="cb266-6"><a href="actualización-del-modelo.html#cb266-6" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="ot">=</span> <span class="fu">sum</span>((prediccion_svm.lineal.olor <span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb266-7"><a href="actualización-del-modelo.html#cb266-7" aria-hidden="true" tabindex="-1"></a>recall <span class="ot">=</span> sensitivity</span>
<span id="cb266-8"><a href="actualización-del-modelo.html#cb266-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-9"><a href="actualización-del-modelo.html#cb266-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas COMESTIBLES</span></span>
<span id="cb266-10"><a href="actualización-del-modelo.html#cb266-10" aria-hidden="true" tabindex="-1"></a>specificity <span class="ot">=</span>  <span class="fu">sum</span>(prediccion_svm.lineal.olor <span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb266-11"><a href="actualización-del-modelo.html#cb266-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-12"><a href="actualización-del-modelo.html#cb266-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es VENENOSAS</span></span>
<span id="cb266-13"><a href="actualización-del-modelo.html#cb266-13" aria-hidden="true" tabindex="-1"></a>precision <span class="ot">=</span> <span class="fu">sum</span>((prediccion_svm.lineal.olor<span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (prediccion_svm.lineal.olor <span class="sc">==</span> <span class="dv">1</span>))<span class="sc">/</span> <span class="fu">sum</span>(prediccion_svm.lineal.olor <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb266-14"><a href="actualización-del-modelo.html#cb266-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-15"><a href="actualización-del-modelo.html#cb266-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es COMESTIBLE</span></span>
<span id="cb266-16"><a href="actualización-del-modelo.html#cb266-16" aria-hidden="true" tabindex="-1"></a>npv <span class="ot">=</span> <span class="fu">sum</span>(prediccion_svm.lineal.olor<span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> prediccion_svm.lineal.olor <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(prediccion_svm.lineal.olor <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb266-17"><a href="actualización-del-modelo.html#cb266-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-18"><a href="actualización-del-modelo.html#cb266-18" aria-hidden="true" tabindex="-1"></a><span class="co"># F1_score</span></span>
<span id="cb266-19"><a href="actualización-del-modelo.html#cb266-19" aria-hidden="true" tabindex="-1"></a>f1score <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>precision<span class="sc">*</span>recall <span class="sc">/</span>(precision<span class="sc">+</span>recall)</span>
<span id="cb266-20"><a href="actualización-del-modelo.html#cb266-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-21"><a href="actualización-del-modelo.html#cb266-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla de medidas de precisión</span></span>
<span id="cb266-22"><a href="actualización-del-modelo.html#cb266-22" aria-hidden="true" tabindex="-1"></a>medidas.svmlineal.olor<span class="ot">=</span><span class="fu">c</span>(<span class="at">accuracy =</span> accuracy, <span class="at">error =</span> error, <span class="at">sensitivity =</span> sensitivity, <span class="at">specificity =</span> specificity, <span class="at">precision =</span> precision, <span class="at">npv =</span> npv, <span class="at">f1=</span>f1score)</span>
<span id="cb266-23"><a href="actualización-del-modelo.html#cb266-23" aria-hidden="true" tabindex="-1"></a>medidas.svmlineal.olor</span></code></pre></div>
<pre><code>##    accuracy       error sensitivity specificity   precision         npv 
##   0.9375000   0.0625000   1.0000000   0.8750000   0.8888889   1.0000000 
##          f1 
##   0.9411765</code></pre>
<p>Por tanto, usar un SVM con kernel lineal, es una opción factible para nuestros datos.</p>
</div>
<div id="evaluación-2" class="section level3" number="8.2.6">
<h3><span class="header-section-number">8.2.6</span> Evaluación</h3>
<p>Por lo tanto si comparamos todos los modelos que hemos aplicado usando las medidas de precisión vemos lo siguiente</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="actualización-del-modelo.html#cb268-1" aria-hidden="true" tabindex="-1"></a>medidas.precision.olor<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">c</span>(medidas.knn.olor,medidas.arboles.olor,medidas.bosques.olor,medidas.svmradial.olor,medidas.svmlineal.olor),<span class="at">nrow=</span><span class="dv">5</span>,<span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb268-2"><a href="actualización-del-modelo.html#cb268-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(medidas.precision.olor)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;accuracy&quot;</span>, <span class="st">&quot;error&quot;</span>, <span class="st">&quot;sensitivity&quot;</span>, <span class="st">&quot;specificity&quot;</span>, <span class="st">&quot;precision&quot;</span>, <span class="st">&quot;npv&quot;</span>, <span class="st">&quot;f1score&quot;</span>)</span>
<span id="cb268-3"><a href="actualización-del-modelo.html#cb268-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(medidas.precision.olor)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;k-NN&quot;</span>,<span class="st">&quot;Arboles de decision&quot;</span>,<span class="st">&quot;Bosques aleatorios&quot;</span>,<span class="st">&quot;SVM radial&quot;</span>,<span class="st">&quot;SVM lineal&quot;</span>)</span>
<span id="cb268-4"><a href="actualización-del-modelo.html#cb268-4" aria-hidden="true" tabindex="-1"></a>medidas.precision.olor</span></code></pre></div>
<pre><code>##                      accuracy      error sensitivity specificity precision npv
## k-NN                0.9791667 0.02083333           1   0.9583333 0.9600000   1
## Arboles de decision 0.8958333 0.10416667           1   0.7916667 0.8275862   1
## Bosques aleatorios  0.9583333 0.04166667           1   0.9166667 0.9230769   1
## SVM radial          1.0000000 0.00000000           1   1.0000000 1.0000000   1
## SVM lineal          0.9375000 0.06250000           1   0.8750000 0.8888889   1
##                       f1score
## k-NN                0.9795918
## Arboles de decision 0.9056604
## Bosques aleatorios  0.9600000
## SVM radial          1.0000000
## SVM lineal          0.9411765</code></pre>
<p>El mejor modelo para aplicar a nuestros datos puede ser el k-NN con el vecino más próximo o los bosques aleatorios, pues ambos modelos predicen bastante bien los datos tanto los de entrenamiento como los de test, solo se comete un error del 4,1%. La conclusión a la que hemos llegado tras finalizar el análisis de los datos difiere un poco del resto de conclusiones. Aunque, al ser pocos datos, puede que no sea una muestra lo suficientemente representativa (a pesar de haber seleccionado las setas venenosas de forma aleatoria) y por lo tanto las conclusiones pueden ser erróneas.</p>
</div>
</div>
<div id="evaluación-de-los-tres-análisis" class="section level2" number="8.3">
<h2><span class="header-section-number">8.3</span> Evaluación de los tres análisis</h2>
<p>Por lo tanto si comparamos todos los modelos de los tres análsis que hemos aplicado usando las medidas de precisión vemos lo siguiente</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="actualización-del-modelo.html#cb270-1" aria-hidden="true" tabindex="-1"></a>medidas.precision.todas<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">c</span>(medidas.knn,medidas.arboles,medidas.bosques,medidas.svmradial,medidas.svmlineal,medidas.knn.sin.olor,medidas.arboles.sin.olor,medidas.bosques.sin.olor,medidas.svmradial.sin.olor,medidas.svmlineal.sin.olor,medidas.knn.olor,medidas.arboles.olor,medidas.bosques.olor,medidas.svmradial.olor,medidas.svmlineal.olor),<span class="at">nrow=</span><span class="dv">15</span>,<span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb270-2"><a href="actualización-del-modelo.html#cb270-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(medidas.precision.todas)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;accuracy&quot;</span>, <span class="st">&quot;error&quot;</span>, <span class="st">&quot;sensitivity&quot;</span>, <span class="st">&quot;specificity&quot;</span>, <span class="st">&quot;precision&quot;</span>, <span class="st">&quot;npv&quot;</span>, <span class="st">&quot;f1score&quot;</span>)</span>
<span id="cb270-3"><a href="actualización-del-modelo.html#cb270-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(medidas.precision.todas)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;k-NN&quot;</span>,<span class="st">&quot;Arboles de decision&quot;</span>,<span class="st">&quot;Bosques aleatorios&quot;</span>,<span class="st">&quot;SVM radial&quot;</span>,<span class="st">&quot;SVM lineal&quot;</span>,<span class="st">&quot;k-NN.sin.olor&quot;</span>,<span class="st">&quot;Arboles de decision.sin.olor&quot;</span>,<span class="st">&quot;Bosques aleatorios.sin.olor&quot;</span>,<span class="st">&quot;SVM radial.sin.olor&quot;</span>,<span class="st">&quot;SVM lineal.sin.olor&quot;</span>,<span class="st">&quot;k-NN.olor&quot;</span>,<span class="st">&quot;Arboles de decision.olor&quot;</span>,<span class="st">&quot;Bosques aleatorios.olor&quot;</span>,<span class="st">&quot;SVM radial.olor&quot;</span>,<span class="st">&quot;SVM lineal.olor&quot;</span>)</span>
<span id="cb270-4"><a href="actualización-del-modelo.html#cb270-4" aria-hidden="true" tabindex="-1"></a>medidas.precision.todas</span></code></pre></div>
<pre><code>##                               accuracy       error sensitivity specificity
## k-NN                         0.9981527 0.001847291   0.9987277   0.9976134
## Arboles de decision          0.9378079 0.062192118   0.9503817   0.9260143
## Bosques aleatorios           0.9987685 0.001231527   1.0000000   0.9976134
## SVM radial                   1.0000000 0.000000000   1.0000000   1.0000000
## SVM lineal                   0.9575123 0.042487685   0.9452926   0.9689737
## k-NN.sin.olor                0.9987685 0.001231527   0.9974555   1.0000000
## Arboles de decision.sin.olor 0.9421182 0.057881773   0.9325700   0.9510740
## Bosques aleatorios.sin.olor  0.9944581 0.005541872   0.9974555   0.9916468
## SVM radial.sin.olor          1.0000000 0.000000000   1.0000000   1.0000000
## SVM lineal.sin.olor          0.9605911 0.039408867   0.9529262   0.9677804
## k-NN.olor                    0.9791667 0.020833333   1.0000000   0.9583333
## Arboles de decision.olor     0.8958333 0.104166667   1.0000000   0.7916667
## Bosques aleatorios.olor      0.9583333 0.041666667   1.0000000   0.9166667
## SVM radial.olor              1.0000000 0.000000000   1.0000000   1.0000000
## SVM lineal.olor              0.9375000 0.062500000   1.0000000   0.8750000
##                              precision       npv   f1score
## k-NN                         0.9974587 0.9988053 0.9980928
## Arboles de decision          0.9233622 0.9521472 0.9366771
## Bosques aleatorios           0.9974619 1.0000000 0.9987294
## SVM radial                   1.0000000 1.0000000 1.0000000
## SVM lineal                   0.9661899 0.9497076 0.9556270
## k-NN.sin.olor                1.0000000 0.9976190 0.9987261
## Arboles de decision.sin.olor 0.9470284 0.9376471 0.9397436
## Bosques aleatorios.sin.olor  0.9911504 0.9975990 0.9942930
## SVM radial.sin.olor          1.0000000 1.0000000 1.0000000
## SVM lineal.sin.olor          0.9652062 0.9563679 0.9590269
## k-NN.olor                    0.9600000 1.0000000 0.9795918
## Arboles de decision.olor     0.8275862 1.0000000 0.9056604
## Bosques aleatorios.olor      0.9230769 1.0000000 0.9600000
## SVM radial.olor              1.0000000 1.0000000 1.0000000
## SVM lineal.olor              0.8888889 1.0000000 0.9411765</code></pre>
<p>Vemos que el modelo k-NN es el mejor pues aunque hayamos ido cambiando los datos con los que hemos ajustado el modelo, el error cometido en todos los análisis no supera el 2%, siempre que lo hagamos con el vecino más próximo.</p>
<p>Luego es el modelo que mejor ajusta nuestros datos originales y con las actualizaciones pertinentes posteriores.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="evaluación.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": false,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
