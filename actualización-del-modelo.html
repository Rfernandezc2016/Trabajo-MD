<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 Actualización del modelo… | Memoria del trabajo</title>
  <meta name="description" content="7 Actualización del modelo… | Memoria del trabajo" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="7 Actualización del modelo… | Memoria del trabajo" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 Actualización del modelo… | Memoria del trabajo" />
  
  
  

<meta name="author" content="Adrián Rocha De la Casa, Yassin Khalifa Martino y Rocío Fernández Cebrián" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="evaluación.html"/>

<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="introducción.html"><a href="introducción.html"><i class="fa fa-check"></i><b>1</b> Introducción</a></li>
<li class="chapter" data-level="2" data-path="objetivos.html"><a href="objetivos.html"><i class="fa fa-check"></i><b>2</b> Objetivos</a></li>
<li class="chapter" data-level="3" data-path="datos.html"><a href="datos.html"><i class="fa fa-check"></i><b>3</b> Datos</a></li>
<li class="chapter" data-level="4" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html"><i class="fa fa-check"></i><b>4</b> Preprocesado de datos.</a>
<ul>
<li class="chapter" data-level="4.1" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#particiones."><i class="fa fa-check"></i><b>4.1</b> Particiones.</a></li>
<li class="chapter" data-level="4.2" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#eda.-exploratory-data-analysis."><i class="fa fa-check"></i><b>4.2</b> EDA. Exploratory Data Analysis.</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#letalidad"><i class="fa fa-check"></i><b>4.2.1</b> Letalidad:</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#correlación-entre-las-variables."><i class="fa fa-check"></i><b>4.3</b> Correlación entre las variables.</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#forma-del-sombrero-forma_s"><i class="fa fa-check"></i><b>4.3.1</b> Forma del sombrero (Forma_S)</a></li>
<li class="chapter" data-level="4.3.2" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#cutícula"><i class="fa fa-check"></i><b>4.3.2</b> Cutícula</a></li>
<li class="chapter" data-level="4.3.3" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#color-del-sombrero-color_s"><i class="fa fa-check"></i><b>4.3.3</b> Color del sombrero (Color_S)</a></li>
<li class="chapter" data-level="4.3.4" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#escamas"><i class="fa fa-check"></i><b>4.3.4</b> Escamas</a></li>
<li class="chapter" data-level="4.3.5" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#olor"><i class="fa fa-check"></i><b>4.3.5</b> Olor</a></li>
<li class="chapter" data-level="4.3.6" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#fijación-de-las-láminas-fijacion_l"><i class="fa fa-check"></i><b>4.3.6</b> Fijación de las láminas (Fijacion_L)</a></li>
<li class="chapter" data-level="4.3.7" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#espacio-entre-láminas-espacio_l"><i class="fa fa-check"></i><b>4.3.7</b> Espacio entre láminas (Espacio_L)</a></li>
<li class="chapter" data-level="4.3.8" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#tamaño-de-las-láminas-tamaño_l"><i class="fa fa-check"></i><b>4.3.8</b> Tamaño de las láminas (Tamaño_L)</a></li>
<li class="chapter" data-level="4.3.9" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#color-de-las-láminas-color_l"><i class="fa fa-check"></i><b>4.3.9</b> Color de las láminas (Color_L)</a></li>
<li class="chapter" data-level="4.3.10" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#forma-del-tallo-forma_t"><i class="fa fa-check"></i><b>4.3.10</b> Forma del tallo (Forma_T)</a></li>
<li class="chapter" data-level="4.3.11" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#tallo-raíz-tallo_raiz"><i class="fa fa-check"></i><b>4.3.11</b> Tallo-Raíz (Tallo_raiz)</a></li>
<li class="chapter" data-level="4.3.12" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#superficie-del-tallo-por-encima-del-anillo-superficie_t1"><i class="fa fa-check"></i><b>4.3.12</b> Superficie del tallo por encima del anillo (Superficie_T1)</a></li>
<li class="chapter" data-level="4.3.13" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#superficie-del-tallo-por-debajo-del-anillo-superficie_t2"><i class="fa fa-check"></i><b>4.3.13</b> Superficie del tallo por debajo del anillo (Superficie_T2)</a></li>
<li class="chapter" data-level="4.3.14" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#color-del-tallo-por-encima-del-anillo-color_t1"><i class="fa fa-check"></i><b>4.3.14</b> Color del tallo por encima del anillo (Color_T1)</a></li>
<li class="chapter" data-level="4.3.15" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#color-del-tallo-por-debajo-del-anillo-color_t2"><i class="fa fa-check"></i><b>4.3.15</b> Color del tallo por debajo del anillo (Color_T2)</a></li>
<li class="chapter" data-level="4.3.16" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#color-del-volva-color_v"><i class="fa fa-check"></i><b>4.3.16</b> Color del volva (Color_V)</a></li>
<li class="chapter" data-level="4.3.17" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#número-de-anillos-n_anillos"><i class="fa fa-check"></i><b>4.3.17</b> Número de anillos (N_anillos)</a></li>
<li class="chapter" data-level="4.3.18" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#tipo-de-anillo-tipo_anillo"><i class="fa fa-check"></i><b>4.3.18</b> Tipo de anillo (Tipo_anillo)</a></li>
<li class="chapter" data-level="4.3.19" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#color-de-las-esporas"><i class="fa fa-check"></i><b>4.3.19</b> Color de las esporas</a></li>
<li class="chapter" data-level="4.3.20" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#población"><i class="fa fa-check"></i><b>4.3.20</b> Población</a></li>
<li class="chapter" data-level="4.3.21" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#habitat"><i class="fa fa-check"></i><b>4.3.21</b> Habitat</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#componentes-principales"><i class="fa fa-check"></i><b>4.4</b> Componentes principales</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#proceso-previo"><i class="fa fa-check"></i><b>4.4.1</b> Proceso previo</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#transformación-de-variables"><i class="fa fa-check"></i><b>4.5</b> Transformación de variables</a></li>
<li class="chapter" data-level="4.6" data-path="preprocesado-de-datos..html"><a href="preprocesado-de-datos..html#imputacion-de-datos-datos-faltantes"><i class="fa fa-check"></i><b>4.6</b> Imputacion de datos (datos faltantes)</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="modelado.html"><a href="modelado.html"><i class="fa fa-check"></i><b>5</b> Modelado</a>
<ul>
<li class="chapter" data-level="5.1" data-path="modelado.html"><a href="modelado.html#análisis-cluster"><i class="fa fa-check"></i><b>5.1</b> Análisis Cluster</a></li>
<li class="chapter" data-level="5.2" data-path="modelado.html"><a href="modelado.html#k-nn"><i class="fa fa-check"></i><b>5.2</b> k-NN</a></li>
<li class="chapter" data-level="5.3" data-path="modelado.html"><a href="modelado.html#arboles-de-decisión"><i class="fa fa-check"></i><b>5.3</b> Arboles de Decisión</a></li>
<li class="chapter" data-level="5.4" data-path="modelado.html"><a href="modelado.html#bosques-aleatorios"><i class="fa fa-check"></i><b>5.4</b> Bosques Aleatorios</a></li>
<li class="chapter" data-level="5.5" data-path="modelado.html"><a href="modelado.html#support-vector-machines"><i class="fa fa-check"></i><b>5.5</b> Support Vector Machines</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="evaluación.html"><a href="evaluación.html"><i class="fa fa-check"></i><b>6</b> Evaluación</a></li>
<li class="chapter" data-level="7" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html"><i class="fa fa-check"></i><b>7</b> Actualización del modelo…</a>
<ul>
<li class="chapter" data-level="7.1" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html#datos-sin-variable-olor"><i class="fa fa-check"></i><b>7.1</b> Datos sin variable <strong>Olor</strong></a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html#análisis-cluster-1"><i class="fa fa-check"></i><b>7.1.1</b> Análisis Cluster</a></li>
<li class="chapter" data-level="7.1.2" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html#k-nn-1"><i class="fa fa-check"></i><b>7.1.2</b> k-NN</a></li>
<li class="chapter" data-level="7.1.3" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html#arboles-de-decisión-1"><i class="fa fa-check"></i><b>7.1.3</b> Arboles de Decisión</a></li>
<li class="chapter" data-level="7.1.4" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html#bosques-aleatorios-1"><i class="fa fa-check"></i><b>7.1.4</b> Bosques Aleatorios</a></li>
<li class="chapter" data-level="7.1.5" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html#support-vector-machines-1"><i class="fa fa-check"></i><b>7.1.5</b> Support Vector Machines</a></li>
<li class="chapter" data-level="7.1.6" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html#evaluación-1"><i class="fa fa-check"></i><b>7.1.6</b> Evaluación</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html#datos-con-variable-olorn"><i class="fa fa-check"></i><b>7.2</b> Datos con variable <strong>Olor=n</strong></a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html#análisis-cluster-2"><i class="fa fa-check"></i><b>7.2.1</b> Análisis Cluster</a></li>
<li class="chapter" data-level="7.2.2" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html#k-nn-2"><i class="fa fa-check"></i><b>7.2.2</b> k-NN</a></li>
<li class="chapter" data-level="7.2.3" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html#arboles-de-decisión-2"><i class="fa fa-check"></i><b>7.2.3</b> Arboles de Decisión</a></li>
<li class="chapter" data-level="7.2.4" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html#bosques-aleatorios-2"><i class="fa fa-check"></i><b>7.2.4</b> Bosques Aleatorios</a></li>
<li class="chapter" data-level="7.2.5" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html#support-vector-machines-2"><i class="fa fa-check"></i><b>7.2.5</b> Support Vector Machines</a></li>
<li class="chapter" data-level="7.2.6" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html#evaluación-2"><i class="fa fa-check"></i><b>7.2.6</b> Evaluación</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="actualización-del-modelo.html"><a href="actualización-del-modelo.html#evaluación-de-los-tres-análisis"><i class="fa fa-check"></i><b>7.3</b> Evaluación de los tres análisis</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Memoria del trabajo</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="actualización-del-modelo" class="section level1" number="7">
<h1><span class="header-section-number">7</span> Actualización del modelo…</h1>
<p>Tras haber obtenido los resultados de nuestros datos, nos planteamos ciertas actulizaciones de los modelos.</p>
<div id="datos-sin-variable-olor" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Datos sin variable <strong>Olor</strong></h2>
<p>Cuando realizamos el análisis descriptivo, ya observamos que la variable <strong>Olor</strong> es bastante determinante a la hora de clasificar las setas según su toxicidad, pero ello nos planteamos realizar todo el análisis a los datos quitando esta variable.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="actualización-del-modelo.html#cb164-1" aria-hidden="true" tabindex="-1"></a>setas_train.sin.olor<span class="ot">=</span>setas[indices_train,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">23</span><span class="sc">:</span><span class="dv">31</span>)]</span>
<span id="cb164-2"><a href="actualización-del-modelo.html#cb164-2" aria-hidden="true" tabindex="-1"></a>setas_test.sin.olor<span class="ot">=</span>setas[indices_test,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">23</span><span class="sc">:</span><span class="dv">31</span>)]</span>
<span id="cb164-3"><a href="actualización-del-modelo.html#cb164-3" aria-hidden="true" tabindex="-1"></a>setas_validacion.sin.olor<span class="ot">=</span>setas[indices_validacion,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">23</span><span class="sc">:</span><span class="dv">31</span>)]</span></code></pre></div>
<p>Recalculamos la medida de similitud</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="actualización-del-modelo.html#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Distancia Dice</span></span>
<span id="cb165-2"><a href="actualización-del-modelo.html#cb165-2" aria-hidden="true" tabindex="-1"></a>distancia_dice.sin.olor<span class="ot">=</span><span class="fu">distance</span>(setas_train.sin.olor[,<span class="dv">2</span><span class="sc">:</span><span class="fu">dim</span>(setas_train.sin.olor)[<span class="dv">2</span>]],<span class="at">method=</span><span class="st">&quot;dice&quot;</span>)</span></code></pre></div>
<p>Para seleccionar el número de medoides adecuado, hacemos cross-validation pero como sabemos que quizas el número de medoides adecuado está cuando son más de 10, probamos directamente. También usamos la distancia de todas las observaciones hasta el número de medoides que estamos probando. Nos quedaremos con aquella que tenga mayor proporcion acumulada pero sin sacrificar información sobre los datos.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="actualización-del-modelo.html#cb166-1" aria-hidden="true" tabindex="-1"></a>i<span class="ot">=</span><span class="dv">10</span></span>
<span id="cb166-2"><a href="actualización-del-modelo.html#cb166-2" aria-hidden="true" tabindex="-1"></a>datos<span class="ot">=</span><span class="fu">matrix</span>(<span class="at">nrow=</span><span class="dv">25</span>,<span class="at">ncol=</span><span class="dv">3</span>)</span>
<span id="cb166-3"><a href="actualización-del-modelo.html#cb166-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(datos)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;0&quot;</span>,<span class="st">&quot;1&quot;</span>,<span class="st">&quot;Proporción de la varianza acumulada explicada&quot;</span>)</span>
<span id="cb166-4"><a href="actualización-del-modelo.html#cb166-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(datos)<span class="ot">=</span><span class="fu">seq</span>(<span class="dv">10</span>,<span class="dv">250</span>,<span class="dv">10</span>)</span>
<span id="cb166-5"><a href="actualización-del-modelo.html#cb166-5" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span>(i<span class="sc">&lt;=</span><span class="dv">250</span>){</span>
<span id="cb166-6"><a href="actualización-del-modelo.html#cb166-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Cálculo de los medoides: </span></span>
<span id="cb166-7"><a href="actualización-del-modelo.html#cb166-7" aria-hidden="true" tabindex="-1"></a>  k<span class="ot">=</span><span class="fu">fastkmed</span>(distancia_dice.sin.olor,<span class="at">ncluster=</span>i)</span>
<span id="cb166-8"><a href="actualización-del-modelo.html#cb166-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Proporción de los medoides:</span></span>
<span id="cb166-9"><a href="actualización-del-modelo.html#cb166-9" aria-hidden="true" tabindex="-1"></a>  proporcion<span class="ot">=</span><span class="fu">c</span>(<span class="fu">sum</span>(setas_train.sin.olor[k<span class="sc">$</span>medoid,<span class="dv">1</span>]<span class="sc">==</span><span class="dv">0</span>),<span class="fu">sum</span>(setas_train.sin.olor[k<span class="sc">$</span>medoid,<span class="dv">1</span>]<span class="sc">==</span><span class="dv">1</span>))</span>
<span id="cb166-10"><a href="actualización-del-modelo.html#cb166-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb166-11"><a href="actualización-del-modelo.html#cb166-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb166-12"><a href="actualización-del-modelo.html#cb166-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Análsiis de componentes principales</span></span>
<span id="cb166-13"><a href="actualización-del-modelo.html#cb166-13" aria-hidden="true" tabindex="-1"></a>  pca.traink<span class="ot">=</span><span class="fu">prcomp</span>(distancia_dice.sin.olor[,k<span class="sc">$</span>medoid])</span>
<span id="cb166-14"><a href="actualización-del-modelo.html#cb166-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Varianza explicada</span></span>
<span id="cb166-15"><a href="actualización-del-modelo.html#cb166-15" aria-hidden="true" tabindex="-1"></a>  varianza.explicada<span class="ot">=</span>pca.traink<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="fu">sum</span>(pca.traink<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb166-16"><a href="actualización-del-modelo.html#cb166-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Proporción de la varianza acumulada explicada por las dos primeras componentes principales</span></span>
<span id="cb166-17"><a href="actualización-del-modelo.html#cb166-17" aria-hidden="true" tabindex="-1"></a>  varianza.explicada.acumulada<span class="ot">=</span>varianza.explicada[<span class="dv">1</span>]<span class="sc">+</span>varianza.explicada[<span class="dv">2</span>]</span>
<span id="cb166-18"><a href="actualización-del-modelo.html#cb166-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb166-19"><a href="actualización-del-modelo.html#cb166-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb166-20"><a href="actualización-del-modelo.html#cb166-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Almacenamos los datos</span></span>
<span id="cb166-21"><a href="actualización-del-modelo.html#cb166-21" aria-hidden="true" tabindex="-1"></a>  datos[i<span class="sc">/</span><span class="dv">10</span>,]<span class="ot">=</span><span class="fu">c</span>(proporcion,varianza.explicada.acumulada)</span>
<span id="cb166-22"><a href="actualización-del-modelo.html#cb166-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb166-23"><a href="actualización-del-modelo.html#cb166-23" aria-hidden="true" tabindex="-1"></a>i<span class="ot">=</span>i<span class="sc">+</span><span class="dv">10</span></span>
<span id="cb166-24"><a href="actualización-del-modelo.html#cb166-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb166-25"><a href="actualización-del-modelo.html#cb166-25" aria-hidden="true" tabindex="-1"></a>datos</span></code></pre></div>
<pre><code>##       0  1 Proporción de la varianza acumulada explicada
## 10    7  3                                     0.8367392
## 20   14  6                                     0.8201140
## 30   21  9                                     0.7522698
## 40   30 10                                     0.7679105
## 50   37 13                                     0.7738366
## 60   45 15                                     0.7820109
## 70   54 16                                     0.7717128
## 80   60 20                                     0.7657024
## 90   69 21                                     0.7761067
## 100  77 23                                     0.7595936
## 110  81 29                                     0.7458742
## 120  90 30                                     0.7513594
## 130  99 31                                     0.7497715
## 140 106 34                                     0.7502580
## 150 113 37                                     0.7465473
## 160 124 36                                     0.7529692
## 170 132 38                                     0.7570503
## 180 139 41                                     0.7608919
## 190 145 45                                     0.7551029
## 200 156 44                                     0.7594286
## 210 164 46                                     0.7616204
## 220 174 46                                     0.7680298
## 230 181 49                                     0.7701902
## 240 190 50                                     0.7748958
## 250 199 51                                     0.7770764</code></pre>
<p>Los resultados son bastantes parecidos al análisis en el que incluimos la variable <strong>Olor</strong>, por tanto, nos seguimos quedando con la distancia de todas las observaciones a los 60 medoides, la segunda proporcion acumulada más alta, para tener más información.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="actualización-del-modelo.html#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Cálculo de los medoides: </span></span>
<span id="cb168-2"><a href="actualización-del-modelo.html#cb168-2" aria-hidden="true" tabindex="-1"></a>k60<span class="ot">=</span><span class="fu">fastkmed</span>(distancia_dice.sin.olor,<span class="at">ncluster=</span><span class="dv">60</span>)</span>
<span id="cb168-3"><a href="actualización-del-modelo.html#cb168-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(setas_train.sin.olor<span class="sc">$</span>Letalidad[k60<span class="sc">$</span>medoid])</span></code></pre></div>
<pre><code>## 
##  0  1 
## 45 15</code></pre>
<p>Podemos ver que de los 60 medoides que hemos calculado, necesitamos 45 para explicar las setas no venenosas mientras que solo 15 para las venenosas. La proporción se mantiene cogiendo un número distinto de medoides, siendo entre un 70%-80% de los medoides setas no venenosas.</p>
<p>Con estos medoides volvemos a realizar el análisis de componente principales para ahora estudiarlo más detenidamente.</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="actualización-del-modelo.html#cb170-1" aria-hidden="true" tabindex="-1"></a>distancia_medoides.sin.olor<span class="ot">=</span>distancia_dice.sin.olor[,k60<span class="sc">$</span>medoid]</span>
<span id="cb170-2"><a href="actualización-del-modelo.html#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Análisis Componentes principales:</span></span>
<span id="cb170-3"><a href="actualización-del-modelo.html#cb170-3" aria-hidden="true" tabindex="-1"></a>pca<span class="fl">.60</span><span class="ot">=</span><span class="fu">prcomp</span>(distancia_medoides.sin.olor)</span>
<span id="cb170-4"><a href="actualización-del-modelo.html#cb170-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pca<span class="fl">.60</span>)</span></code></pre></div>
<pre><code>## Importance of components:
##                           PC1    PC2     PC3     PC4     PC5     PC6     PC7
## Standard deviation     0.9644 0.4746 0.34590 0.21447 0.18715 0.16947 0.14006
## Proportion of Variance 0.6295 0.1525 0.08098 0.03113 0.02371 0.01944 0.01328
## Cumulative Proportion  0.6295 0.7820 0.86299 0.89412 0.91783 0.93727 0.95054
##                            PC8    PC9    PC10    PC11    PC12    PC13    PC14
## Standard deviation     0.11644 0.1024 0.09372 0.08355 0.08171 0.06885 0.06459
## Proportion of Variance 0.00918 0.0071 0.00595 0.00472 0.00452 0.00321 0.00282
## Cumulative Proportion  0.95972 0.9668 0.97276 0.97749 0.98201 0.98522 0.98804
##                           PC15    PC16    PC17    PC18    PC19    PC20    PC21
## Standard deviation     0.05914 0.05541 0.04681 0.04479 0.04205 0.03383 0.03124
## Proportion of Variance 0.00237 0.00208 0.00148 0.00136 0.00120 0.00077 0.00066
## Cumulative Proportion  0.99041 0.99249 0.99397 0.99533 0.99652 0.99730 0.99796
##                           PC22    PC23    PC24    PC25    PC26    PC27    PC28
## Standard deviation     0.02613 0.02272 0.02211 0.01996 0.01698 0.01349 0.01268
## Proportion of Variance 0.00046 0.00035 0.00033 0.00027 0.00020 0.00012 0.00011
## Cumulative Proportion  0.99842 0.99877 0.99910 0.99937 0.99957 0.99969 0.99980
##                           PC29     PC30     PC31     PC32      PC33      PC34
## Standard deviation     0.01123 0.009934 0.007781 0.003838 8.463e-05 1.324e-05
## Proportion of Variance 0.00009 0.000070 0.000040 0.000010 0.000e+00 0.000e+00
## Cumulative Proportion  0.99988 0.999950 0.999990 1.000000 1.000e+00 1.000e+00
##                             PC35      PC36     PC37      PC38      PC39
## Standard deviation     3.771e-15 1.907e-15 1.61e-15 1.286e-15 9.802e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.00e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.00e+00 1.000e+00 1.000e+00
##                             PC40      PC41      PC42      PC43     PC44
## Standard deviation     9.488e-16 6.754e-16 4.767e-16 3.955e-16 3.17e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.00e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.00e+00
##                             PC45      PC46      PC47      PC48      PC49
## Standard deviation     3.146e-16 2.674e-16 2.503e-16 1.995e-16 1.384e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00
##                             PC50      PC51      PC52    PC53    PC54    PC55
## Standard deviation     1.216e-16 1.109e-16 1.014e-16 6.4e-17 6.4e-17 6.4e-17
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.0e+00 0.0e+00 0.0e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.0e+00 1.0e+00 1.0e+00
##                           PC56    PC57      PC58      PC59     PC60
## Standard deviation     6.4e-17 6.4e-17 6.065e-17 4.028e-17 3.17e-17
## Proportion of Variance 0.0e+00 0.0e+00 0.000e+00 0.000e+00 0.00e+00
## Cumulative Proportion  1.0e+00 1.0e+00 1.000e+00 1.000e+00 1.00e+00</code></pre>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="actualización-del-modelo.html#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pca<span class="fl">.60</span><span class="sc">$</span>x,<span class="at">col=</span>setas_train.sin.olor<span class="sc">$</span>Letalidad<span class="sc">+</span><span class="dv">1</span>,<span class="at">pch=</span><span class="dv">19</span>)</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/pca%20sin%20olor-1.png" width="672" /></p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="actualización-del-modelo.html#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Gráfico </span></span>
<span id="cb173-2"><a href="actualización-del-modelo.html#cb173-2" aria-hidden="true" tabindex="-1"></a>comestible<span class="ot">=</span><span class="fu">which</span>(setas_train.sin.olor[,<span class="dv">1</span>]<span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb173-3"><a href="actualización-del-modelo.html#cb173-3" aria-hidden="true" tabindex="-1"></a>no.comestibles<span class="ot">=</span><span class="fu">which</span>(setas_train.sin.olor[,<span class="dv">1</span>]<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb173-4"><a href="actualización-del-modelo.html#cb173-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-5"><a href="actualización-del-modelo.html#cb173-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb173-6"><a href="actualización-del-modelo.html#cb173-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pca<span class="fl">.60</span><span class="sc">$</span>x,<span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb173-7"><a href="actualización-del-modelo.html#cb173-7" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(pca<span class="fl">.60</span><span class="sc">$</span>x[comestible,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>],<span class="at">col=</span><span class="dv">1</span>,<span class="at">pch=</span><span class="dv">19</span>)</span>
<span id="cb173-8"><a href="actualización-del-modelo.html#cb173-8" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(pca<span class="fl">.60</span><span class="sc">$</span>x[no.comestibles,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>],<span class="at">col=</span><span class="dv">2</span>,<span class="at">pch=</span><span class="dv">19</span>)</span>
<span id="cb173-9"><a href="actualización-del-modelo.html#cb173-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pca<span class="fl">.60</span><span class="sc">$</span>x,<span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb173-10"><a href="actualización-del-modelo.html#cb173-10" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(pca<span class="fl">.60</span><span class="sc">$</span>x[no.comestibles,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>],<span class="at">col=</span><span class="dv">2</span>,<span class="at">pch=</span><span class="dv">19</span>)</span>
<span id="cb173-11"><a href="actualización-del-modelo.html#cb173-11" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(pca<span class="fl">.60</span><span class="sc">$</span>x[comestible,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>],<span class="at">col=</span><span class="dv">1</span>,<span class="at">pch=</span><span class="dv">19</span>)</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/pca%20sin%20olor-2.png" width="672" /></p>
<p>Observamos una gran maraña de puntos, parecida a la que obtenemos haciendo el mismo análsis incluyendo la variable <strong>Olor</strong>, donde solo podemos ver dos grupos bien diferenciados del resto.</p>
<p>Las variables no necesitan ninguna modificación adicional, pues ya las hemos codificado anteriormente. Lo único que transformamos son nuestro datos. A partir de ahora, los datos serán la distancia de cada seta a los 60 medoides que hemos calculado, esto permite utilizar la distancia euclínea en los algoritmos posteriores.</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="actualización-del-modelo.html#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Datos train:</span></span>
<span id="cb174-2"><a href="actualización-del-modelo.html#cb174-2" aria-hidden="true" tabindex="-1"></a>setas60_train.sin.olor<span class="ot">=</span>distancia_dice.sin.olor[,k60<span class="sc">$</span>medoid]</span>
<span id="cb174-3"><a href="actualización-del-modelo.html#cb174-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-4"><a href="actualización-del-modelo.html#cb174-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Datos test:</span></span>
<span id="cb174-5"><a href="actualización-del-modelo.html#cb174-5" aria-hidden="true" tabindex="-1"></a>medoides_setas_test.sin.olor<span class="ot">=</span><span class="fu">rbind</span>(setas_train.sin.olor[k60<span class="sc">$</span>medoid,],setas_test.sin.olor)</span>
<span id="cb174-6"><a href="actualización-del-modelo.html#cb174-6" aria-hidden="true" tabindex="-1"></a>distancia_medoides_test.sin.olor<span class="ot">=</span><span class="fu">distance</span>(medoides_setas_test.sin.olor[,<span class="dv">2</span><span class="sc">:</span><span class="fu">dim</span>(setas_test.sin.olor)[<span class="dv">2</span>]],<span class="at">method=</span><span class="st">&quot;dice&quot;</span>)</span>
<span id="cb174-7"><a href="actualización-del-modelo.html#cb174-7" aria-hidden="true" tabindex="-1"></a>setas60_test.sin.olor<span class="ot">=</span>distancia_medoides_test.sin.olor[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">60</span>),<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">60</span>)]</span>
<span id="cb174-8"><a href="actualización-del-modelo.html#cb174-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(setas60_test.sin.olor)<span class="ot">=</span><span class="fu">colnames</span>(setas60_train.sin.olor)</span>
<span id="cb174-9"><a href="actualización-del-modelo.html#cb174-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(setas60_test.sin.olor)<span class="ot">=</span><span class="fu">rownames</span>(setas_test.sin.olor)</span>
<span id="cb174-10"><a href="actualización-del-modelo.html#cb174-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-11"><a href="actualización-del-modelo.html#cb174-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Datos validation:</span></span>
<span id="cb174-12"><a href="actualización-del-modelo.html#cb174-12" aria-hidden="true" tabindex="-1"></a>medoides_setas_validacion.sin.olor<span class="ot">=</span><span class="fu">rbind</span>(setas_train.sin.olor[k60<span class="sc">$</span>medoid,],setas_validacion.sin.olor)</span>
<span id="cb174-13"><a href="actualización-del-modelo.html#cb174-13" aria-hidden="true" tabindex="-1"></a>distancia_medoides_validacion.sin.olor<span class="ot">=</span><span class="fu">distance</span>(medoides_setas_validacion.sin.olor[,<span class="dv">2</span><span class="sc">:</span><span class="fu">dim</span>(setas_validacion.sin.olor)[<span class="dv">2</span>]],<span class="at">method=</span><span class="st">&quot;dice&quot;</span>)</span>
<span id="cb174-14"><a href="actualización-del-modelo.html#cb174-14" aria-hidden="true" tabindex="-1"></a>setas60_validacion.sin.olor<span class="ot">=</span>distancia_medoides_validacion.sin.olor[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">60</span>),<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">60</span>)]</span>
<span id="cb174-15"><a href="actualización-del-modelo.html#cb174-15" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(setas60_validacion.sin.olor)<span class="ot">=</span><span class="fu">colnames</span>(setas60_train.sin.olor)</span>
<span id="cb174-16"><a href="actualización-del-modelo.html#cb174-16" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(setas60_validacion.sin.olor)<span class="ot">=</span><span class="fu">rownames</span>(setas_validacion.sin.olor)</span></code></pre></div>
<div id="análisis-cluster-1" class="section level3" number="7.1.1">
<h3><span class="header-section-number">7.1.1</span> Análisis Cluster</h3>
<p>Aplicamos el análsis cluster a nuestros datos con el objetivo de tener grupos de setas que contengas solo setas venenosas o comestibles, pero primero vemos por cross-validation el número adecuado de cluster a aplicar.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="actualización-del-modelo.html#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Números de clusters</span></span>
<span id="cb175-2"><a href="actualización-del-modelo.html#cb175-2" aria-hidden="true" tabindex="-1"></a>SSW <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;numeric&quot;</span>, <span class="at">length =</span> <span class="dv">15</span>)</span>
<span id="cb175-3"><a href="actualización-del-modelo.html#cb175-3" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="fu">dim</span>(<span class="fu">prcomp</span>(setas60_validacion.sin.olor)<span class="sc">$</span>x)[<span class="dv">1</span>]</span>
<span id="cb175-4"><a href="actualización-del-modelo.html#cb175-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Variabilidad de todos los datos, es decir, todos los datos como un único cluster</span></span>
<span id="cb175-5"><a href="actualización-del-modelo.html#cb175-5" aria-hidden="true" tabindex="-1"></a>SSW[<span class="dv">1</span>] <span class="ot">&lt;-</span> (n <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">apply</span>(<span class="fu">prcomp</span>(setas60_validacion.sin.olor)<span class="sc">$</span>x,<span class="dv">2</span>,var)) </span>
<span id="cb175-6"><a href="actualización-del-modelo.html#cb175-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-7"><a href="actualización-del-modelo.html#cb175-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Variabilidad de cada modelo, desde 2 clusters hasta 15 clusters</span></span>
<span id="cb175-8"><a href="actualización-del-modelo.html#cb175-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">15</span>) SSW[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">kmeans</span>(<span class="fu">prcomp</span>(setas60_validacion.sin.olor)<span class="sc">$</span>x,<span class="at">centers=</span>i,<span class="at">nstart=</span><span class="dv">25</span>)<span class="sc">$</span>withinss)</span>
<span id="cb175-9"><a href="actualización-del-modelo.html#cb175-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-10"><a href="actualización-del-modelo.html#cb175-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Dibujamos un gráfico con el resultado</span></span>
<span id="cb175-11"><a href="actualización-del-modelo.html#cb175-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>, SSW, <span class="at">type=</span><span class="st">&quot;b&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;Número de clusters&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Suma de cuadrados de los grupos&quot;</span>,<span class="at">pch=</span><span class="dv">19</span>, <span class="at">col=</span><span class="st">&quot;steelblue4&quot;</span>)</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/cluster%20sin%20olor-1.png" width="672" /></p>
<p>En el gráfico podemos observar que a partir del aplicar 5 clusters a nuestros datos la suma de los cuadrados se reduce en menor medida, por ello realizamos el análisis con ese número de clusters.</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="actualización-del-modelo.html#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Análisis cluster</span></span>
<span id="cb176-2"><a href="actualización-del-modelo.html#cb176-2" aria-hidden="true" tabindex="-1"></a>clusters.datos.sin.olor<span class="ot">=</span><span class="fu">kmeans</span>(<span class="fu">prcomp</span>(setas60_train.sin.olor)<span class="sc">$</span>x,<span class="at">centers=</span><span class="dv">5</span>,<span class="at">nstart=</span><span class="dv">25</span>)</span>
<span id="cb176-3"><a href="actualización-del-modelo.html#cb176-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(clusters.datos.sin.olor<span class="sc">$</span>cluster,setas_train.sin.olor<span class="sc">$</span>Letalidad)</span></code></pre></div>
<pre><code>##    
##        0    1
##   1  885   23
##   2  532  450
##   3    0  768
##   4 1080   41
##   5   25 1070</code></pre>
<p>Podemos ver que un cluster identificar correctamente a las setas venenosas mientras que el resto de cluster las setas están un poco más repartidas.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="actualización-del-modelo.html#cb178-1" aria-hidden="true" tabindex="-1"></a>pca<span class="ot">=</span><span class="fu">prcomp</span>(setas60_train.sin.olor)<span class="sc">$</span>x</span>
<span id="cb178-2"><a href="actualización-del-modelo.html#cb178-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-3"><a href="actualización-del-modelo.html#cb178-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Gráfico de los cluster</span></span>
<span id="cb178-4"><a href="actualización-del-modelo.html#cb178-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">prcomp</span>(setas60_train.sin.olor)<span class="sc">$</span>x,<span class="at">main=</span><span class="st">&quot;Clusters&quot;</span>,<span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb178-5"><a href="actualización-del-modelo.html#cb178-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(setas60_train.sin.olor)[<span class="dv">1</span>]){</span>
<span id="cb178-6"><a href="actualización-del-modelo.html#cb178-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(pca[i,<span class="dv">1</span>],pca[i,<span class="dv">2</span>],<span class="at">pch=</span><span class="dv">19</span>,<span class="at">col=</span>clusters.datos<span class="sc">$</span>cluster[i]<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb178-7"><a href="actualización-del-modelo.html#cb178-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb178-8"><a href="actualización-del-modelo.html#cb178-8" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,   </span>
<span id="cb178-9"><a href="actualización-del-modelo.html#cb178-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">inset =</span> <span class="fl">0.01</span>, </span>
<span id="cb178-10"><a href="actualización-del-modelo.html#cb178-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb178-11"><a href="actualización-del-modelo.html#cb178-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">fil =</span> <span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">6</span>))</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/grafico%20cluster%205%20sin%20olor-1.png" width="672" /></p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="actualización-del-modelo.html#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Gráfico por tipo de setas:</span></span>
<span id="cb179-2"><a href="actualización-del-modelo.html#cb179-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb179-3"><a href="actualización-del-modelo.html#cb179-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">prcomp</span>(setas60_train.sin.olor)<span class="sc">$</span>x,<span class="at">main=</span><span class="st">&quot;Clusters: setas comestibles&quot;</span>,<span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb179-4"><a href="actualización-del-modelo.html#cb179-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(setas60_train.sin.olor)[<span class="dv">1</span>]){</span>
<span id="cb179-5"><a href="actualización-del-modelo.html#cb179-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(setas_train.sin.olor[i,<span class="dv">1</span>]<span class="sc">==</span><span class="dv">0</span>){</span>
<span id="cb179-6"><a href="actualización-del-modelo.html#cb179-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(pca[i,<span class="dv">1</span>],pca[i,<span class="dv">2</span>],<span class="at">pch=</span><span class="dv">19</span>,<span class="at">col=</span>clusters.datos<span class="sc">$</span>cluster[i]<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb179-7"><a href="actualización-del-modelo.html#cb179-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb179-8"><a href="actualización-del-modelo.html#cb179-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb179-9"><a href="actualización-del-modelo.html#cb179-9" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,   </span>
<span id="cb179-10"><a href="actualización-del-modelo.html#cb179-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">inset =</span> <span class="fl">0.01</span>, </span>
<span id="cb179-11"><a href="actualización-del-modelo.html#cb179-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb179-12"><a href="actualización-del-modelo.html#cb179-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">fil =</span> <span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">6</span>))</span>
<span id="cb179-13"><a href="actualización-del-modelo.html#cb179-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">prcomp</span>(setas60_train.sin.olor)<span class="sc">$</span>x,<span class="at">main=</span><span class="st">&quot;Clusters: setas venenosas&quot;</span>,<span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb179-14"><a href="actualización-del-modelo.html#cb179-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(setas60_train.sin.olor)[<span class="dv">1</span>]){</span>
<span id="cb179-15"><a href="actualización-del-modelo.html#cb179-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(setas_train.sin.olor[i,<span class="dv">1</span>]<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb179-16"><a href="actualización-del-modelo.html#cb179-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(pca[i,<span class="dv">1</span>],pca[i,<span class="dv">2</span>],<span class="at">pch=</span><span class="dv">19</span>,<span class="at">col=</span>clusters.datos<span class="sc">$</span>cluster[i]<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb179-17"><a href="actualización-del-modelo.html#cb179-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb179-18"><a href="actualización-del-modelo.html#cb179-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb179-19"><a href="actualización-del-modelo.html#cb179-19" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,   </span>
<span id="cb179-20"><a href="actualización-del-modelo.html#cb179-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">inset =</span> <span class="fl">0.01</span>, </span>
<span id="cb179-21"><a href="actualización-del-modelo.html#cb179-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb179-22"><a href="actualización-del-modelo.html#cb179-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">fil =</span> <span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">6</span>))</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/grafico%20cluster%205%20sin%20olor-2.png" width="672" /></p>
<p>En estos gráficos podemos ver lo que hemos comentado antes, tenemos bastante bien clasificados los tipos de setas pero uno de los cluster no clasifica tan bien como los otros, pues las setas están mezcladas, luego habría que estudiar ese para ver como diferenciar las venenosas de las comestibles.</p>
<p>Vamos a realizar otro análisis cluster pero aumentando el número de cluster con la intención de con un número mayor de cluster se clasifiquen mejor las setas.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="actualización-del-modelo.html#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Análisis cluster</span></span>
<span id="cb180-2"><a href="actualización-del-modelo.html#cb180-2" aria-hidden="true" tabindex="-1"></a>clusters.datos.train.sin.olor<span class="ot">=</span><span class="fu">kmeans</span>(<span class="fu">prcomp</span>(setas60_train.sin.olor)<span class="sc">$</span>x,<span class="at">centers=</span><span class="dv">8</span>,<span class="at">nstart=</span><span class="dv">25</span>)</span>
<span id="cb180-3"><a href="actualización-del-modelo.html#cb180-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(clusters.datos.train.sin.olor<span class="sc">$</span>cluster,setas_train.sin.olor<span class="sc">$</span>Letalidad)</span></code></pre></div>
<pre><code>##    
##       0   1
##   1   0 600
##   2 613  51
##   3 509 424
##   4 514   5
##   5 394  23
##   6 467   0
##   7   0 768
##   8  25 481</code></pre>
<p>Dos cluster agrupan exclusivamente setas venenosas y solo uno setas comestibles, los otros 5 cluster hay setas de ambas toxicidad.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="actualización-del-modelo.html#cb182-1" aria-hidden="true" tabindex="-1"></a>pca<span class="ot">=</span><span class="fu">prcomp</span>(setas60_train.sin.olor)<span class="sc">$</span>x</span>
<span id="cb182-2"><a href="actualización-del-modelo.html#cb182-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-3"><a href="actualización-del-modelo.html#cb182-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Gráfico de los cluster</span></span>
<span id="cb182-4"><a href="actualización-del-modelo.html#cb182-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">prcomp</span>(setas60_train.sin.olor)<span class="sc">$</span>x,<span class="at">main=</span><span class="st">&quot;Clusters&quot;</span>,<span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb182-5"><a href="actualización-del-modelo.html#cb182-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(setas60_train.sin.olor)[<span class="dv">1</span>]){</span>
<span id="cb182-6"><a href="actualización-del-modelo.html#cb182-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(pca[i,<span class="dv">1</span>],pca[i,<span class="dv">2</span>],<span class="at">pch=</span><span class="dv">19</span>,<span class="at">col=</span>clusters.datos.train.sin.olor<span class="sc">$</span>cluster[i]<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb182-7"><a href="actualización-del-modelo.html#cb182-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb182-8"><a href="actualización-del-modelo.html#cb182-8" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,   </span>
<span id="cb182-9"><a href="actualización-del-modelo.html#cb182-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">inset =</span> <span class="fl">0.01</span>, </span>
<span id="cb182-10"><a href="actualización-del-modelo.html#cb182-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>),</span>
<span id="cb182-11"><a href="actualización-del-modelo.html#cb182-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">fil =</span> <span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">9</span>))</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/grafico%20cluster%208%20sin%20olor-1.png" width="672" /></p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="actualización-del-modelo.html#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Gráfico por tipo de setas:</span></span>
<span id="cb183-2"><a href="actualización-del-modelo.html#cb183-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb183-3"><a href="actualización-del-modelo.html#cb183-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">prcomp</span>(setas60_train.sin.olor)<span class="sc">$</span>x,<span class="at">main=</span><span class="st">&quot;Clusters: setas comestibles&quot;</span>,<span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb183-4"><a href="actualización-del-modelo.html#cb183-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(setas60_train.sin.olor)[<span class="dv">1</span>]){</span>
<span id="cb183-5"><a href="actualización-del-modelo.html#cb183-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(setas_train.sin.olor[i,<span class="dv">1</span>]<span class="sc">==</span><span class="dv">0</span>){</span>
<span id="cb183-6"><a href="actualización-del-modelo.html#cb183-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(pca[i,<span class="dv">1</span>],pca[i,<span class="dv">2</span>],<span class="at">pch=</span><span class="dv">19</span>,<span class="at">col=</span>clusters.datos.train.sin.olor<span class="sc">$</span>cluster[i]<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb183-7"><a href="actualización-del-modelo.html#cb183-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb183-8"><a href="actualización-del-modelo.html#cb183-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb183-9"><a href="actualización-del-modelo.html#cb183-9" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,   </span>
<span id="cb183-10"><a href="actualización-del-modelo.html#cb183-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">inset =</span> <span class="fl">0.01</span>, </span>
<span id="cb183-11"><a href="actualización-del-modelo.html#cb183-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>),</span>
<span id="cb183-12"><a href="actualización-del-modelo.html#cb183-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">fil =</span> <span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">9</span>))</span>
<span id="cb183-13"><a href="actualización-del-modelo.html#cb183-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">prcomp</span>(setas60_train.sin.olor)<span class="sc">$</span>x,<span class="at">main=</span><span class="st">&quot;Clusters: setas venenosas&quot;</span>,<span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb183-14"><a href="actualización-del-modelo.html#cb183-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(setas60_train.sin.olor)[<span class="dv">1</span>]){</span>
<span id="cb183-15"><a href="actualización-del-modelo.html#cb183-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(setas_train.sin.olor[i,<span class="dv">1</span>]<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb183-16"><a href="actualización-del-modelo.html#cb183-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(pca[i,<span class="dv">1</span>],pca[i,<span class="dv">2</span>],<span class="at">pch=</span><span class="dv">19</span>,<span class="at">col=</span>clusters.datos.train.sin.olor<span class="sc">$</span>cluster[i]<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb183-17"><a href="actualización-del-modelo.html#cb183-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb183-18"><a href="actualización-del-modelo.html#cb183-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb183-19"><a href="actualización-del-modelo.html#cb183-19" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,   </span>
<span id="cb183-20"><a href="actualización-del-modelo.html#cb183-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">inset =</span> <span class="fl">0.01</span>, </span>
<span id="cb183-21"><a href="actualización-del-modelo.html#cb183-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>),</span>
<span id="cb183-22"><a href="actualización-del-modelo.html#cb183-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">fil =</span> <span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">9</span>))</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/grafico%20cluster%208%20sin%20olor-2.png" width="672" /></p>
<p>Vemos que tras realizar el análisis cluster con 8 grupos, notamos un empeoramiento de la predicción, por lo que nos quedamos con el análsis cluster con <span class="math inline">\(k=5\)</span>.</p>
</div>
<div id="k-nn-1" class="section level3" number="7.1.2">
<h3><span class="header-section-number">7.1.2</span> k-NN</h3>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="actualización-del-modelo.html#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Buscamos los vecinos más cercanos</span></span>
<span id="cb184-2"><a href="actualización-del-modelo.html#cb184-2" aria-hidden="true" tabindex="-1"></a>prediccion_knn.sin.olor<span class="ot">=</span><span class="fu">knn</span>(setas60_train.sin.olor,setas60_test.sin.olor,<span class="at">cl=</span>setas_train.sin.olor<span class="sc">$</span>Letalidad,<span class="at">k=</span><span class="dv">1</span>)</span>
<span id="cb184-3"><a href="actualización-del-modelo.html#cb184-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(prediccion_knn.sin.olor,setas_test.sin.olor<span class="sc">$</span>Letalidad)</span></code></pre></div>
<pre><code>##                        
## prediccion_knn.sin.olor   0   1
##                       0 838   2
##                       1   0 784</code></pre>
<p>La predicción con el 1-vecino más próximo, es bastante buena, lo podemos ver a simple vista en la tabla. Pero vamos a realizar un análisis con distintas medidas de precisión.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="actualización-del-modelo.html#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exactitud/Error</span></span>
<span id="cb186-2"><a href="actualización-del-modelo.html#cb186-2" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">=</span> <span class="fu">sum</span>(prediccion_knn.sin.olor <span class="sc">==</span> setas_test.sin.olor<span class="sc">$</span>Letalidad)<span class="sc">/</span><span class="fu">nrow</span>(setas_test.sin.olor)</span>
<span id="cb186-3"><a href="actualización-del-modelo.html#cb186-3" aria-hidden="true" tabindex="-1"></a>error <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span>accuracy</span>
<span id="cb186-4"><a href="actualización-del-modelo.html#cb186-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-5"><a href="actualización-del-modelo.html#cb186-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas VENENOSAS, sensitivity o recall</span></span>
<span id="cb186-6"><a href="actualización-del-modelo.html#cb186-6" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="ot">=</span> <span class="fu">sum</span>((prediccion_knn.sin.olor <span class="sc">==</span> setas_test.sin.olor<span class="sc">$</span>Letalidad) <span class="sc">&amp;</span> (setas_test.sin.olor<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.sin.olor<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb186-7"><a href="actualización-del-modelo.html#cb186-7" aria-hidden="true" tabindex="-1"></a>recall <span class="ot">=</span> sensitivity</span>
<span id="cb186-8"><a href="actualización-del-modelo.html#cb186-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-9"><a href="actualización-del-modelo.html#cb186-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas COMESTIBLES</span></span>
<span id="cb186-10"><a href="actualización-del-modelo.html#cb186-10" aria-hidden="true" tabindex="-1"></a>specificity <span class="ot">=</span>  <span class="fu">sum</span>(prediccion_knn.sin.olor <span class="sc">==</span> setas_test.sin.olor<span class="sc">$</span>Letalidad <span class="sc">&amp;</span> setas_test.sin.olor<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.sin.olor<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb186-11"><a href="actualización-del-modelo.html#cb186-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-12"><a href="actualización-del-modelo.html#cb186-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es VENENOSAS</span></span>
<span id="cb186-13"><a href="actualización-del-modelo.html#cb186-13" aria-hidden="true" tabindex="-1"></a>precision <span class="ot">=</span> <span class="fu">sum</span>( (prediccion_knn.sin.olor<span class="sc">==</span> setas_test.sin.olor<span class="sc">$</span>Letalidad) <span class="sc">&amp;</span> (prediccion_knn.sin.olor <span class="sc">==</span> <span class="dv">1</span>))<span class="sc">/</span> <span class="fu">sum</span>(prediccion_knn.sin.olor <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb186-14"><a href="actualización-del-modelo.html#cb186-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-15"><a href="actualización-del-modelo.html#cb186-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es COMESTIBLE</span></span>
<span id="cb186-16"><a href="actualización-del-modelo.html#cb186-16" aria-hidden="true" tabindex="-1"></a>npv <span class="ot">=</span> <span class="fu">sum</span>(prediccion_knn.sin.olor <span class="sc">==</span> setas_test.sin.olor<span class="sc">$</span>Letalidad <span class="sc">&amp;</span> prediccion_knn.sin.olor <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(prediccion_knn.sin.olor <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb186-17"><a href="actualización-del-modelo.html#cb186-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-18"><a href="actualización-del-modelo.html#cb186-18" aria-hidden="true" tabindex="-1"></a><span class="co"># F1_score</span></span>
<span id="cb186-19"><a href="actualización-del-modelo.html#cb186-19" aria-hidden="true" tabindex="-1"></a>f1score <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>precision<span class="sc">*</span>recall <span class="sc">/</span>(precision<span class="sc">+</span>recall)</span>
<span id="cb186-20"><a href="actualización-del-modelo.html#cb186-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-21"><a href="actualización-del-modelo.html#cb186-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla de medidas de precisión</span></span>
<span id="cb186-22"><a href="actualización-del-modelo.html#cb186-22" aria-hidden="true" tabindex="-1"></a>medidas.knn.sin.olor<span class="ot">=</span><span class="fu">c</span>(<span class="at">accuracy =</span> accuracy, <span class="at">error =</span> error, <span class="at">sensitivity =</span> sensitivity, <span class="at">specificity =</span> specificity, <span class="at">precision =</span> precision, <span class="at">npv =</span> npv, <span class="at">f1=</span>f1score)</span>
<span id="cb186-23"><a href="actualización-del-modelo.html#cb186-23" aria-hidden="true" tabindex="-1"></a>medidas.knn.sin.olor</span></code></pre></div>
<pre><code>##    accuracy       error sensitivity specificity   precision         npv 
## 0.998768473 0.001231527 0.997455471 1.000000000 1.000000000 0.997619048 
##          f1 
## 0.998726115</code></pre>
<p>Si usamos el 1 vecino más cercano, podemos ver en sus medidas de precisión que el ajueste es como decíamos, es decir, predice la toxicidad de las setas con un grado de acierto muy alto, solo comete un error del 0.3%.</p>
<p>Pero vamos a probar a calcular todas estas medidas con un número distinto de vecinos más cercano, por si acaso disminuyese ese pequeño error.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="actualización-del-modelo.html#cb188-1" aria-hidden="true" tabindex="-1"></a>k<span class="ot">=</span>(<span class="fu">dim</span>(setas60_train.sin.olor)[<span class="dv">1</span>]<span class="sc">^</span>(<span class="dv">4</span><span class="sc">/</span>(<span class="dv">4</span><span class="sc">+</span><span class="fu">dim</span>(setas60_train.sin.olor)[<span class="dv">2</span>])))<span class="sc">*</span><span class="dv">10</span></span>
<span id="cb188-2"><a href="actualización-del-modelo.html#cb188-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-3"><a href="actualización-del-modelo.html#cb188-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Matriz de las medidas de precision:</span></span>
<span id="cb188-4"><a href="actualización-del-modelo.html#cb188-4" aria-hidden="true" tabindex="-1"></a>medidas_presicision<span class="ot">=</span><span class="fu">matrix</span>(<span class="at">nrow=</span><span class="fu">round</span>(k),<span class="at">ncol=</span><span class="dv">7</span>)</span>
<span id="cb188-5"><a href="actualización-del-modelo.html#cb188-5" aria-hidden="true" tabindex="-1"></a>nombres_medidas<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;accuracy&quot;</span>, <span class="st">&quot;error&quot;</span>, <span class="st">&quot;sensitivity&quot;</span>, <span class="st">&quot;specificity&quot;</span>, <span class="st">&quot;precision&quot;</span>, <span class="st">&quot;npv&quot;</span>, <span class="st">&quot;f1score&quot;</span>)</span>
<span id="cb188-6"><a href="actualización-del-modelo.html#cb188-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(medidas_presicision)<span class="ot">=</span>nombres_medidas</span>
<span id="cb188-7"><a href="actualización-del-modelo.html#cb188-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(medidas_presicision)<span class="ot">=</span><span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">round</span>(k),<span class="dv">1</span>)</span>
<span id="cb188-8"><a href="actualización-del-modelo.html#cb188-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">round</span>(k)){</span>
<span id="cb188-9"><a href="actualización-del-modelo.html#cb188-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb188-10"><a href="actualización-del-modelo.html#cb188-10" aria-hidden="true" tabindex="-1"></a>  prediccion_knn<span class="ot">=</span><span class="fu">knn</span>(setas60_train.sin.olor,setas60_test.sin.olor,<span class="at">cl=</span>setas_train.sin.olor<span class="sc">$</span>Letalidad,<span class="at">k=</span>i)</span>
<span id="cb188-11"><a href="actualización-del-modelo.html#cb188-11" aria-hidden="true" tabindex="-1"></a>  medidas_presicision[i,<span class="dv">1</span>] <span class="ot">=</span> <span class="fu">sum</span>(prediccion_knn <span class="sc">==</span> setas_test.sin.olor<span class="sc">$</span>Letalidad)<span class="sc">/</span><span class="fu">nrow</span>(setas_test.sin.olor)</span>
<span id="cb188-12"><a href="actualización-del-modelo.html#cb188-12" aria-hidden="true" tabindex="-1"></a>  medidas_presicision[i,<span class="dv">2</span>] <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span>medidas_presicision[i,<span class="dv">1</span>]</span>
<span id="cb188-13"><a href="actualización-del-modelo.html#cb188-13" aria-hidden="true" tabindex="-1"></a>  medidas_presicision[i,<span class="dv">3</span>] <span class="ot">=</span> <span class="fu">sum</span>((prediccion_knn <span class="sc">==</span> setas_test.sin.olor<span class="sc">$</span>Letalidad) <span class="sc">&amp;</span> (setas_test.sin.olor<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">/</span><span class="fu">sum</span>(setas_test<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb188-14"><a href="actualización-del-modelo.html#cb188-14" aria-hidden="true" tabindex="-1"></a>  medidas_presicision[i,<span class="dv">4</span>] <span class="ot">=</span>  <span class="fu">sum</span>(prediccion_knn <span class="sc">==</span> setas_test.sin.olor<span class="sc">$</span>Letalidad <span class="sc">&amp;</span> setas_test.sin.olor<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(setas_test<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb188-15"><a href="actualización-del-modelo.html#cb188-15" aria-hidden="true" tabindex="-1"></a>  medidas_presicision[i,<span class="dv">5</span>] <span class="ot">=</span> <span class="fu">sum</span>( (prediccion_knn<span class="sc">==</span> setas_test.sin.olor<span class="sc">$</span>Letalidad) <span class="sc">&amp;</span> (prediccion_knn <span class="sc">==</span> <span class="dv">1</span>))<span class="sc">/</span> <span class="fu">sum</span>(prediccion_knn <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb188-16"><a href="actualización-del-modelo.html#cb188-16" aria-hidden="true" tabindex="-1"></a>  medidas_presicision[i,<span class="dv">6</span>] <span class="ot">=</span> <span class="fu">sum</span>(prediccion_knn <span class="sc">==</span> setas_test.sin.olor<span class="sc">$</span>Letalidad <span class="sc">&amp;</span> prediccion_knn <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(prediccion_knn <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb188-17"><a href="actualización-del-modelo.html#cb188-17" aria-hidden="true" tabindex="-1"></a>  medidas_presicision[i,<span class="dv">7</span>] <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>medidas_presicision[i,<span class="dv">5</span>]<span class="sc">*</span>medidas_presicision[i,<span class="dv">3</span>] <span class="sc">/</span>(medidas_presicision[i,<span class="dv">5</span>]<span class="sc">+</span>medidas_presicision[i,<span class="dv">3</span>])</span>
<span id="cb188-18"><a href="actualización-del-modelo.html#cb188-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb188-19"><a href="actualización-del-modelo.html#cb188-19" aria-hidden="true" tabindex="-1"></a>medidas_presicision</span></code></pre></div>
<pre><code>##     accuracy       error sensitivity specificity precision       npv   f1score
## 1  0.9987685 0.001231527   0.9974555   1.0000000 1.0000000 0.9976190 0.9987261
## 2  0.9969212 0.003078818   0.9961832   0.9976134 0.9974522 0.9964243 0.9968173
## 3  0.9956897 0.004310345   0.9961832   0.9952267 0.9949174 0.9964158 0.9955499
## 4  0.9969212 0.003078818   1.0000000   0.9940334 0.9936789 1.0000000 0.9968294
## 5  0.9956897 0.004310345   0.9987277   0.9928401 0.9924147 0.9987995 0.9955612
## 6  0.9950739 0.004926108   0.9987277   0.9916468 0.9911616 0.9987981 0.9949303
## 7  0.9956897 0.004310345   1.0000000   0.9916468 0.9911728 1.0000000 0.9955668
## 8  0.9956897 0.004310345   1.0000000   0.9916468 0.9911728 1.0000000 0.9955668
## 9  0.9956897 0.004310345   1.0000000   0.9916468 0.9911728 1.0000000 0.9955668
## 10 0.9944581 0.005541872   0.9987277   0.9904535 0.9899117 0.9987966 0.9943002
## 11 0.9938424 0.006157635   0.9987277   0.9892601 0.9886650 0.9987952 0.9936709
## 12 0.9932266 0.006773399   0.9974555   0.9892601 0.9886507 0.9975933 0.9930336
## 13 0.9932266 0.006773399   0.9974555   0.9892601 0.9886507 0.9975933 0.9930336
## 14 0.9938424 0.006157635   0.9961832   0.9916468 0.9911392 0.9964029 0.9936548
## 15 0.9938424 0.006157635   0.9961832   0.9916468 0.9911392 0.9964029 0.9936548
## 16 0.9926108 0.007389163   0.9961832   0.9892601 0.9886364 0.9963942 0.9923954
## 17 0.9907635 0.009236453   0.9923664   0.9892601 0.9885932 0.9928144 0.9904762</code></pre>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="actualización-del-modelo.html#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Grafico de las medidas de precision</span></span>
<span id="cb190-2"><a href="actualización-del-modelo.html#cb190-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">round</span>(k)),medidas_presicision[,<span class="dv">1</span>],<span class="at">main=</span><span class="st">&quot;Medidas de precision&quot;</span>,<span class="at">type=</span><span class="st">&quot;n&quot;</span>,<span class="at">xlab=</span><span class="st">&quot;Número de k vecinos&quot;</span>,<span class="at">ylab=</span><span class="st">&quot;&quot;</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="fu">round</span>(k)<span class="sc">+</span><span class="dv">2</span>))</span>
<span id="cb190-3"><a href="actualización-del-modelo.html#cb190-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) {</span>
<span id="cb190-4"><a href="actualización-del-modelo.html#cb190-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(<span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">round</span>(k)),medidas_presicision[,i],<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">col=</span>i<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb190-5"><a href="actualización-del-modelo.html#cb190-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">round</span>(k)),medidas_presicision[,i],<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">col=</span>i<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb190-6"><a href="actualización-del-modelo.html#cb190-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb190-7"><a href="actualización-del-modelo.html#cb190-7" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,   </span>
<span id="cb190-8"><a href="actualización-del-modelo.html#cb190-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">inset =</span> <span class="fl">0.01</span>, </span>
<span id="cb190-9"><a href="actualización-del-modelo.html#cb190-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Ac&quot;</span>,<span class="st">&quot;Er&quot;</span>, <span class="st">&quot;Se&quot;</span>,<span class="st">&quot;Sp&quot;</span>,<span class="st">&quot;Pr&quot;</span>,<span class="st">&quot;NPV&quot;</span>,<span class="st">&quot;F1&quot;</span>),</span>
<span id="cb190-10"><a href="actualización-del-modelo.html#cb190-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">fil =</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="fu">round</span>(k)<span class="sc">+</span><span class="dv">1</span>))</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/knn%20cross-validation%20sin%20olor-1.png" width="672" /></p>
<p>Observamos que al ir aumentando el número de k-vecinos el error va aumentando pero sigue siendo muy pequeño, el mayor error cometido con el número de k-vecinos probado es de 0,9%, bastante despreciable como para descartar este modelo por ello, es más pequeño que el error cometido cuando incluimos la variable <strong>Olor</strong>.</p>
</div>
<div id="arboles-de-decisión-1" class="section level3" number="7.1.3">
<h3><span class="header-section-number">7.1.3</span> Arboles de Decisión</h3>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="actualización-del-modelo.html#cb191-1" aria-hidden="true" tabindex="-1"></a>setas60_train.respuesta.sin.olor<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">cbind</span>(setas_train.sin.olor[,<span class="dv">1</span>],setas60_train.sin.olor))</span>
<span id="cb191-2"><a href="actualización-del-modelo.html#cb191-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(setas60_train.respuesta.sin.olor)[<span class="dv">1</span>]<span class="ot">=</span><span class="st">&quot;Letalidad&quot;</span></span>
<span id="cb191-3"><a href="actualización-del-modelo.html#cb191-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4"><a href="actualización-del-modelo.html#cb191-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Árbol de decisión:</span></span>
<span id="cb191-5"><a href="actualización-del-modelo.html#cb191-5" aria-hidden="true" tabindex="-1"></a>arbol.sin.olor<span class="ot">=</span><span class="fu">rpart</span>(<span class="fu">as.factor</span>(setas60_train.respuesta.sin.olor<span class="sc">$</span>Letalidad)<span class="sc">~</span>., <span class="at">data=</span>setas60_train.respuesta.sin.olor,<span class="at">method=</span><span class="st">&quot;class&quot;</span>)</span>
<span id="cb191-6"><a href="actualización-del-modelo.html#cb191-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(arbol.sin.olor)</span></code></pre></div>
<pre><code>## Call:
## rpart(formula = as.factor(setas60_train.respuesta.sin.olor$Letalidad) ~ 
##     ., data = setas60_train.respuesta.sin.olor, method = &quot;class&quot;)
##   n= 4874 
## 
##            CP nsplit  rel error    xerror        xstd
## 1  0.72023810      0 1.00000000 1.0000000 0.014832389
## 2  0.03698980      1 0.27976190 0.2797619 0.010143391
## 3  0.02423469      3 0.20578231 0.2074830 0.008909722
## 4  0.01955782      4 0.18154762 0.1840986 0.008445089
## 5  0.01743197      5 0.16198980 0.1738946 0.008229857
## 6  0.01700680      6 0.14455782 0.1619898 0.007968024
## 7  0.01318027      7 0.12755102 0.1352041 0.007330361
## 8  0.01275510      8 0.11437075 0.1271259 0.007122805
## 9  0.01062925      9 0.10161565 0.1126701 0.006730483
## 10 0.01000000     10 0.09098639 0.1033163 0.006460415
## 
## Variable importance
##  v152   v51 v3303  v263 v4537  v664 v4008 v4439 v2951 v1626  v829 v3686 v1799 
##    16    16    14    13    12    12     3     2     1     1     1     1     1 
## v2036  v808 v1709 v1993 v1638  v380 v1909 v1614 v1441 v1863 
##     1     1     1     1     1     1     1     1     1     1 
## 
## Node number 1: 4874 observations,    complexity param=0.7202381
##   predicted class=0  expected loss=0.4825605  P(node) =1
##     class counts:  2522  2352
##    probabilities: 0.517 0.483 
##   left son=2 (2994 obs) right son=3 (1880 obs)
##   Primary splits:
##       v152  &lt; 0.5894737  to the left,  improve=1340.4800, (0 missing)
##       v51   &lt; 0.5894737  to the left,  improve=1330.1000, (0 missing)
##       v263  &lt; 0.5894737  to the left,  improve=1143.0300, (0 missing)
##       v4537 &lt; 0.5361345  to the right, improve=1041.9290, (0 missing)
##       v664  &lt; 0.5615616  to the left,  improve= 956.7019, (0 missing)
##   Surrogate splits:
##       v51   &lt; 0.5894737  to the left,  agree=0.995, adj=0.988, (0 split)
##       v3303 &lt; 0.5492063  to the left,  agree=0.939, adj=0.842, (0 split)
##       v263  &lt; 0.5894737  to the left,  agree=0.932, adj=0.823, (0 split)
##       v664  &lt; 0.5615616  to the left,  agree=0.905, adj=0.755, (0 split)
##       v4537 &lt; 0.5941176  to the right, agree=0.884, adj=0.700, (0 split)
## 
## Node number 2: 2994 observations,    complexity param=0.0369898
##   predicted class=0  expected loss=0.1887108  P(node) =0.6142799
##     class counts:  2429   565
##    probabilities: 0.811 0.189 
##   left son=4 (2518 obs) right son=5 (476 obs)
##   Primary splits:
##       v4008 &lt; 0.4781513  to the right, improve=180.6841, (0 missing)
##       v829  &lt; 0.2859477  to the right, improve=161.8533, (0 missing)
##       v4439 &lt; 0.402852   to the right, improve=138.4766, (0 missing)
##       v3303 &lt; 0.2327327  to the right, improve=137.8909, (0 missing)
##       v4537 &lt; 0.5147059  to the right, improve=107.7395, (0 missing)
##   Surrogate splits:
##       v4439 &lt; 0.4330357  to the right, agree=0.919, adj=0.489, (0 split)
##       v4537 &lt; 0.5147059  to the right, agree=0.868, adj=0.170, (0 split)
##       v3686 &lt; 0.3133929  to the right, agree=0.867, adj=0.162, (0 split)
##       v1389 &lt; 0.1547619  to the right, agree=0.851, adj=0.061, (0 split)
##       v1424 &lt; 0.1547619  to the right, agree=0.850, adj=0.055, (0 split)
## 
## Node number 3: 1880 observations,    complexity param=0.0170068
##   predicted class=1  expected loss=0.04946809  P(node) =0.3857201
##     class counts:    93  1787
##    probabilities: 0.049 0.951 
##   left son=6 (46 obs) right son=7 (1834 obs)
##   Primary splits:
##       v4537 &lt; 0.7321429  to the right, improve=73.91652, (0 missing)
##       v380  &lt; 0.40625    to the left,  improve=70.08341, (0 missing)
##       v2435 &lt; 0.7941176  to the right, improve=47.64144, (0 missing)
##       v2345 &lt; 0.7472178  to the right, improve=33.68476, (0 missing)
##       v1489 &lt; 0.4928571  to the left,  improve=19.14245, (0 missing)
##   Surrogate splits:
##       v380  &lt; 0.40625    to the left,  agree=0.996, adj=0.826, (0 split)
##       v2435 &lt; 0.7941176  to the right, agree=0.989, adj=0.565, (0 split)
##       v2345 &lt; 0.7472178  to the right, agree=0.981, adj=0.239, (0 split)
##       v3422 &lt; 0.7472178  to the right, agree=0.981, adj=0.239, (0 split)
##       v51   &lt; 0.5714286  to the left,  agree=0.980, adj=0.174, (0 split)
## 
## Node number 4: 2518 observations,    complexity param=0.02423469
##   predicted class=0  expected loss=0.1131851  P(node) =0.5166188
##     class counts:  2233   285
##    probabilities: 0.887 0.113 
##   left son=8 (2443 obs) right son=9 (75 obs)
##   Primary splits:
##       v3303 &lt; 0.2327327  to the right, improve=90.90853, (0 missing)
##       v829  &lt; 0.2859477  to the right, improve=76.78259, (0 missing)
##       v1021 &lt; 0.2327327  to the right, improve=64.38235, (0 missing)
##       v152  &lt; 0.424812   to the right, improve=57.17467, (0 missing)
##       v51   &lt; 0.424812   to the right, improve=44.62425, (0 missing)
##   Surrogate splits:
##       v152  &lt; 0.02631579 to the right, agree=0.971, adj=0.027, (0 split)
##       v3686 &lt; 0.701426   to the left,  agree=0.971, adj=0.027, (0 split)
## 
## Node number 5: 476 observations,    complexity param=0.0369898
##   predicted class=1  expected loss=0.4117647  P(node) =0.09766106
##     class counts:   196   280
##    probabilities: 0.412 0.588 
##   left son=10 (100 obs) right son=11 (376 obs)
##   Primary splits:
##       v1799 &lt; 0.3042017  to the left,  improve=73.34887, (0 missing)
##       v2158 &lt; 0.352381   to the left,  improve=69.57042, (0 missing)
##       v1709 &lt; 0.3042017  to the left,  improve=69.57042, (0 missing)
##       v1993 &lt; 0.3621849  to the left,  improve=69.37825, (0 missing)
##       v1638 &lt; 0.3621849  to the left,  improve=68.34782, (0 missing)
##   Surrogate splits:
##       v808  &lt; 0.3621849  to the left,  agree=0.975, adj=0.88, (0 split)
##       v2036 &lt; 0.3621849  to the left,  agree=0.975, adj=0.88, (0 split)
##       v1709 &lt; 0.3621849  to the left,  agree=0.973, adj=0.87, (0 split)
##       v1993 &lt; 0.3621849  to the left,  agree=0.968, adj=0.85, (0 split)
##       v1638 &lt; 0.3621849  to the left,  agree=0.966, adj=0.84, (0 split)
## 
## Node number 6: 46 observations
##   predicted class=0  expected loss=0.06521739  P(node) =0.009437833
##     class counts:    43     3
##    probabilities: 0.935 0.065 
## 
## Node number 7: 1834 observations
##   predicted class=1  expected loss=0.02726281  P(node) =0.3762823
##     class counts:    50  1784
##    probabilities: 0.027 0.973 
## 
## Node number 8: 2443 observations,    complexity param=0.01743197
##   predicted class=0  expected loss=0.08964388  P(node) =0.501231
##     class counts:  2224   219
##    probabilities: 0.910 0.090 
##   left son=16 (2334 obs) right son=17 (109 obs)
##   Primary splits:
##       v829  &lt; 0.2859477  to the right, improve=81.71563, (0 missing)
##       v1021 &lt; 0.2327327  to the right, improve=69.88437, (0 missing)
##       v4537 &lt; 0.8517857  to the left,  improve=45.25254, (0 missing)
##       v2951 &lt; 0.2237077  to the right, improve=42.11791, (0 missing)
##       v152  &lt; 0.424812   to the right, improve=32.58705, (0 missing)
##   Surrogate splits:
##       v1021 &lt; 0.2327327  to the right, agree=0.972, adj=0.376, (0 split)
##       v3686 &lt; 0.3042017  to the right, agree=0.956, adj=0.018, (0 split)
##       v2147 &lt; 0.08333333 to the right, agree=0.956, adj=0.009, (0 split)
## 
## Node number 9: 75 observations
##   predicted class=1  expected loss=0.12  P(node) =0.01538777
##     class counts:     9    66
##    probabilities: 0.120 0.880 
## 
## Node number 10: 100 observations
##   predicted class=0  expected loss=0.05  P(node) =0.02051703
##     class counts:    95     5
##    probabilities: 0.950 0.050 
## 
## Node number 11: 376 observations,    complexity param=0.01955782
##   predicted class=1  expected loss=0.268617  P(node) =0.07714403
##     class counts:   101   275
##    probabilities: 0.269 0.731 
##   left son=22 (108 obs) right son=23 (268 obs)
##   Primary splits:
##       v1626 &lt; 0.6163664  to the right, improve=59.83417, (0 missing)
##       v1993 &lt; 0.6163664  to the right, improve=57.87019, (0 missing)
##       v2951 &lt; 0.5222816  to the right, improve=57.46581, (0 missing)
##       v749  &lt; 0.4781513  to the right, improve=53.52919, (0 missing)
##       v2036 &lt; 0.5361345  to the right, improve=52.69246, (0 missing)
##   Surrogate splits:
##       v1909 &lt; 0.5067568  to the right, agree=0.947, adj=0.815, (0 split)
##       v1614 &lt; 0.5067568  to the right, agree=0.941, adj=0.796, (0 split)
##       v1441 &lt; 0.5067568  to the right, agree=0.934, adj=0.769, (0 split)
##       v1863 &lt; 0.451952   to the right, agree=0.926, adj=0.741, (0 split)
##       v1811 &lt; 0.451952   to the right, agree=0.912, adj=0.694, (0 split)
## 
## Node number 16: 2334 observations,    complexity param=0.01062925
##   predicted class=0  expected loss=0.06169666  P(node) =0.4788675
##     class counts:  2190   144
##    probabilities: 0.938 0.062 
##   left son=32 (2285 obs) right son=33 (49 obs)
##   Primary splits:
##       v2951 &lt; 0.2237077  to the right, improve=48.12992, (0 missing)
##       v4537 &lt; 0.8517857  to the left,  improve=48.09872, (0 missing)
##       v152  &lt; 0.424812   to the right, improve=11.71622, (0 missing)
##       v2345 &lt; 0.4085851  to the left,  improve=11.68121, (0 missing)
##       v2158 &lt; 0.3971471  to the left,  improve=11.63774, (0 missing)
##   Surrogate splits:
##       v4537 &lt; 0.8517857  to the left,  agree=0.981, adj=0.102, (0 split)
## 
## Node number 17: 109 observations,    complexity param=0.0127551
##   predicted class=1  expected loss=0.3119266  P(node) =0.02236356
##     class counts:    34    75
##    probabilities: 0.312 0.688 
##   left son=34 (30 obs) right son=35 (79 obs)
##   Primary splits:
##       v2951 &lt; 0.3621849  to the left,  improve=39.19405, (0 missing)
##       v2766 &lt; 0.6619048  to the left,  improve=37.41138, (0 missing)
##       v152  &lt; 0.413229   to the right, improve=33.68808, (0 missing)
##       v51   &lt; 0.413229   to the right, improve=33.68808, (0 missing)
##       v1489 &lt; 0.3801587  to the left,  improve=27.52181, (0 missing)
##   Surrogate splits:
##       v152  &lt; 0.4327485  to the right, agree=0.954, adj=0.833, (0 split)
##       v51   &lt; 0.4327485  to the right, agree=0.954, adj=0.833, (0 split)
##       v1827 &lt; 0.6619048  to the left,  agree=0.917, adj=0.700, (0 split)
##       v1626 &lt; 0.4365079  to the left,  agree=0.917, adj=0.700, (0 split)
##       v2766 &lt; 0.6619048  to the left,  agree=0.917, adj=0.700, (0 split)
## 
## Node number 22: 108 observations,    complexity param=0.01318027
##   predicted class=0  expected loss=0.287037  P(node) =0.02215839
##     class counts:    77    31
##    probabilities: 0.713 0.287 
##   left son=44 (77 obs) right son=45 (31 obs)
##   Primary splits:
##       v4439 &lt; 0.2508929  to the right, improve=44.20370, (0 missing)
##       v3686 &lt; 0.3419643  to the right, improve=44.20370, (0 missing)
##       v4008 &lt; 0.2508929  to the right, improve=44.20370, (0 missing)
##       v4537 &lt; 0.4901786  to the right, improve=44.20370, (0 missing)
##       v664  &lt; 0.5345865  to the left,  improve=34.67513, (0 missing)
##   Surrogate splits:
##       v3686 &lt; 0.3419643  to the right, agree=1.000, adj=1.000, (0 split)
##       v4008 &lt; 0.2508929  to the right, agree=1.000, adj=1.000, (0 split)
##       v4537 &lt; 0.4901786  to the right, agree=1.000, adj=1.000, (0 split)
##       v664  &lt; 0.5345865  to the left,  agree=0.954, adj=0.839, (0 split)
##       v263  &lt; 0.5894737  to the left,  agree=0.917, adj=0.710, (0 split)
## 
## Node number 23: 268 observations
##   predicted class=1  expected loss=0.08955224  P(node) =0.05498564
##     class counts:    24   244
##    probabilities: 0.090 0.910 
## 
## Node number 32: 2285 observations
##   predicted class=0  expected loss=0.04682713  P(node) =0.4688141
##     class counts:  2178   107
##    probabilities: 0.953 0.047 
## 
## Node number 33: 49 observations
##   predicted class=1  expected loss=0.244898  P(node) =0.01005334
##     class counts:    12    37
##    probabilities: 0.245 0.755 
## 
## Node number 34: 30 observations
##   predicted class=0  expected loss=0  P(node) =0.006155109
##     class counts:    30     0
##    probabilities: 1.000 0.000 
## 
## Node number 35: 79 observations
##   predicted class=1  expected loss=0.05063291  P(node) =0.01620845
##     class counts:     4    75
##    probabilities: 0.051 0.949 
## 
## Node number 44: 77 observations
##   predicted class=0  expected loss=0  P(node) =0.01579811
##     class counts:    77     0
##    probabilities: 1.000 0.000 
## 
## Node number 45: 31 observations
##   predicted class=1  expected loss=0  P(node) =0.006360279
##     class counts:     0    31
##    probabilities: 0.000 1.000</code></pre>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="actualización-del-modelo.html#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(arbol.sin.olor)</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/arbol%20de%20decision%20sin%20olor-1.png" width="672" /></p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="actualización-del-modelo.html#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla comparativa:</span></span>
<span id="cb194-2"><a href="actualización-del-modelo.html#cb194-2" aria-hidden="true" tabindex="-1"></a>setas60_test.data.sin.olor<span class="ot">=</span><span class="fu">as.data.frame</span>(setas60_test.sin.olor)</span>
<span id="cb194-3"><a href="actualización-del-modelo.html#cb194-3" aria-hidden="true" tabindex="-1"></a>prediccion.arbol.sin.olor<span class="ot">=</span><span class="fu">round</span>(<span class="fu">predict</span>(arbol.sin.olor,setas60_test.data.sin.olor)[,<span class="dv">2</span>])</span>
<span id="cb194-4"><a href="actualización-del-modelo.html#cb194-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(prediccion.arbol.sin.olor,setas_test[,<span class="dv">1</span>])</span></code></pre></div>
<pre><code>##                          
## prediccion.arbol.sin.olor   0   1
##                         0 797  53
##                         1  41 733</code></pre>
<p>El gráfico resultante podemos interpretarlo basándonos en cuánto se parece una seta a los medoides más importantes como son las observaciones 152, 51 y 3303, son observaciones distintas que cuando hemos aplicado el modelo a los datos con la variable <strong>Olor</strong></p>
<p>En la tabla podemos ver que a la hora de predecir nuestro árbol de decisión comete cierto error, a continuación analizamos ese error con distintas medidas de precisión.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="actualización-del-modelo.html#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exactitud/Error</span></span>
<span id="cb196-2"><a href="actualización-del-modelo.html#cb196-2" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">=</span> <span class="fu">sum</span>(prediccion.arbol.sin.olor <span class="sc">==</span> setas_test[,<span class="dv">1</span>])<span class="sc">/</span><span class="fu">nrow</span>(setas_test.sin.olor)</span>
<span id="cb196-3"><a href="actualización-del-modelo.html#cb196-3" aria-hidden="true" tabindex="-1"></a>error <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span>accuracy</span>
<span id="cb196-4"><a href="actualización-del-modelo.html#cb196-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-5"><a href="actualización-del-modelo.html#cb196-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas VENENOSAS, sensitivity o recall</span></span>
<span id="cb196-6"><a href="actualización-del-modelo.html#cb196-6" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="ot">=</span> <span class="fu">sum</span>((prediccion.arbol.sin.olor <span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb196-7"><a href="actualización-del-modelo.html#cb196-7" aria-hidden="true" tabindex="-1"></a>recall <span class="ot">=</span> sensitivity</span>
<span id="cb196-8"><a href="actualización-del-modelo.html#cb196-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-9"><a href="actualización-del-modelo.html#cb196-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas COMESTIBLES</span></span>
<span id="cb196-10"><a href="actualización-del-modelo.html#cb196-10" aria-hidden="true" tabindex="-1"></a>specificity <span class="ot">=</span>  <span class="fu">sum</span>(prediccion.arbol.sin.olor <span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb196-11"><a href="actualización-del-modelo.html#cb196-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-12"><a href="actualización-del-modelo.html#cb196-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es VENENOSAS</span></span>
<span id="cb196-13"><a href="actualización-del-modelo.html#cb196-13" aria-hidden="true" tabindex="-1"></a>precision <span class="ot">=</span> <span class="fu">sum</span>( (prediccion.arbol.sin.olor<span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (prediccion.arbol.sin.olor <span class="sc">==</span> <span class="dv">1</span>))<span class="sc">/</span> <span class="fu">sum</span>(prediccion.arbol.sin.olor <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb196-14"><a href="actualización-del-modelo.html#cb196-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-15"><a href="actualización-del-modelo.html#cb196-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es COMESTIBLE</span></span>
<span id="cb196-16"><a href="actualización-del-modelo.html#cb196-16" aria-hidden="true" tabindex="-1"></a>npv <span class="ot">=</span> <span class="fu">sum</span>(prediccion.arbol.sin.olor<span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> prediccion.arbol.sin.olor <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(prediccion.arbol.sin.olor <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb196-17"><a href="actualización-del-modelo.html#cb196-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-18"><a href="actualización-del-modelo.html#cb196-18" aria-hidden="true" tabindex="-1"></a><span class="co"># F1_score</span></span>
<span id="cb196-19"><a href="actualización-del-modelo.html#cb196-19" aria-hidden="true" tabindex="-1"></a>f1score <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>precision<span class="sc">*</span>recall <span class="sc">/</span>(precision<span class="sc">+</span>recall)</span>
<span id="cb196-20"><a href="actualización-del-modelo.html#cb196-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-21"><a href="actualización-del-modelo.html#cb196-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla de medidas de precisión</span></span>
<span id="cb196-22"><a href="actualización-del-modelo.html#cb196-22" aria-hidden="true" tabindex="-1"></a>medidas.arboles.sin.olor<span class="ot">=</span><span class="fu">c</span>(<span class="at">accuracy =</span> accuracy, <span class="at">error =</span> error, <span class="at">sensitivity =</span> sensitivity, <span class="at">specificity =</span> specificity, <span class="at">precision =</span> precision, <span class="at">npv =</span> npv, <span class="at">f1=</span>f1score)</span>
<span id="cb196-23"><a href="actualización-del-modelo.html#cb196-23" aria-hidden="true" tabindex="-1"></a>medidas.arboles.sin.olor</span></code></pre></div>
<pre><code>##    accuracy       error sensitivity specificity   precision         npv 
##  0.94211823  0.05788177  0.93256997  0.95107399  0.94702842  0.93764706 
##          f1 
##  0.93974359</code></pre>
<p>El error que se comete es superior,5%, que en el caso del modelo k-NN con el vecino más próximo, por lo que podemos determinar que el árbol de decisión predice peor. Además el error cometido es inferior al cometido por el mismo modelo pero con la variable <strong>Olor</strong>.</p>
</div>
<div id="bosques-aleatorios-1" class="section level3" number="7.1.4">
<h3><span class="header-section-number">7.1.4</span> Bosques Aleatorios</h3>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="actualización-del-modelo.html#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">34735</span>)</span>
<span id="cb198-2"><a href="actualización-del-modelo.html#cb198-2" aria-hidden="true" tabindex="-1"></a>setas.rf.sin.olor<span class="ot">=</span><span class="fu">randomForest</span>(setas60_train.sin.olor, <span class="fu">as.factor</span>(setas60_train.respuesta.sin.olor<span class="sc">$</span>Letalidad), <span class="at">ntree=</span><span class="dv">100</span>, <span class="at">importance=</span><span class="cn">FALSE</span>, <span class="at">proximity=</span><span class="cn">TRUE</span>, <span class="at">mtry=</span><span class="dv">4</span>, <span class="at">replace=</span><span class="cn">FALSE</span>,<span class="at">method=</span><span class="st">&quot;class&quot;</span>)</span>
<span id="cb198-3"><a href="actualización-del-modelo.html#cb198-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-4"><a href="actualización-del-modelo.html#cb198-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla comparativa</span></span>
<span id="cb198-5"><a href="actualización-del-modelo.html#cb198-5" aria-hidden="true" tabindex="-1"></a>prediccion.rf.sin.olor<span class="ot">=</span><span class="fu">predict</span>(setas.rf.sin.olor, setas60_test.data.sin.olor)</span>
<span id="cb198-6"><a href="actualización-del-modelo.html#cb198-6" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(prediccion.rf.sin.olor,<span class="fu">as.factor</span>(setas_test.sin.olor[,<span class="dv">1</span>]))</span></code></pre></div>
<pre><code>##                       
## prediccion.rf.sin.olor   0   1
##                      0 831   2
##                      1   7 784</code></pre>
<p>La predicción se equivoca clasificando 9 setas, empeora respecto la predicción con la variable <strong>Olor</strong>. Analizamos la precisión de los bosques aleatorios con las medidas de precisión.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="actualización-del-modelo.html#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exactitud/Error</span></span>
<span id="cb200-2"><a href="actualización-del-modelo.html#cb200-2" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">=</span> <span class="fu">sum</span>(prediccion.rf.sin.olor <span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>])<span class="sc">/</span><span class="fu">nrow</span>(setas_test.sin.olor)</span>
<span id="cb200-3"><a href="actualización-del-modelo.html#cb200-3" aria-hidden="true" tabindex="-1"></a>error <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span>accuracy</span>
<span id="cb200-4"><a href="actualización-del-modelo.html#cb200-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-5"><a href="actualización-del-modelo.html#cb200-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Sensibilidad: acierto sobre el total de las setas VENENOSAS</span></span>
<span id="cb200-6"><a href="actualización-del-modelo.html#cb200-6" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="ot">=</span> <span class="fu">sum</span>((prediccion.rf.sin.olor <span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb200-7"><a href="actualización-del-modelo.html#cb200-7" aria-hidden="true" tabindex="-1"></a>recall <span class="ot">=</span> sensitivity</span>
<span id="cb200-8"><a href="actualización-del-modelo.html#cb200-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-9"><a href="actualización-del-modelo.html#cb200-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Especifidad: acierto sobre el total de las setas COMESTIBLES</span></span>
<span id="cb200-10"><a href="actualización-del-modelo.html#cb200-10" aria-hidden="true" tabindex="-1"></a>specificity <span class="ot">=</span>  <span class="fu">sum</span>(prediccion.rf.sin.olor <span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb200-11"><a href="actualización-del-modelo.html#cb200-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-12"><a href="actualización-del-modelo.html#cb200-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Precisión: acierto cuando el predicho es VENENOSAS</span></span>
<span id="cb200-13"><a href="actualización-del-modelo.html#cb200-13" aria-hidden="true" tabindex="-1"></a>precision <span class="ot">=</span> <span class="fu">sum</span>( (prediccion.rf.sin.olor<span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (prediccion.rf.sin.olor <span class="sc">==</span> <span class="dv">1</span>))<span class="sc">/</span> <span class="fu">sum</span>(prediccion.rf.sin.olor <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb200-14"><a href="actualización-del-modelo.html#cb200-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-15"><a href="actualización-del-modelo.html#cb200-15" aria-hidden="true" tabindex="-1"></a><span class="co"># NPV: acierto cuando el predicho es COMESTIBLE</span></span>
<span id="cb200-16"><a href="actualización-del-modelo.html#cb200-16" aria-hidden="true" tabindex="-1"></a>npv <span class="ot">=</span> <span class="fu">sum</span>(prediccion.rf.sin.olor<span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> prediccion.rf.sin.olor <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(prediccion.rf.sin.olor <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb200-17"><a href="actualización-del-modelo.html#cb200-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-18"><a href="actualización-del-modelo.html#cb200-18" aria-hidden="true" tabindex="-1"></a><span class="co"># F1_score</span></span>
<span id="cb200-19"><a href="actualización-del-modelo.html#cb200-19" aria-hidden="true" tabindex="-1"></a>f1score <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>precision<span class="sc">*</span>recall <span class="sc">/</span>(precision<span class="sc">+</span>recall)</span>
<span id="cb200-20"><a href="actualización-del-modelo.html#cb200-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-21"><a href="actualización-del-modelo.html#cb200-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla de medidas de precisión</span></span>
<span id="cb200-22"><a href="actualización-del-modelo.html#cb200-22" aria-hidden="true" tabindex="-1"></a>medidas.bosques.sin.olor<span class="ot">=</span><span class="fu">c</span>(<span class="at">accuracy =</span> accuracy, <span class="at">error =</span> error, <span class="at">sensitivity =</span> sensitivity, <span class="at">specificity =</span> specificity, <span class="at">precision =</span> precision, <span class="at">npv =</span> npv, <span class="at">f1=</span>f1score)</span>
<span id="cb200-23"><a href="actualización-del-modelo.html#cb200-23" aria-hidden="true" tabindex="-1"></a>medidas.bosques.sin.olor</span></code></pre></div>
<pre><code>##    accuracy       error sensitivity specificity   precision         npv 
## 0.994458128 0.005541872 0.997455471 0.991646778 0.991150442 0.997599040 
##          f1 
## 0.994292961</code></pre>
<p>El error que se comete mejora respecto al algoritmo anterior, pero es superior al error cometido por el modelo k-NN.</p>
</div>
<div id="support-vector-machines-1" class="section level3" number="7.1.5">
<h3><span class="header-section-number">7.1.5</span> Support Vector Machines</h3>
<p>Para determinar el valor de gamma y el coste, usamos los datos que hemos reservado para validación y realizamos una estimación con ellos.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="actualización-del-modelo.html#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Para estimar el gamma: </span></span>
<span id="cb202-2"><a href="actualización-del-modelo.html#cb202-2" aria-hidden="true" tabindex="-1"></a>gamma_est<span class="ot">=</span><span class="dv">1</span><span class="sc">/</span><span class="fu">apply</span>(setas60_validacion.sin.olor,<span class="dv">2</span>,sd)</span>
<span id="cb202-3"><a href="actualización-del-modelo.html#cb202-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Para estimar el coste: </span></span>
<span id="cb202-4"><a href="actualización-del-modelo.html#cb202-4" aria-hidden="true" tabindex="-1"></a>norma2<span class="ot">&lt;-</span><span class="cf">function</span>(x) <span class="fu">sqrt</span>(<span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb202-5"><a href="actualización-del-modelo.html#cb202-5" aria-hidden="true" tabindex="-1"></a>cost_est<span class="ot">=</span><span class="fu">apply</span>(setas60_validacion.sin.olor,<span class="dv">2</span>,norma2)</span>
<span id="cb202-6"><a href="actualización-del-modelo.html#cb202-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-7"><a href="actualización-del-modelo.html#cb202-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Ajustamos el modelo</span></span>
<span id="cb202-8"><a href="actualización-del-modelo.html#cb202-8" aria-hidden="true" tabindex="-1"></a>setas.svm.sin.olor<span class="ot">=</span><span class="fu">svm</span>(setas60_train.sin.olor,setas_train.sin.olor[,<span class="dv">1</span>],<span class="at">type=</span><span class="st">&quot;C-classification&quot;</span>,<span class="at">kernel=</span><span class="st">&quot;radial&quot;</span>,<span class="at">gamma=</span><span class="fu">mean</span>(gamma_est),<span class="at">cost=</span><span class="fu">mean</span>(cost_est),<span class="at">scale=</span>F)</span>
<span id="cb202-9"><a href="actualización-del-modelo.html#cb202-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-10"><a href="actualización-del-modelo.html#cb202-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla comparativa</span></span>
<span id="cb202-11"><a href="actualización-del-modelo.html#cb202-11" aria-hidden="true" tabindex="-1"></a>prediccion_svm.sin.olor<span class="ot">=</span><span class="fu">predict</span>(setas.svm.sin.olor,setas60_test.sin.olor)</span>
<span id="cb202-12"><a href="actualización-del-modelo.html#cb202-12" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(prediccion_svm.sin.olor,setas_test.sin.olor[,<span class="dv">1</span>])</span></code></pre></div>
<pre><code>##                        
## prediccion_svm.sin.olor   0   1
##                       0 838   0
##                       1   0 786</code></pre>
<p>La tabla nos dice que el modelo predice a la perfección los datos. Las medidas de precisión no van a aportar nada que no sepamos con mirar simplemente la tabla.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="actualización-del-modelo.html#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Medidas de precisión</span></span>
<span id="cb204-2"><a href="actualización-del-modelo.html#cb204-2" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">=</span> <span class="fu">sum</span>(prediccion_svm.sin.olor <span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>])<span class="sc">/</span><span class="fu">nrow</span>(setas_test.sin.olor)</span>
<span id="cb204-3"><a href="actualización-del-modelo.html#cb204-3" aria-hidden="true" tabindex="-1"></a>error <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span>accuracy</span>
<span id="cb204-4"><a href="actualización-del-modelo.html#cb204-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-5"><a href="actualización-del-modelo.html#cb204-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas VENENOSAS, sensitivity o recall</span></span>
<span id="cb204-6"><a href="actualización-del-modelo.html#cb204-6" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="ot">=</span> <span class="fu">sum</span>((prediccion_svm.sin.olor <span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb204-7"><a href="actualización-del-modelo.html#cb204-7" aria-hidden="true" tabindex="-1"></a>recall <span class="ot">=</span> sensitivity</span>
<span id="cb204-8"><a href="actualización-del-modelo.html#cb204-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-9"><a href="actualización-del-modelo.html#cb204-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas COMESTIBLES</span></span>
<span id="cb204-10"><a href="actualización-del-modelo.html#cb204-10" aria-hidden="true" tabindex="-1"></a>specificity <span class="ot">=</span>  <span class="fu">sum</span>(prediccion_svm.sin.olor <span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb204-11"><a href="actualización-del-modelo.html#cb204-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-12"><a href="actualización-del-modelo.html#cb204-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es VENENOSAS</span></span>
<span id="cb204-13"><a href="actualización-del-modelo.html#cb204-13" aria-hidden="true" tabindex="-1"></a>precision <span class="ot">=</span> <span class="fu">sum</span>((prediccion_svm.sin.olor<span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (prediccion_svm.sin.olor <span class="sc">==</span> <span class="dv">1</span>))<span class="sc">/</span> <span class="fu">sum</span>(prediccion_svm.sin.olor <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb204-14"><a href="actualización-del-modelo.html#cb204-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-15"><a href="actualización-del-modelo.html#cb204-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es COMESTIBLE</span></span>
<span id="cb204-16"><a href="actualización-del-modelo.html#cb204-16" aria-hidden="true" tabindex="-1"></a>npv <span class="ot">=</span> <span class="fu">sum</span>(prediccion_svm.sin.olor<span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> prediccion_svm.sin.olor <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(prediccion_svm.sin.olor <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb204-17"><a href="actualización-del-modelo.html#cb204-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-18"><a href="actualización-del-modelo.html#cb204-18" aria-hidden="true" tabindex="-1"></a><span class="co"># F1_score</span></span>
<span id="cb204-19"><a href="actualización-del-modelo.html#cb204-19" aria-hidden="true" tabindex="-1"></a>f1score <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>precision<span class="sc">*</span>recall <span class="sc">/</span>(precision<span class="sc">+</span>recall)</span>
<span id="cb204-20"><a href="actualización-del-modelo.html#cb204-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-21"><a href="actualización-del-modelo.html#cb204-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla de medidas de precisión</span></span>
<span id="cb204-22"><a href="actualización-del-modelo.html#cb204-22" aria-hidden="true" tabindex="-1"></a>medidas.svmradial.sin.olor<span class="ot">=</span><span class="fu">c</span>(<span class="at">accuracy =</span> accuracy, <span class="at">error =</span> error, <span class="at">sensitivity =</span> sensitivity, <span class="at">specificity =</span> specificity, <span class="at">precision =</span> precision, <span class="at">npv =</span> npv, <span class="at">f1=</span>f1score)</span>
<span id="cb204-23"><a href="actualización-del-modelo.html#cb204-23" aria-hidden="true" tabindex="-1"></a>medidas.svmradial.sin.olor</span></code></pre></div>
<pre><code>##    accuracy       error sensitivity specificity   precision         npv 
##           1           0           1           1           1           1 
##          f1 
##           1</code></pre>
<p>Si realizamos el ajuste de SVM pero establecemos que el kernel es lineal, obtenemos lo siguiente:</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="actualización-del-modelo.html#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Para estimar el coste: </span></span>
<span id="cb206-2"><a href="actualización-del-modelo.html#cb206-2" aria-hidden="true" tabindex="-1"></a>norma2<span class="ot">&lt;-</span><span class="cf">function</span>(x) <span class="fu">sqrt</span>(<span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb206-3"><a href="actualización-del-modelo.html#cb206-3" aria-hidden="true" tabindex="-1"></a>cost_est<span class="ot">=</span><span class="fu">apply</span>(setas60_validacion.sin.olor,<span class="dv">2</span>,norma2)</span>
<span id="cb206-4"><a href="actualización-del-modelo.html#cb206-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-5"><a href="actualización-del-modelo.html#cb206-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Ajustamos el modelo</span></span>
<span id="cb206-6"><a href="actualización-del-modelo.html#cb206-6" aria-hidden="true" tabindex="-1"></a>setas.svm.lineal.sin.olor<span class="ot">=</span><span class="fu">svm</span>(setas60_train.sin.olor,setas_train.sin.olor[,<span class="dv">1</span>],<span class="at">type=</span><span class="st">&quot;C-classification&quot;</span>,<span class="at">kernel=</span><span class="st">&quot;linear&quot;</span>,<span class="at">cost=</span><span class="fu">mean</span>(cost_est),<span class="at">scale=</span>F)</span>
<span id="cb206-7"><a href="actualización-del-modelo.html#cb206-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-8"><a href="actualización-del-modelo.html#cb206-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla comparativa</span></span>
<span id="cb206-9"><a href="actualización-del-modelo.html#cb206-9" aria-hidden="true" tabindex="-1"></a>prediccion_svm.lineal.sin.olor<span class="ot">=</span><span class="fu">predict</span>(setas.svm.lineal.sin.olor,setas60_test.sin.olor)</span>
<span id="cb206-10"><a href="actualización-del-modelo.html#cb206-10" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(prediccion_svm.lineal.sin.olor,setas_test.sin.olor[,<span class="dv">1</span>])</span></code></pre></div>
<pre><code>##                               
## prediccion_svm.lineal.sin.olor   0   1
##                              0 811  37
##                              1  27 749</code></pre>
<p>Podemos ver que respecto al kernel radial, las predicciones empeoran. Esto lo podemos observar en las medidas de precisión.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="actualización-del-modelo.html#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Medidas de precisión</span></span>
<span id="cb208-2"><a href="actualización-del-modelo.html#cb208-2" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">=</span> <span class="fu">sum</span>(prediccion_svm.lineal.sin.olor <span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>])<span class="sc">/</span><span class="fu">nrow</span>(setas_test.sin.olor)</span>
<span id="cb208-3"><a href="actualización-del-modelo.html#cb208-3" aria-hidden="true" tabindex="-1"></a>error <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span>accuracy</span>
<span id="cb208-4"><a href="actualización-del-modelo.html#cb208-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-5"><a href="actualización-del-modelo.html#cb208-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas VENENOSAS, sensitivity o recall</span></span>
<span id="cb208-6"><a href="actualización-del-modelo.html#cb208-6" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="ot">=</span> <span class="fu">sum</span>((prediccion_svm.lineal.sin.olor <span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb208-7"><a href="actualización-del-modelo.html#cb208-7" aria-hidden="true" tabindex="-1"></a>recall <span class="ot">=</span> sensitivity</span>
<span id="cb208-8"><a href="actualización-del-modelo.html#cb208-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-9"><a href="actualización-del-modelo.html#cb208-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas COMESTIBLES</span></span>
<span id="cb208-10"><a href="actualización-del-modelo.html#cb208-10" aria-hidden="true" tabindex="-1"></a>specificity <span class="ot">=</span>  <span class="fu">sum</span>(prediccion_svm.lineal.sin.olor <span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb208-11"><a href="actualización-del-modelo.html#cb208-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-12"><a href="actualización-del-modelo.html#cb208-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es VENENOSAS</span></span>
<span id="cb208-13"><a href="actualización-del-modelo.html#cb208-13" aria-hidden="true" tabindex="-1"></a>precision <span class="ot">=</span> <span class="fu">sum</span>((prediccion_svm.lineal.sin.olor<span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (prediccion_svm.lineal.sin.olor <span class="sc">==</span> <span class="dv">1</span>))<span class="sc">/</span> <span class="fu">sum</span>(prediccion_svm.lineal.sin.olor <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb208-14"><a href="actualización-del-modelo.html#cb208-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-15"><a href="actualización-del-modelo.html#cb208-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es COMESTIBLE</span></span>
<span id="cb208-16"><a href="actualización-del-modelo.html#cb208-16" aria-hidden="true" tabindex="-1"></a>npv <span class="ot">=</span> <span class="fu">sum</span>(prediccion_svm.lineal.sin.olor<span class="sc">==</span> setas_test.sin.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> prediccion_svm.lineal.sin.olor <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(prediccion_svm.lineal.sin.olor <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb208-17"><a href="actualización-del-modelo.html#cb208-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-18"><a href="actualización-del-modelo.html#cb208-18" aria-hidden="true" tabindex="-1"></a><span class="co"># F1_score</span></span>
<span id="cb208-19"><a href="actualización-del-modelo.html#cb208-19" aria-hidden="true" tabindex="-1"></a>f1score <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>precision<span class="sc">*</span>recall <span class="sc">/</span>(precision<span class="sc">+</span>recall)</span>
<span id="cb208-20"><a href="actualización-del-modelo.html#cb208-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-21"><a href="actualización-del-modelo.html#cb208-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla de medidas de precisión</span></span>
<span id="cb208-22"><a href="actualización-del-modelo.html#cb208-22" aria-hidden="true" tabindex="-1"></a>medidas.svmlineal.sin.olor<span class="ot">=</span><span class="fu">c</span>(<span class="at">accuracy =</span> accuracy, <span class="at">error =</span> error, <span class="at">sensitivity =</span> sensitivity, <span class="at">specificity =</span> specificity, <span class="at">precision =</span> precision, <span class="at">npv =</span> npv, <span class="at">f1=</span>f1score)</span>
<span id="cb208-23"><a href="actualización-del-modelo.html#cb208-23" aria-hidden="true" tabindex="-1"></a>medidas.svmlineal.sin.olor</span></code></pre></div>
<pre><code>##    accuracy       error sensitivity specificity   precision         npv 
##  0.96059113  0.03940887  0.95292621  0.96778043  0.96520619  0.95636792 
##          f1 
##  0.95902689</code></pre>
<p>Por tanto descartaría usar un SVM con kernel lineal.</p>
</div>
<div id="evaluación-1" class="section level3" number="7.1.6">
<h3><span class="header-section-number">7.1.6</span> Evaluación</h3>
<p>Por lo tanto si comparamos todos los modelos que hemos aplicado usando las medidas de precisión vemos lo siguiente</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="actualización-del-modelo.html#cb210-1" aria-hidden="true" tabindex="-1"></a>medidas.precision.sin.olor<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">c</span>(medidas.knn.sin.olor,medidas.arboles.sin.olor,medidas.bosques.sin.olor,medidas.svmradial.sin.olor,medidas.svmlineal.sin.olor),<span class="at">nrow=</span><span class="dv">5</span>,<span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb210-2"><a href="actualización-del-modelo.html#cb210-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(medidas.precision.sin.olor)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;accuracy&quot;</span>, <span class="st">&quot;error&quot;</span>, <span class="st">&quot;sensitivity&quot;</span>, <span class="st">&quot;specificity&quot;</span>, <span class="st">&quot;precision&quot;</span>, <span class="st">&quot;npv&quot;</span>, <span class="st">&quot;f1score&quot;</span>)</span>
<span id="cb210-3"><a href="actualización-del-modelo.html#cb210-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(medidas.precision.sin.olor)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;k-NN&quot;</span>,<span class="st">&quot;Arboles de decision&quot;</span>,<span class="st">&quot;Bosques aleatorios&quot;</span>,<span class="st">&quot;SVM radial&quot;</span>,<span class="st">&quot;SVM lineal&quot;</span>)</span>
<span id="cb210-4"><a href="actualización-del-modelo.html#cb210-4" aria-hidden="true" tabindex="-1"></a>medidas.precision.sin.olor</span></code></pre></div>
<pre><code>##                      accuracy       error sensitivity specificity precision
## k-NN                0.9987685 0.001231527   0.9974555   1.0000000 1.0000000
## Arboles de decision 0.9421182 0.057881773   0.9325700   0.9510740 0.9470284
## Bosques aleatorios  0.9944581 0.005541872   0.9974555   0.9916468 0.9911504
## SVM radial          1.0000000 0.000000000   1.0000000   1.0000000 1.0000000
## SVM lineal          0.9605911 0.039408867   0.9529262   0.9677804 0.9652062
##                           npv   f1score
## k-NN                0.9976190 0.9987261
## Arboles de decision 0.9376471 0.9397436
## Bosques aleatorios  0.9975990 0.9942930
## SVM radial          1.0000000 1.0000000
## SVM lineal          0.9563679 0.9590269</code></pre>
<p>El mejor modelo para aplicar a nuestros datos es el SVM con el kernel radial, pues predice a la perfección los datos tanto los de entrenamiento como los de test. La misma conclusión hemos llegado tras finalizar el análisis de los datos con la variable <strong>Olor</strong>.</p>
</div>
</div>
<div id="datos-con-variable-olorn" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Datos con variable <strong>Olor=n</strong></h2>
<p>Cuando realizamos el análisis descriptivo, ya observamos que la variable <strong>Olor</strong> es bastante determinante a la hora de clasificar las setas según su toxicidad, pero ello nos planteamos realizar todo el análisis a los datos dejando solo los que tengan <strong>Olor=n</strong>.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="actualización-del-modelo.html#cb212-1" aria-hidden="true" tabindex="-1"></a>setas.olor<span class="ot">=</span>setas[<span class="fu">which</span>(setas[,<span class="dv">29</span>]<span class="sc">==</span><span class="dv">1</span>),]</span>
<span id="cb212-2"><a href="actualización-del-modelo.html#cb212-2" aria-hidden="true" tabindex="-1"></a>setas.olor<span class="ot">=</span>setas.olor[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">23</span><span class="sc">:</span><span class="dv">31</span>)]</span>
<span id="cb212-3"><a href="actualización-del-modelo.html#cb212-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(setas.olor)<span class="ot">=</span><span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">dim</span>(setas.olor)[<span class="dv">1</span>])</span>
<span id="cb212-4"><a href="actualización-del-modelo.html#cb212-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(setas.olor<span class="sc">$</span>Letalidad)</span></code></pre></div>
<pre><code>## 
##    0    1 
## 3408  120</code></pre>
<p>Pero vemos que no hay la misma proporción de setas que tengan olor ninguno que sean comestibles o venenosas, por ello vamos a reducir los datos con los que vamos a trabajar a partir de ahora.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="actualización-del-modelo.html#cb214-1" aria-hidden="true" tabindex="-1"></a>setas.olor.comestible<span class="ot">=</span><span class="fu">sample</span>(<span class="fu">dim</span>(setas.olor)[<span class="dv">1</span>],<span class="fu">sum</span>(setas.olor<span class="sc">$</span>Letalidad<span class="sc">==</span><span class="dv">1</span>))</span>
<span id="cb214-2"><a href="actualización-del-modelo.html#cb214-2" aria-hidden="true" tabindex="-1"></a>setas.olor.venenosa<span class="ot">=</span><span class="fu">which</span>(setas.olor<span class="sc">$</span>Letalidad<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb214-3"><a href="actualización-del-modelo.html#cb214-3" aria-hidden="true" tabindex="-1"></a>setas.olor.nueva<span class="ot">=</span><span class="fu">rbind</span>(setas.olor[setas.olor.comestible,],setas.olor[setas.olor.venenosa,])</span></code></pre></div>
<p>Ahora hacemos las particiones con el mismo porcentaje, es decir, 60% para entrenamiento, 20% para test y validacion</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="actualización-del-modelo.html#cb215-1" aria-hidden="true" tabindex="-1"></a>n_totales<span class="ot">=</span><span class="fu">dim</span>(setas.olor.nueva)[<span class="dv">1</span>]</span>
<span id="cb215-2"><a href="actualización-del-modelo.html#cb215-2" aria-hidden="true" tabindex="-1"></a>n_train<span class="ot">=</span><span class="fu">floor</span>(n_totales<span class="sc">*</span><span class="fl">0.6</span>) </span>
<span id="cb215-3"><a href="actualización-del-modelo.html#cb215-3" aria-hidden="true" tabindex="-1"></a>n_test<span class="ot">=</span><span class="fu">floor</span>(n_totales<span class="sc">*</span><span class="fl">0.2</span>) </span>
<span id="cb215-4"><a href="actualización-del-modelo.html#cb215-4" aria-hidden="true" tabindex="-1"></a>n_validacion<span class="ot">=</span>n_totales<span class="sc">-</span>n_train<span class="sc">-</span>n_test</span>
<span id="cb215-5"><a href="actualización-del-modelo.html#cb215-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-6"><a href="actualización-del-modelo.html#cb215-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">34735</span>)</span>
<span id="cb215-7"><a href="actualización-del-modelo.html#cb215-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-8"><a href="actualización-del-modelo.html#cb215-8" aria-hidden="true" tabindex="-1"></a>indices_totales<span class="ot">=</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span>n_totales)</span>
<span id="cb215-9"><a href="actualización-del-modelo.html#cb215-9" aria-hidden="true" tabindex="-1"></a>indices_train<span class="ot">=</span><span class="fu">sort</span>(<span class="fu">sample</span>(indices_totales,n_train))</span>
<span id="cb215-10"><a href="actualización-del-modelo.html#cb215-10" aria-hidden="true" tabindex="-1"></a>indices_test<span class="ot">=</span><span class="fu">sort</span>(<span class="fu">sample</span>(indices_totales[<span class="sc">-</span>indices_train],n_test))</span>
<span id="cb215-11"><a href="actualización-del-modelo.html#cb215-11" aria-hidden="true" tabindex="-1"></a>indices_validacion<span class="ot">=</span>indices_totales[<span class="sc">-</span><span class="fu">c</span>(indices_train,indices_test)]</span>
<span id="cb215-12"><a href="actualización-del-modelo.html#cb215-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-13"><a href="actualización-del-modelo.html#cb215-13" aria-hidden="true" tabindex="-1"></a>setas_train.olor<span class="ot">=</span>setas.olor.nueva[indices_train,]</span>
<span id="cb215-14"><a href="actualización-del-modelo.html#cb215-14" aria-hidden="true" tabindex="-1"></a>setas_test.olor<span class="ot">=</span>setas.olor.nueva[indices_test,]</span>
<span id="cb215-15"><a href="actualización-del-modelo.html#cb215-15" aria-hidden="true" tabindex="-1"></a>setas_validacion.olor<span class="ot">=</span>setas.olor.nueva[indices_validacion,]</span></code></pre></div>
<p>Como se ha reducido la dimensión de nuestros datos ya no hace falta calcular los medoides para tomarlos como puntos de referencia, ahora podemos aplicar todos los análisis a nuestros datos sin tener que hacer ninguna transformación.</p>
<p>Aplicamos el análisis de componentes principales a nuestros datos</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="actualización-del-modelo.html#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Análisis Componentes principales:</span></span>
<span id="cb216-2"><a href="actualización-del-modelo.html#cb216-2" aria-hidden="true" tabindex="-1"></a>pca<span class="ot">=</span><span class="fu">prcomp</span>(setas_train.olor)</span>
<span id="cb216-3"><a href="actualización-del-modelo.html#cb216-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pca)</span></code></pre></div>
<pre><code>## Importance of components:
##                           PC1    PC2     PC3     PC4     PC5     PC6     PC7
## Standard deviation     1.4469 1.3225 0.92779 0.85958 0.70048 0.62161 0.56199
## Proportion of Variance 0.2188 0.1828 0.08996 0.07722 0.05128 0.04038 0.03301
## Cumulative Proportion  0.2188 0.4016 0.49155 0.56877 0.62006 0.66044 0.69345
##                            PC8    PC9    PC10    PC11    PC12   PC13    PC14
## Standard deviation     0.51065 0.4891 0.42794 0.42122 0.41352 0.3937 0.37598
## Proportion of Variance 0.02725 0.0250 0.01914 0.01854 0.01787 0.0162 0.01477
## Cumulative Proportion  0.72070 0.7457 0.76484 0.78338 0.80126 0.8175 0.83223
##                          PC15    PC16    PC17    PC18    PC19    PC20    PC21
## Standard deviation     0.3673 0.34844 0.33633 0.33392 0.31860 0.30873 0.30118
## Proportion of Variance 0.0141 0.01269 0.01182 0.01165 0.01061 0.00996 0.00948
## Cumulative Proportion  0.8463 0.85902 0.87085 0.88250 0.89311 0.90307 0.91255
##                          PC22    PC23    PC24    PC25    PC26    PC27    PC28
## Standard deviation     0.2902 0.28471 0.26936 0.25444 0.24800 0.22890 0.22363
## Proportion of Variance 0.0088 0.00847 0.00758 0.00677 0.00643 0.00548 0.00523
## Cumulative Proportion  0.9214 0.92982 0.93741 0.94417 0.95060 0.95608 0.96130
##                           PC29    PC30   PC31    PC32    PC33    PC34    PC35
## Standard deviation     0.20668 0.19004 0.1882 0.18068 0.17693 0.17536 0.15840
## Proportion of Variance 0.00446 0.00377 0.0037 0.00341 0.00327 0.00321 0.00262
## Cumulative Proportion  0.96577 0.96954 0.9732 0.97665 0.97993 0.98314 0.98576
##                           PC36    PC37    PC38    PC39    PC40    PC41    PC42
## Standard deviation     0.14934 0.14362 0.13537 0.12877 0.11372 0.10872 0.10086
## Proportion of Variance 0.00233 0.00216 0.00192 0.00173 0.00135 0.00124 0.00106
## Cumulative Proportion  0.98809 0.99025 0.99216 0.99390 0.99525 0.99648 0.99755
##                           PC43    PC44    PC45    PC46    PC47    PC48
## Standard deviation     0.08541 0.07006 0.06466 0.05755 0.04375 0.04315
## Proportion of Variance 0.00076 0.00051 0.00044 0.00035 0.00020 0.00019
## Cumulative Proportion  0.99831 0.99882 0.99926 0.99961 0.99981 1.00000
##                             PC49      PC50      PC51      PC52      PC53
## Standard deviation     9.551e-16 2.438e-16 2.288e-16 1.782e-16 1.474e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00
##                             PC54      PC55      PC56      PC57      PC58
## Standard deviation     1.134e-16 1.134e-16 1.134e-16 1.134e-16 1.134e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00
##                             PC59      PC60      PC61      PC62      PC63
## Standard deviation     1.134e-16 1.134e-16 1.134e-16 1.134e-16 1.134e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00
##                             PC64      PC65      PC66      PC67      PC68
## Standard deviation     1.134e-16 1.134e-16 1.134e-16 1.134e-16 1.134e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00
##                             PC69      PC70      PC71      PC72      PC73
## Standard deviation     1.134e-16 1.134e-16 1.134e-16 1.134e-16 1.134e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00
##                             PC74      PC75      PC76      PC77      PC78
## Standard deviation     1.134e-16 1.134e-16 1.134e-16 1.134e-16 1.134e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00
##                             PC79      PC80      PC81      PC82      PC83
## Standard deviation     1.134e-16 1.134e-16 1.134e-16 1.134e-16 1.134e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00
##                             PC84      PC85      PC86      PC87      PC88
## Standard deviation     1.134e-16 1.134e-16 1.134e-16 1.134e-16 1.134e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00
##                             PC89      PC90      PC91      PC92      PC93
## Standard deviation     1.134e-16 1.134e-16 1.134e-16 1.134e-16 1.134e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00
##                             PC94      PC95      PC96      PC97      PC98
## Standard deviation     1.134e-16 1.134e-16 1.134e-16 1.134e-16 1.134e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00
##                             PC99     PC100     PC101     PC102     PC103
## Standard deviation     1.134e-16 1.134e-16 1.134e-16 1.134e-16 1.134e-16
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00
##                            PC104     PC105     PC106     PC107     PC108
## Standard deviation     1.134e-16 1.134e-16 1.134e-16 9.403e-17 8.463e-17
## Proportion of Variance 0.000e+00 0.000e+00 0.000e+00 0.000e+00 0.000e+00
## Cumulative Proportion  1.000e+00 1.000e+00 1.000e+00 1.000e+00 1.000e+00</code></pre>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="actualización-del-modelo.html#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(pca<span class="sc">$</span>x[,<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>],<span class="at">col=</span>setas_train.olor<span class="sc">$</span>Letalidad<span class="sc">+</span><span class="dv">1</span>,<span class="at">pch=</span><span class="dv">19</span>)</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/pca%20olor-1.png" width="672" /></p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="actualización-del-modelo.html#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pca<span class="sc">$</span>x,<span class="at">col=</span>setas_train.olor<span class="sc">$</span>Letalidad<span class="sc">+</span><span class="dv">1</span>,<span class="at">pch=</span><span class="dv">19</span>)</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/pca%20olor-2.png" width="672" /></p>
<p>Con solo las dos primeras componentes principales solo explicamos un 40% de la variabilidad de los datos, para llegar al nivel que teníamos en análsis anteriores necesitariamos 8 componentes princiaples, pero podemos ver que están bastante bien separadas las setas venenosas de las comestibles.</p>
<p>En la gráfica que enfrenta las dos primeras componentes principales vemos que las setas venenosas están ubicadas en <span class="math inline">\(P1\in (-3,-2)\cup(1,2)\)</span> aunque hay unas pocas por medio de las comestibles.</p>
<div id="análisis-cluster-2" class="section level3" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Análisis Cluster</h3>
<p>Aplicamos el análsis cluster a nuestros datos con el objetivo de tener grupos de setas que contengas solo setas venenosas o comestibles, pero primero vemos por cross-validation el número adecuado de cluster a aplicar.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="actualización-del-modelo.html#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Números de clusters</span></span>
<span id="cb220-2"><a href="actualización-del-modelo.html#cb220-2" aria-hidden="true" tabindex="-1"></a>SSW <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;numeric&quot;</span>, <span class="at">length =</span> <span class="dv">15</span>)</span>
<span id="cb220-3"><a href="actualización-del-modelo.html#cb220-3" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="fu">dim</span>(<span class="fu">prcomp</span>(setas_validacion.olor)<span class="sc">$</span>x)[<span class="dv">1</span>]</span>
<span id="cb220-4"><a href="actualización-del-modelo.html#cb220-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Variabilidad de todos los datos, es decir, todos los datos como un único cluster</span></span>
<span id="cb220-5"><a href="actualización-del-modelo.html#cb220-5" aria-hidden="true" tabindex="-1"></a>SSW[<span class="dv">1</span>] <span class="ot">&lt;-</span> (n <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">apply</span>(<span class="fu">prcomp</span>(setas_validacion.olor)<span class="sc">$</span>x,<span class="dv">2</span>,var)) </span>
<span id="cb220-6"><a href="actualización-del-modelo.html#cb220-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-7"><a href="actualización-del-modelo.html#cb220-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Variabilidad de cada modelo, desde 2 clusters hasta 15 clusters</span></span>
<span id="cb220-8"><a href="actualización-del-modelo.html#cb220-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">15</span>) SSW[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">kmeans</span>(<span class="fu">prcomp</span>(setas_validacion.olor)<span class="sc">$</span>x,<span class="at">centers=</span>i,<span class="at">nstart=</span><span class="dv">25</span>)<span class="sc">$</span>withinss)</span>
<span id="cb220-9"><a href="actualización-del-modelo.html#cb220-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-10"><a href="actualización-del-modelo.html#cb220-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Dibujamos un gráfico con el resultado</span></span>
<span id="cb220-11"><a href="actualización-del-modelo.html#cb220-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>, SSW, <span class="at">type=</span><span class="st">&quot;b&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;Número de clusters&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Suma de cuadrados de los grupos&quot;</span>,<span class="at">pch=</span><span class="dv">19</span>, <span class="at">col=</span><span class="st">&quot;steelblue4&quot;</span>)</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/cluster%20sin%20olor%20olor-1.png" width="672" /></p>
<p>En el gráfico podemos observar que a partir del aplicar 6 clusters a nuestros datos la suma de los cuadrados se reduce en menor medida, por ello realizamos el análisis con ese número de clusters.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="actualización-del-modelo.html#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Análisis cluster</span></span>
<span id="cb221-2"><a href="actualización-del-modelo.html#cb221-2" aria-hidden="true" tabindex="-1"></a>clusters.datos.olor<span class="ot">=</span><span class="fu">kmeans</span>(pca<span class="sc">$</span>x,<span class="at">centers=</span><span class="dv">6</span>,<span class="at">nstart=</span><span class="dv">25</span>)</span>
<span id="cb221-3"><a href="actualización-del-modelo.html#cb221-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(clusters.datos.olor<span class="sc">$</span>cluster,setas_train.olor<span class="sc">$</span>Letalidad)</span></code></pre></div>
<pre><code>##    
##      0  1
##   1 45  0
##   2  0 20
##   3 16  0
##   4  9  0
##   5  2 10
##   6  0 42</code></pre>
<p>Podemos ver que un cluster identificar correctamente a las setas venenosas mientras que el resto de cluster las setas están un poco más repartidas.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="actualización-del-modelo.html#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Gráfico de los cluster</span></span>
<span id="cb223-2"><a href="actualización-del-modelo.html#cb223-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pca<span class="sc">$</span>x,<span class="at">main=</span><span class="st">&quot;Clusters&quot;</span>,<span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb223-3"><a href="actualización-del-modelo.html#cb223-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(setas_train.olor)[<span class="dv">1</span>]){</span>
<span id="cb223-4"><a href="actualización-del-modelo.html#cb223-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(pca<span class="sc">$</span>x[i,<span class="dv">1</span>],pca<span class="sc">$</span>x[i,<span class="dv">2</span>],<span class="at">pch=</span><span class="dv">19</span>,<span class="at">col=</span>clusters.datos.olor<span class="sc">$</span>cluster[i]<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb223-5"><a href="actualización-del-modelo.html#cb223-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb223-6"><a href="actualización-del-modelo.html#cb223-6" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,   </span>
<span id="cb223-7"><a href="actualización-del-modelo.html#cb223-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">inset =</span> <span class="fl">0.01</span>, </span>
<span id="cb223-8"><a href="actualización-del-modelo.html#cb223-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb223-9"><a href="actualización-del-modelo.html#cb223-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">fil =</span> <span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">6</span>))</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/grafico%20cluster%206%20olor-1.png" width="672" /></p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="actualización-del-modelo.html#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Gráfico por tipo de setas:</span></span>
<span id="cb224-2"><a href="actualización-del-modelo.html#cb224-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb224-3"><a href="actualización-del-modelo.html#cb224-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pca<span class="sc">$</span>x,<span class="at">main=</span><span class="st">&quot;Clusters: setas comestibles&quot;</span>,<span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb224-4"><a href="actualización-del-modelo.html#cb224-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(setas_train.olor)[<span class="dv">1</span>]){</span>
<span id="cb224-5"><a href="actualización-del-modelo.html#cb224-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(setas_train.olor[i,<span class="dv">1</span>]<span class="sc">==</span><span class="dv">0</span>){</span>
<span id="cb224-6"><a href="actualización-del-modelo.html#cb224-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(pca<span class="sc">$</span>x[i,<span class="dv">1</span>],pca<span class="sc">$</span>x[i,<span class="dv">2</span>],<span class="at">pch=</span><span class="dv">19</span>,<span class="at">col=</span>clusters.datos.olor<span class="sc">$</span>cluster[i]<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb224-7"><a href="actualización-del-modelo.html#cb224-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb224-8"><a href="actualización-del-modelo.html#cb224-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb224-9"><a href="actualización-del-modelo.html#cb224-9" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,   </span>
<span id="cb224-10"><a href="actualización-del-modelo.html#cb224-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">inset =</span> <span class="fl">0.01</span>, </span>
<span id="cb224-11"><a href="actualización-del-modelo.html#cb224-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>),</span>
<span id="cb224-12"><a href="actualización-del-modelo.html#cb224-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">fil =</span> <span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">7</span>))</span>
<span id="cb224-13"><a href="actualización-del-modelo.html#cb224-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pca<span class="sc">$</span>x,<span class="at">main=</span><span class="st">&quot;Clusters: setas venenosas&quot;</span>,<span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb224-14"><a href="actualización-del-modelo.html#cb224-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(setas_train.olor)[<span class="dv">1</span>]){</span>
<span id="cb224-15"><a href="actualización-del-modelo.html#cb224-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(setas_train.olor[i,<span class="dv">1</span>]<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb224-16"><a href="actualización-del-modelo.html#cb224-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(pca<span class="sc">$</span>x[i,<span class="dv">1</span>],pca<span class="sc">$</span>x[i,<span class="dv">2</span>],<span class="at">pch=</span><span class="dv">19</span>,<span class="at">col=</span>clusters.datos.olor<span class="sc">$</span>cluster[i]<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb224-17"><a href="actualización-del-modelo.html#cb224-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb224-18"><a href="actualización-del-modelo.html#cb224-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb224-19"><a href="actualización-del-modelo.html#cb224-19" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,   </span>
<span id="cb224-20"><a href="actualización-del-modelo.html#cb224-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">inset =</span> <span class="fl">0.01</span>, </span>
<span id="cb224-21"><a href="actualización-del-modelo.html#cb224-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>),</span>
<span id="cb224-22"><a href="actualización-del-modelo.html#cb224-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">fil =</span> <span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">7</span>))</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/grafico%20cluster%206%20olor-2.png" width="672" /></p>
<p>Hemos conseguido una muy buena clasificación de las setas, solos dos cluster tienen setas mezcladas, quizás aumentando el número de cluster podamos clasificar correctamente estas pocas setas.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="actualización-del-modelo.html#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Análisis cluster</span></span>
<span id="cb225-2"><a href="actualización-del-modelo.html#cb225-2" aria-hidden="true" tabindex="-1"></a>clusters.datos.train.olor<span class="ot">=</span><span class="fu">kmeans</span>(pca<span class="sc">$</span>x,<span class="at">centers=</span><span class="dv">8</span>,<span class="at">nstart=</span><span class="dv">25</span>)</span>
<span id="cb225-3"><a href="actualización-del-modelo.html#cb225-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(clusters.datos.train.olor<span class="sc">$</span>cluster,setas_train.olor<span class="sc">$</span>Letalidad)</span></code></pre></div>
<pre><code>##    
##      0  1
##   1  0 24
##   2  0 20
##   3 45  0
##   4  0  4
##   5  7  6
##   6  9  0
##   7  0 18
##   8 11  0</code></pre>
<p>Conseguimos que cada cluster solo contenga un tipo de seta.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="actualización-del-modelo.html#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Gráfico de los cluster</span></span>
<span id="cb227-2"><a href="actualización-del-modelo.html#cb227-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pca<span class="sc">$</span>x,<span class="at">main=</span><span class="st">&quot;Clusters&quot;</span>,<span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb227-3"><a href="actualización-del-modelo.html#cb227-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(setas_train.olor)[<span class="dv">1</span>]){</span>
<span id="cb227-4"><a href="actualización-del-modelo.html#cb227-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(pca<span class="sc">$</span>x[i,<span class="dv">1</span>],pca<span class="sc">$</span>x[i,<span class="dv">2</span>],<span class="at">pch=</span><span class="dv">19</span>,<span class="at">col=</span>clusters.datos.train.olor<span class="sc">$</span>cluster[i]<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb227-5"><a href="actualización-del-modelo.html#cb227-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb227-6"><a href="actualización-del-modelo.html#cb227-6" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,   </span>
<span id="cb227-7"><a href="actualización-del-modelo.html#cb227-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">inset =</span> <span class="fl">0.01</span>, </span>
<span id="cb227-8"><a href="actualización-del-modelo.html#cb227-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>),</span>
<span id="cb227-9"><a href="actualización-del-modelo.html#cb227-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">fil =</span> <span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">9</span>))</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/grafico%20cluster%208%20olor-1.png" width="672" /></p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="actualización-del-modelo.html#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Gráfico por tipo de setas:</span></span>
<span id="cb228-2"><a href="actualización-del-modelo.html#cb228-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb228-3"><a href="actualización-del-modelo.html#cb228-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pca<span class="sc">$</span>x,<span class="at">main=</span><span class="st">&quot;Clusters: setas comestibles&quot;</span>,<span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb228-4"><a href="actualización-del-modelo.html#cb228-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(setas_train.olor)[<span class="dv">1</span>]){</span>
<span id="cb228-5"><a href="actualización-del-modelo.html#cb228-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(setas_train.olor[i,<span class="dv">1</span>]<span class="sc">==</span><span class="dv">0</span>){</span>
<span id="cb228-6"><a href="actualización-del-modelo.html#cb228-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(pca<span class="sc">$</span>x[i,<span class="dv">1</span>],pca<span class="sc">$</span>x[i,<span class="dv">2</span>],<span class="at">pch=</span><span class="dv">19</span>,<span class="at">col=</span>clusters.datos.train.olor<span class="sc">$</span>cluster[i]<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb228-7"><a href="actualización-del-modelo.html#cb228-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb228-8"><a href="actualización-del-modelo.html#cb228-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb228-9"><a href="actualización-del-modelo.html#cb228-9" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,   </span>
<span id="cb228-10"><a href="actualización-del-modelo.html#cb228-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">inset =</span> <span class="fl">0.01</span>, </span>
<span id="cb228-11"><a href="actualización-del-modelo.html#cb228-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>),</span>
<span id="cb228-12"><a href="actualización-del-modelo.html#cb228-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">fil =</span> <span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">9</span>))</span>
<span id="cb228-13"><a href="actualización-del-modelo.html#cb228-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pca<span class="sc">$</span>x,<span class="at">main=</span><span class="st">&quot;Clusters: setas venenosas&quot;</span>,<span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb228-14"><a href="actualización-del-modelo.html#cb228-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(setas_train.olor)[<span class="dv">1</span>]){</span>
<span id="cb228-15"><a href="actualización-del-modelo.html#cb228-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(setas_train.olor[i,<span class="dv">1</span>]<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb228-16"><a href="actualización-del-modelo.html#cb228-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(pca<span class="sc">$</span>x[i,<span class="dv">1</span>],pca<span class="sc">$</span>x[i,<span class="dv">2</span>],<span class="at">pch=</span><span class="dv">19</span>,<span class="at">col=</span>clusters.datos.train.olor<span class="sc">$</span>cluster[i]<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb228-17"><a href="actualización-del-modelo.html#cb228-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb228-18"><a href="actualización-del-modelo.html#cb228-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb228-19"><a href="actualización-del-modelo.html#cb228-19" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,   </span>
<span id="cb228-20"><a href="actualización-del-modelo.html#cb228-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">inset =</span> <span class="fl">0.01</span>, </span>
<span id="cb228-21"><a href="actualización-del-modelo.html#cb228-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>),</span>
<span id="cb228-22"><a href="actualización-del-modelo.html#cb228-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">fil =</span> <span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">9</span>))</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/grafico%20cluster%208%20olor-2.png" width="672" /></p>
</div>
<div id="k-nn-2" class="section level3" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> k-NN</h3>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="actualización-del-modelo.html#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Buscamos los vecinos más cercanos</span></span>
<span id="cb229-2"><a href="actualización-del-modelo.html#cb229-2" aria-hidden="true" tabindex="-1"></a>prediccion_knn.olor<span class="ot">=</span><span class="fu">knn</span>(setas_train.olor,setas_test.olor,<span class="at">cl=</span>setas_train.olor<span class="sc">$</span>Letalidad,<span class="at">k=</span><span class="dv">1</span>)</span>
<span id="cb229-3"><a href="actualización-del-modelo.html#cb229-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(prediccion_knn.olor,setas_test.olor<span class="sc">$</span>Letalidad)</span></code></pre></div>
<pre><code>##                    
## prediccion_knn.olor  0  1
##                   0 22  0
##                   1  2 24</code></pre>
<p>La predicción con el 1-vecino más próximo, es perfecta, lo podemos ver a simple vista en la tabla. Pero vamos a realizar un análisis con distintas medidas de precisión.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="actualización-del-modelo.html#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exactitud/Error</span></span>
<span id="cb231-2"><a href="actualización-del-modelo.html#cb231-2" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">=</span> <span class="fu">sum</span>(prediccion_knn.olor <span class="sc">==</span> setas_test.olor<span class="sc">$</span>Letalidad)<span class="sc">/</span><span class="fu">nrow</span>(setas_test.olor)</span>
<span id="cb231-3"><a href="actualización-del-modelo.html#cb231-3" aria-hidden="true" tabindex="-1"></a>error <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span>accuracy</span>
<span id="cb231-4"><a href="actualización-del-modelo.html#cb231-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-5"><a href="actualización-del-modelo.html#cb231-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas VENENOSAS, sensitivity o recall</span></span>
<span id="cb231-6"><a href="actualización-del-modelo.html#cb231-6" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="ot">=</span> <span class="fu">sum</span>((prediccion_knn.olor <span class="sc">==</span> setas_test.olor<span class="sc">$</span>Letalidad) <span class="sc">&amp;</span> (setas_test.olor<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.olor<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb231-7"><a href="actualización-del-modelo.html#cb231-7" aria-hidden="true" tabindex="-1"></a>recall <span class="ot">=</span> sensitivity</span>
<span id="cb231-8"><a href="actualización-del-modelo.html#cb231-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-9"><a href="actualización-del-modelo.html#cb231-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas COMESTIBLES</span></span>
<span id="cb231-10"><a href="actualización-del-modelo.html#cb231-10" aria-hidden="true" tabindex="-1"></a>specificity <span class="ot">=</span>  <span class="fu">sum</span>(prediccion_knn.olor <span class="sc">==</span> setas_test.olor<span class="sc">$</span>Letalidad <span class="sc">&amp;</span> setas_test.olor<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.olor<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb231-11"><a href="actualización-del-modelo.html#cb231-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-12"><a href="actualización-del-modelo.html#cb231-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es VENENOSAS</span></span>
<span id="cb231-13"><a href="actualización-del-modelo.html#cb231-13" aria-hidden="true" tabindex="-1"></a>precision <span class="ot">=</span> <span class="fu">sum</span>( (prediccion_knn.olor<span class="sc">==</span> setas_test.olor<span class="sc">$</span>Letalidad) <span class="sc">&amp;</span> (prediccion_knn.olor <span class="sc">==</span> <span class="dv">1</span>))<span class="sc">/</span> <span class="fu">sum</span>(prediccion_knn.olor <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb231-14"><a href="actualización-del-modelo.html#cb231-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-15"><a href="actualización-del-modelo.html#cb231-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es COMESTIBLE</span></span>
<span id="cb231-16"><a href="actualización-del-modelo.html#cb231-16" aria-hidden="true" tabindex="-1"></a>npv <span class="ot">=</span> <span class="fu">sum</span>(prediccion_knn.olor <span class="sc">==</span> setas_test.olor<span class="sc">$</span>Letalidad <span class="sc">&amp;</span> prediccion_knn.olor <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(prediccion_knn.olor <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb231-17"><a href="actualización-del-modelo.html#cb231-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-18"><a href="actualización-del-modelo.html#cb231-18" aria-hidden="true" tabindex="-1"></a><span class="co"># F1_score</span></span>
<span id="cb231-19"><a href="actualización-del-modelo.html#cb231-19" aria-hidden="true" tabindex="-1"></a>f1score <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>precision<span class="sc">*</span>recall <span class="sc">/</span>(precision<span class="sc">+</span>recall)</span>
<span id="cb231-20"><a href="actualización-del-modelo.html#cb231-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-21"><a href="actualización-del-modelo.html#cb231-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla de medidas de precisión</span></span>
<span id="cb231-22"><a href="actualización-del-modelo.html#cb231-22" aria-hidden="true" tabindex="-1"></a>medidas.knn.olor<span class="ot">=</span><span class="fu">c</span>(<span class="at">accuracy =</span> accuracy, <span class="at">error =</span> error, <span class="at">sensitivity =</span> sensitivity, <span class="at">specificity =</span> specificity, <span class="at">precision =</span> precision, <span class="at">npv =</span> npv, <span class="at">f1=</span>f1score)</span>
<span id="cb231-23"><a href="actualización-del-modelo.html#cb231-23" aria-hidden="true" tabindex="-1"></a>medidas.knn.olor</span></code></pre></div>
<pre><code>##    accuracy       error sensitivity specificity   precision         npv 
##  0.95833333  0.04166667  1.00000000  0.91666667  0.92307692  1.00000000 
##          f1 
##  0.96000000</code></pre>
<p>Pero vamos a probar a calcular todas estas medidas con un número distinto de vecinos más cercano, por si a caso obtuviesemos resultados parecidos.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="actualización-del-modelo.html#cb233-1" aria-hidden="true" tabindex="-1"></a>k<span class="ot">=</span>(<span class="fu">dim</span>(setas_train.olor)[<span class="dv">1</span>]<span class="sc">^</span>(<span class="dv">4</span><span class="sc">/</span>(<span class="dv">4</span><span class="sc">+</span><span class="fu">dim</span>(setas_train.olor)[<span class="dv">2</span>])))<span class="sc">*</span><span class="dv">10</span></span>
<span id="cb233-2"><a href="actualización-del-modelo.html#cb233-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-3"><a href="actualización-del-modelo.html#cb233-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Matriz de las medidas de precision:</span></span>
<span id="cb233-4"><a href="actualización-del-modelo.html#cb233-4" aria-hidden="true" tabindex="-1"></a>medidas_presicision<span class="ot">=</span><span class="fu">matrix</span>(<span class="at">nrow=</span><span class="fu">round</span>(k),<span class="at">ncol=</span><span class="dv">7</span>)</span>
<span id="cb233-5"><a href="actualización-del-modelo.html#cb233-5" aria-hidden="true" tabindex="-1"></a>nombres_medidas<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;accuracy&quot;</span>, <span class="st">&quot;error&quot;</span>, <span class="st">&quot;sensitivity&quot;</span>, <span class="st">&quot;specificity&quot;</span>, <span class="st">&quot;precision&quot;</span>, <span class="st">&quot;npv&quot;</span>, <span class="st">&quot;f1score&quot;</span>)</span>
<span id="cb233-6"><a href="actualización-del-modelo.html#cb233-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(medidas_presicision)<span class="ot">=</span>nombres_medidas</span>
<span id="cb233-7"><a href="actualización-del-modelo.html#cb233-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(medidas_presicision)<span class="ot">=</span><span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">round</span>(k),<span class="dv">1</span>)</span>
<span id="cb233-8"><a href="actualización-del-modelo.html#cb233-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">round</span>(k)){</span>
<span id="cb233-9"><a href="actualización-del-modelo.html#cb233-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb233-10"><a href="actualización-del-modelo.html#cb233-10" aria-hidden="true" tabindex="-1"></a>  prediccion_knn<span class="ot">=</span><span class="fu">knn</span>(setas_train.olor,setas_test.olor,<span class="at">cl=</span>setas_train.olor<span class="sc">$</span>Letalidad,<span class="at">k=</span>i)</span>
<span id="cb233-11"><a href="actualización-del-modelo.html#cb233-11" aria-hidden="true" tabindex="-1"></a>  medidas_presicision[i,<span class="dv">1</span>] <span class="ot">=</span> <span class="fu">sum</span>(prediccion_knn <span class="sc">==</span> setas_test.olor<span class="sc">$</span>Letalidad)<span class="sc">/</span><span class="fu">nrow</span>(setas_test.olor)</span>
<span id="cb233-12"><a href="actualización-del-modelo.html#cb233-12" aria-hidden="true" tabindex="-1"></a>  medidas_presicision[i,<span class="dv">2</span>] <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span>medidas_presicision[i,<span class="dv">1</span>]</span>
<span id="cb233-13"><a href="actualización-del-modelo.html#cb233-13" aria-hidden="true" tabindex="-1"></a>  medidas_presicision[i,<span class="dv">3</span>] <span class="ot">=</span> <span class="fu">sum</span>((prediccion_knn <span class="sc">==</span> setas_test.olor<span class="sc">$</span>Letalidad) <span class="sc">&amp;</span> (setas_test.olor<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">/</span><span class="fu">sum</span>(setas_test.olor<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb233-14"><a href="actualización-del-modelo.html#cb233-14" aria-hidden="true" tabindex="-1"></a>  medidas_presicision[i,<span class="dv">4</span>] <span class="ot">=</span>  <span class="fu">sum</span>(prediccion_knn <span class="sc">==</span> setas_test.olor<span class="sc">$</span>Letalidad <span class="sc">&amp;</span> setas_test.olor<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.olor<span class="sc">$</span>Letalidad <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb233-15"><a href="actualización-del-modelo.html#cb233-15" aria-hidden="true" tabindex="-1"></a>  medidas_presicision[i,<span class="dv">5</span>] <span class="ot">=</span> <span class="fu">sum</span>( (prediccion_knn<span class="sc">==</span> setas_test.olor<span class="sc">$</span>Letalidad) <span class="sc">&amp;</span> (prediccion_knn <span class="sc">==</span> <span class="dv">1</span>))<span class="sc">/</span> <span class="fu">sum</span>(prediccion_knn <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb233-16"><a href="actualización-del-modelo.html#cb233-16" aria-hidden="true" tabindex="-1"></a>  medidas_presicision[i,<span class="dv">6</span>] <span class="ot">=</span> <span class="fu">sum</span>(prediccion_knn <span class="sc">==</span> setas_test.olor<span class="sc">$</span>Letalidad <span class="sc">&amp;</span> prediccion_knn <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(prediccion_knn <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb233-17"><a href="actualización-del-modelo.html#cb233-17" aria-hidden="true" tabindex="-1"></a>  medidas_presicision[i,<span class="dv">7</span>] <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>medidas_presicision[i,<span class="dv">5</span>]<span class="sc">*</span>medidas_presicision[i,<span class="dv">3</span>] <span class="sc">/</span>(medidas_presicision[i,<span class="dv">5</span>]<span class="sc">+</span>medidas_presicision[i,<span class="dv">3</span>])</span>
<span id="cb233-18"><a href="actualización-del-modelo.html#cb233-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb233-19"><a href="actualización-del-modelo.html#cb233-19" aria-hidden="true" tabindex="-1"></a>medidas_presicision</span></code></pre></div>
<pre><code>##     accuracy      error sensitivity specificity precision npv   f1score
## 1  0.9583333 0.04166667           1   0.9166667 0.9230769   1 0.9600000
## 2  0.9166667 0.08333333           1   0.8333333 0.8571429   1 0.9230769
## 3  0.8958333 0.10416667           1   0.7916667 0.8275862   1 0.9056604
## 4  0.8958333 0.10416667           1   0.7916667 0.8275862   1 0.9056604
## 5  0.8958333 0.10416667           1   0.7916667 0.8275862   1 0.9056604
## 6  0.8958333 0.10416667           1   0.7916667 0.8275862   1 0.9056604
## 7  0.8958333 0.10416667           1   0.7916667 0.8275862   1 0.9056604
## 8  0.8958333 0.10416667           1   0.7916667 0.8275862   1 0.9056604
## 9  0.8958333 0.10416667           1   0.7916667 0.8275862   1 0.9056604
## 10 0.8958333 0.10416667           1   0.7916667 0.8275862   1 0.9056604
## 11 0.8958333 0.10416667           1   0.7916667 0.8275862   1 0.9056604
## 12 0.8958333 0.10416667           1   0.7916667 0.8275862   1 0.9056604</code></pre>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="actualización-del-modelo.html#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Grafico de las medidas de precision</span></span>
<span id="cb235-2"><a href="actualización-del-modelo.html#cb235-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">round</span>(k)),medidas_presicision[,<span class="dv">1</span>],<span class="at">main=</span><span class="st">&quot;Medidas de precision&quot;</span>,<span class="at">type=</span><span class="st">&quot;n&quot;</span>,<span class="at">xlab=</span><span class="st">&quot;Número de k vecinos&quot;</span>,<span class="at">ylab=</span><span class="st">&quot;&quot;</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="fu">round</span>(k)<span class="sc">+</span><span class="dv">2</span>))</span>
<span id="cb235-3"><a href="actualización-del-modelo.html#cb235-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) {</span>
<span id="cb235-4"><a href="actualización-del-modelo.html#cb235-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(<span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">round</span>(k)),medidas_presicision[,i],<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">col=</span>i<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb235-5"><a href="actualización-del-modelo.html#cb235-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">round</span>(k)),medidas_presicision[,i],<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">col=</span>i<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb235-6"><a href="actualización-del-modelo.html#cb235-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb235-7"><a href="actualización-del-modelo.html#cb235-7" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,   </span>
<span id="cb235-8"><a href="actualización-del-modelo.html#cb235-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">inset =</span> <span class="fl">0.01</span>, </span>
<span id="cb235-9"><a href="actualización-del-modelo.html#cb235-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Ac&quot;</span>,<span class="st">&quot;Er&quot;</span>, <span class="st">&quot;Se&quot;</span>,<span class="st">&quot;Sp&quot;</span>,<span class="st">&quot;Pr&quot;</span>,<span class="st">&quot;NPV&quot;</span>,<span class="st">&quot;F1&quot;</span>),</span>
<span id="cb235-10"><a href="actualización-del-modelo.html#cb235-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">fil =</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="fu">round</span>(k)<span class="sc">+</span><span class="dv">1</span>))</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/knn%20cross-validation%20olor-1.png" width="672" /></p>
<p>Observamos que al ir aumentando el número de k-vecinos el error va aumentando pero sigue siendo muy pequeño, el mayor error cometido con el número de k-vecinos probado es de 2%, pero solo se equivoca en una seta, el error es tan “grande” a comparación de otro análisis por la dimensión de nuestros datos.</p>
</div>
<div id="arboles-de-decisión-2" class="section level3" number="7.2.3">
<h3><span class="header-section-number">7.2.3</span> Arboles de Decisión</h3>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="actualización-del-modelo.html#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Árbol de decisión:</span></span>
<span id="cb236-2"><a href="actualización-del-modelo.html#cb236-2" aria-hidden="true" tabindex="-1"></a>arbol.olor<span class="ot">=</span><span class="fu">rpart</span>(<span class="fu">as.factor</span>(setas_train.olor<span class="sc">$</span>Letalidad)<span class="sc">~</span>., <span class="at">data=</span>setas_train.olor,<span class="at">method=</span><span class="st">&quot;class&quot;</span>)</span>
<span id="cb236-3"><a href="actualización-del-modelo.html#cb236-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(arbol.olor)</span></code></pre></div>
<pre><code>## Call:
## rpart(formula = as.factor(setas_train.olor$Letalidad) ~ ., data = setas_train.olor, 
##     method = &quot;class&quot;)
##   n= 144 
## 
##          CP nsplit  rel error     xerror       xstd
## 1 0.7777778      0 1.00000000 1.26388889 0.08037942
## 2 0.1250000      1 0.22222222 0.22222222 0.05237828
## 3 0.0100000      2 0.09722222 0.09722222 0.03584227
## 
## Variable importance
## Agrandado/Afilado         CE_marron          CE_negro           Bosques 
##                22                11                10                 9 
##            S_Gris         Solitaria     Adjunto/Libre       CT1_naranja 
##                 8                 8                 6                 6 
##       CT2_naranja          V_Marrón        CT1_blanco          V_Blanco 
##                 6                 4                 4                 4 
## 
## Node number 1: 144 observations,    complexity param=0.7777778
##   predicted class=0  expected loss=0.5  P(node) =1
##     class counts:    72    72
##    probabilities: 0.500 0.500 
##   left son=2 (56 obs) right son=3 (88 obs)
##   Primary splits:
##       Agrandado/Afilado &lt; 0.5 to the left,  improve=45.81818, (0 missing)
##       CE_verde          &lt; 0.5 to the left,  improve=29.64706, (0 missing)
##       NA_1              &lt; 0.5 to the right, improve=27.86829, (0 missing)
##       NA_2              &lt; 0.5 to the left,  improve=27.86829, (0 missing)
##       CE_marron         &lt; 0.5 to the right, improve=20.57143, (0 missing)
##   Surrogate splits:
##       CE_marron &lt; 0.5 to the right, agree=0.806, adj=0.500, (0 split)
##       CE_negro  &lt; 0.5 to the right, agree=0.785, adj=0.446, (0 split)
##       Bosques   &lt; 0.5 to the right, agree=0.778, adj=0.429, (0 split)
##       S_Gris    &lt; 0.5 to the right, agree=0.757, adj=0.375, (0 split)
##       Solitaria &lt; 0.5 to the right, agree=0.757, adj=0.375, (0 split)
## 
## Node number 2: 56 observations
##   predicted class=0  expected loss=0  P(node) =0.3888889
##     class counts:    56     0
##    probabilities: 1.000 0.000 
## 
## Node number 3: 88 observations,    complexity param=0.125
##   predicted class=1  expected loss=0.1818182  P(node) =0.6111111
##     class counts:    16    72
##    probabilities: 0.182 0.818 
##   left son=6 (9 obs) right son=7 (79 obs)
##   Primary splits:
##       Adjunto/Libre &lt; 0.5 to the right, improve=13.422320, (0 missing)
##       CT1_naranja   &lt; 0.5 to the right, improve=13.422320, (0 missing)
##       CT2_naranja   &lt; 0.5 to the right, improve=13.422320, (0 missing)
##       CT1_blanco    &lt; 0.5 to the left,  improve= 7.950023, (0 missing)
##       V_Blanco      &lt; 0.5 to the left,  improve= 7.950023, (0 missing)
##   Surrogate splits:
##       CT1_naranja &lt; 0.5 to the right, agree=1.000, adj=1.000, (0 split)
##       CT2_naranja &lt; 0.5 to the right, agree=1.000, adj=1.000, (0 split)
##       V_Marrón    &lt; 0.5 to the right, agree=0.966, adj=0.667, (0 split)
##       CT1_blanco  &lt; 0.5 to the left,  agree=0.955, adj=0.556, (0 split)
##       V_Blanco    &lt; 0.5 to the left,  agree=0.955, adj=0.556, (0 split)
## 
## Node number 6: 9 observations
##   predicted class=0  expected loss=0  P(node) =0.0625
##     class counts:     9     0
##    probabilities: 1.000 0.000 
## 
## Node number 7: 79 observations
##   predicted class=1  expected loss=0.08860759  P(node) =0.5486111
##     class counts:     7    72
##    probabilities: 0.089 0.911</code></pre>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="actualización-del-modelo.html#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(arbol.olor)</span></code></pre></div>
<p><img src="MEMORIA_files/figure-html/arbol%20de%20decision%20olor-1.png" width="672" /></p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="actualización-del-modelo.html#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla comparativa:</span></span>
<span id="cb239-2"><a href="actualización-del-modelo.html#cb239-2" aria-hidden="true" tabindex="-1"></a>prediccion.arbol.olor<span class="ot">=</span><span class="fu">round</span>(<span class="fu">predict</span>(arbol.olor,setas_test.olor)[,<span class="dv">2</span>])</span>
<span id="cb239-3"><a href="actualización-del-modelo.html#cb239-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(prediccion.arbol.olor,setas_test.olor[,<span class="dv">1</span>])</span></code></pre></div>
<pre><code>##                      
## prediccion.arbol.olor  0  1
##                     0 18  0
##                     1  6 24</code></pre>
<p>El gráfico resultante lo interpretamos que si la seta tiene el tallo afilado, será no venenosas mientras que si lo tiene agrandado se fija después en como es la población si la población no es <strong>Varias</strong> la clasifica como venenosa y el resto se fija en como es la variable <strong>TR_faltante</strong>. Entonces las variables más importantes son <strong>Agrandado/Afilado, CE_negro y CT1_blanco</strong>.</p>
<p>En la tabla podemos ver que a la hora de predecir nuestro árbol de decisión comete cierto error, a continuación analizamos ese error con distintas medidas de precisión.</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="actualización-del-modelo.html#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exactitud/Error</span></span>
<span id="cb241-2"><a href="actualización-del-modelo.html#cb241-2" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">=</span> <span class="fu">sum</span>(prediccion.arbol.olor <span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>])<span class="sc">/</span><span class="fu">nrow</span>(setas_test.olor)</span>
<span id="cb241-3"><a href="actualización-del-modelo.html#cb241-3" aria-hidden="true" tabindex="-1"></a>error <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span>accuracy</span>
<span id="cb241-4"><a href="actualización-del-modelo.html#cb241-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-5"><a href="actualización-del-modelo.html#cb241-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas VENENOSAS, sensitivity o recall</span></span>
<span id="cb241-6"><a href="actualización-del-modelo.html#cb241-6" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="ot">=</span> <span class="fu">sum</span>((prediccion.arbol.olor <span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb241-7"><a href="actualización-del-modelo.html#cb241-7" aria-hidden="true" tabindex="-1"></a>recall <span class="ot">=</span> sensitivity</span>
<span id="cb241-8"><a href="actualización-del-modelo.html#cb241-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-9"><a href="actualización-del-modelo.html#cb241-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas COMESTIBLES</span></span>
<span id="cb241-10"><a href="actualización-del-modelo.html#cb241-10" aria-hidden="true" tabindex="-1"></a>specificity <span class="ot">=</span>  <span class="fu">sum</span>(prediccion.arbol.olor <span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb241-11"><a href="actualización-del-modelo.html#cb241-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-12"><a href="actualización-del-modelo.html#cb241-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es VENENOSAS</span></span>
<span id="cb241-13"><a href="actualización-del-modelo.html#cb241-13" aria-hidden="true" tabindex="-1"></a>precision <span class="ot">=</span> <span class="fu">sum</span>( (prediccion.arbol.olor<span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (prediccion.arbol.olor <span class="sc">==</span> <span class="dv">1</span>))<span class="sc">/</span> <span class="fu">sum</span>(prediccion.arbol.olor <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb241-14"><a href="actualización-del-modelo.html#cb241-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-15"><a href="actualización-del-modelo.html#cb241-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es COMESTIBLE</span></span>
<span id="cb241-16"><a href="actualización-del-modelo.html#cb241-16" aria-hidden="true" tabindex="-1"></a>npv <span class="ot">=</span> <span class="fu">sum</span>(prediccion.arbol.olor<span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> prediccion.arbol.olor <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(prediccion.arbol.olor <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb241-17"><a href="actualización-del-modelo.html#cb241-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-18"><a href="actualización-del-modelo.html#cb241-18" aria-hidden="true" tabindex="-1"></a><span class="co"># F1_score</span></span>
<span id="cb241-19"><a href="actualización-del-modelo.html#cb241-19" aria-hidden="true" tabindex="-1"></a>f1score <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>precision<span class="sc">*</span>recall <span class="sc">/</span>(precision<span class="sc">+</span>recall)</span>
<span id="cb241-20"><a href="actualización-del-modelo.html#cb241-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-21"><a href="actualización-del-modelo.html#cb241-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla de medidas de precisión</span></span>
<span id="cb241-22"><a href="actualización-del-modelo.html#cb241-22" aria-hidden="true" tabindex="-1"></a>medidas.arboles.olor<span class="ot">=</span><span class="fu">c</span>(<span class="at">accuracy =</span> accuracy, <span class="at">error =</span> error, <span class="at">sensitivity =</span> sensitivity, <span class="at">specificity =</span> specificity, <span class="at">precision =</span> precision, <span class="at">npv =</span> npv, <span class="at">f1=</span>f1score)</span>
<span id="cb241-23"><a href="actualización-del-modelo.html#cb241-23" aria-hidden="true" tabindex="-1"></a>medidas.arboles.olor</span></code></pre></div>
<pre><code>##    accuracy       error sensitivity specificity   precision         npv 
##   0.8750000   0.1250000   1.0000000   0.7500000   0.8000000   1.0000000 
##          f1 
##   0.8888889</code></pre>
<p>El error que se comete es 4%, pero solo se equivoca en dos setas, así que el modelo predice bastante bien.</p>
</div>
<div id="bosques-aleatorios-2" class="section level3" number="7.2.4">
<h3><span class="header-section-number">7.2.4</span> Bosques Aleatorios</h3>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="actualización-del-modelo.html#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">34735</span>)</span>
<span id="cb243-2"><a href="actualización-del-modelo.html#cb243-2" aria-hidden="true" tabindex="-1"></a>setas.rf.olor<span class="ot">=</span><span class="fu">randomForest</span>(setas_train.olor[,<span class="sc">-</span><span class="dv">1</span>], <span class="fu">as.factor</span>(setas_train.olor<span class="sc">$</span>Letalidad), <span class="at">ntree=</span><span class="dv">100</span>, <span class="at">importance=</span><span class="cn">FALSE</span>, <span class="at">proximity=</span><span class="cn">TRUE</span>, <span class="at">mtry=</span><span class="dv">4</span>, <span class="at">replace=</span><span class="cn">FALSE</span>,<span class="at">method=</span><span class="st">&quot;class&quot;</span>)</span>
<span id="cb243-3"><a href="actualización-del-modelo.html#cb243-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-4"><a href="actualización-del-modelo.html#cb243-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla comparativa</span></span>
<span id="cb243-5"><a href="actualización-del-modelo.html#cb243-5" aria-hidden="true" tabindex="-1"></a>prediccion.rf.olor<span class="ot">=</span><span class="fu">predict</span>(setas.rf.olor, setas_test.olor)</span>
<span id="cb243-6"><a href="actualización-del-modelo.html#cb243-6" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(prediccion.rf.olor,<span class="fu">as.factor</span>(setas_test.olor[,<span class="dv">1</span>]))</span></code></pre></div>
<pre><code>##                   
## prediccion.rf.olor  0  1
##                  0 20  0
##                  1  4 24</code></pre>
<p>La predicción no se equivoca clasificando ninguna setas. Analizamos la precisión de los bosques aleatorios con las medidas de precisión.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="actualización-del-modelo.html#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exactitud/Error</span></span>
<span id="cb245-2"><a href="actualización-del-modelo.html#cb245-2" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">=</span> <span class="fu">sum</span>(prediccion.rf.olor <span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>])<span class="sc">/</span><span class="fu">nrow</span>(setas_test.olor)</span>
<span id="cb245-3"><a href="actualización-del-modelo.html#cb245-3" aria-hidden="true" tabindex="-1"></a>error <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span>accuracy</span>
<span id="cb245-4"><a href="actualización-del-modelo.html#cb245-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-5"><a href="actualización-del-modelo.html#cb245-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Sensibilidad: acierto sobre el total de las setas VENENOSAS</span></span>
<span id="cb245-6"><a href="actualización-del-modelo.html#cb245-6" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="ot">=</span> <span class="fu">sum</span>((prediccion.rf.olor <span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb245-7"><a href="actualización-del-modelo.html#cb245-7" aria-hidden="true" tabindex="-1"></a>recall <span class="ot">=</span> sensitivity</span>
<span id="cb245-8"><a href="actualización-del-modelo.html#cb245-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-9"><a href="actualización-del-modelo.html#cb245-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Especifidad: acierto sobre el total de las setas COMESTIBLES</span></span>
<span id="cb245-10"><a href="actualización-del-modelo.html#cb245-10" aria-hidden="true" tabindex="-1"></a>specificity <span class="ot">=</span>  <span class="fu">sum</span>(prediccion.rf.olor <span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb245-11"><a href="actualización-del-modelo.html#cb245-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-12"><a href="actualización-del-modelo.html#cb245-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Precisión: acierto cuando el predicho es VENENOSAS</span></span>
<span id="cb245-13"><a href="actualización-del-modelo.html#cb245-13" aria-hidden="true" tabindex="-1"></a>precision <span class="ot">=</span> <span class="fu">sum</span>( (prediccion.rf.olor<span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (prediccion.rf.olor <span class="sc">==</span> <span class="dv">1</span>))<span class="sc">/</span> <span class="fu">sum</span>(prediccion.rf.olor <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb245-14"><a href="actualización-del-modelo.html#cb245-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-15"><a href="actualización-del-modelo.html#cb245-15" aria-hidden="true" tabindex="-1"></a><span class="co"># NPV: acierto cuando el predicho es COMESTIBLE</span></span>
<span id="cb245-16"><a href="actualización-del-modelo.html#cb245-16" aria-hidden="true" tabindex="-1"></a>npv <span class="ot">=</span> <span class="fu">sum</span>(prediccion.rf.olor<span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> prediccion.rf.olor <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(prediccion.rf.olor <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb245-17"><a href="actualización-del-modelo.html#cb245-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-18"><a href="actualización-del-modelo.html#cb245-18" aria-hidden="true" tabindex="-1"></a><span class="co"># F1_score</span></span>
<span id="cb245-19"><a href="actualización-del-modelo.html#cb245-19" aria-hidden="true" tabindex="-1"></a>f1score <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>precision<span class="sc">*</span>recall <span class="sc">/</span>(precision<span class="sc">+</span>recall)</span>
<span id="cb245-20"><a href="actualización-del-modelo.html#cb245-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-21"><a href="actualización-del-modelo.html#cb245-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla de medidas de precisión</span></span>
<span id="cb245-22"><a href="actualización-del-modelo.html#cb245-22" aria-hidden="true" tabindex="-1"></a>medidas.bosques.olor<span class="ot">=</span><span class="fu">c</span>(<span class="at">accuracy =</span> accuracy, <span class="at">error =</span> error, <span class="at">sensitivity =</span> sensitivity, <span class="at">specificity =</span> specificity, <span class="at">precision =</span> precision, <span class="at">npv =</span> npv, <span class="at">f1=</span>f1score)</span>
<span id="cb245-23"><a href="actualización-del-modelo.html#cb245-23" aria-hidden="true" tabindex="-1"></a>medidas.bosques.olor</span></code></pre></div>
<pre><code>##    accuracy       error sensitivity specificity   precision         npv 
##  0.91666667  0.08333333  1.00000000  0.83333333  0.85714286  1.00000000 
##          f1 
##  0.92307692</code></pre>
</div>
<div id="support-vector-machines-2" class="section level3" number="7.2.5">
<h3><span class="header-section-number">7.2.5</span> Support Vector Machines</h3>
<p>Para determinar el valor de gamma y el coste, usamos los datos que hemos reservado para validación y realizamos una estimación con ellos.</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="actualización-del-modelo.html#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Para estimar el gamma: </span></span>
<span id="cb247-2"><a href="actualización-del-modelo.html#cb247-2" aria-hidden="true" tabindex="-1"></a>gamma_est<span class="ot">=</span><span class="dv">1</span><span class="sc">/</span><span class="fu">apply</span>(setas_validacion.olor[,<span class="sc">-</span><span class="dv">1</span>],<span class="dv">2</span>,sd)</span>
<span id="cb247-3"><a href="actualización-del-modelo.html#cb247-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Para estimar el coste: </span></span>
<span id="cb247-4"><a href="actualización-del-modelo.html#cb247-4" aria-hidden="true" tabindex="-1"></a>norma2<span class="ot">&lt;-</span><span class="cf">function</span>(x) <span class="fu">sqrt</span>(<span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb247-5"><a href="actualización-del-modelo.html#cb247-5" aria-hidden="true" tabindex="-1"></a>cost_est<span class="ot">=</span><span class="fu">apply</span>(setas_validacion.olor[,<span class="sc">-</span><span class="dv">1</span>],<span class="dv">2</span>,norma2)</span>
<span id="cb247-6"><a href="actualización-del-modelo.html#cb247-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">dim</span>(setas_validacion.olor)[<span class="dv">2</span>]<span class="sc">-</span><span class="dv">1</span>)){</span>
<span id="cb247-7"><a href="actualización-del-modelo.html#cb247-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(gamma_est[i]<span class="sc">==</span><span class="cn">Inf</span>){</span>
<span id="cb247-8"><a href="actualización-del-modelo.html#cb247-8" aria-hidden="true" tabindex="-1"></a>    gamma_est[i]<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb247-9"><a href="actualización-del-modelo.html#cb247-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb247-10"><a href="actualización-del-modelo.html#cb247-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(cost_est[i]<span class="sc">==</span><span class="cn">Inf</span>){</span>
<span id="cb247-11"><a href="actualización-del-modelo.html#cb247-11" aria-hidden="true" tabindex="-1"></a>    cost_est[i]<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb247-12"><a href="actualización-del-modelo.html#cb247-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb247-13"><a href="actualización-del-modelo.html#cb247-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb247-14"><a href="actualización-del-modelo.html#cb247-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-15"><a href="actualización-del-modelo.html#cb247-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Ajustamos el modelo</span></span>
<span id="cb247-16"><a href="actualización-del-modelo.html#cb247-16" aria-hidden="true" tabindex="-1"></a>setas.svm.olor<span class="ot">=</span><span class="fu">svm</span>(setas_train.olor[,<span class="sc">-</span><span class="dv">1</span>],setas_train.olor[,<span class="dv">1</span>],<span class="at">type=</span><span class="st">&quot;C-classification&quot;</span>,<span class="at">kernel=</span><span class="st">&quot;radial&quot;</span>,<span class="at">gamma=</span><span class="fu">mean</span>(gamma_est),<span class="at">cost=</span><span class="fu">mean</span>(cost_est),<span class="at">scale=</span>F)</span>
<span id="cb247-17"><a href="actualización-del-modelo.html#cb247-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-18"><a href="actualización-del-modelo.html#cb247-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla comparativa</span></span>
<span id="cb247-19"><a href="actualización-del-modelo.html#cb247-19" aria-hidden="true" tabindex="-1"></a>prediccion_svm.olor<span class="ot">=</span><span class="fu">predict</span>(setas.svm.olor,setas_test.olor[,<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb247-20"><a href="actualización-del-modelo.html#cb247-20" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(prediccion_svm.olor,setas_test.olor[,<span class="dv">1</span>])</span></code></pre></div>
<pre><code>##                    
## prediccion_svm.olor  0  1
##                   0 24  1
##                   1  0 23</code></pre>
<p>La tabla nos dice que el modelo predice a la perfección los datos pero el modelo está sobre ajustado, pues requiere de 142 vectores soporte cuando el número de observaciones es 144. Las medidas de precisión no van a aportar nada que no sepamos con mirar simplemente la tabla.</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="actualización-del-modelo.html#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Medidas de precisión</span></span>
<span id="cb249-2"><a href="actualización-del-modelo.html#cb249-2" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">=</span> <span class="fu">sum</span>(prediccion_svm.olor <span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>])<span class="sc">/</span><span class="fu">nrow</span>(setas_test.olor)</span>
<span id="cb249-3"><a href="actualización-del-modelo.html#cb249-3" aria-hidden="true" tabindex="-1"></a>error <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span>accuracy</span>
<span id="cb249-4"><a href="actualización-del-modelo.html#cb249-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-5"><a href="actualización-del-modelo.html#cb249-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas VENENOSAS, sensitivity o recall</span></span>
<span id="cb249-6"><a href="actualización-del-modelo.html#cb249-6" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="ot">=</span> <span class="fu">sum</span>((prediccion_svm.olor <span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb249-7"><a href="actualización-del-modelo.html#cb249-7" aria-hidden="true" tabindex="-1"></a>recall <span class="ot">=</span> sensitivity</span>
<span id="cb249-8"><a href="actualización-del-modelo.html#cb249-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-9"><a href="actualización-del-modelo.html#cb249-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas COMESTIBLES</span></span>
<span id="cb249-10"><a href="actualización-del-modelo.html#cb249-10" aria-hidden="true" tabindex="-1"></a>specificity <span class="ot">=</span>  <span class="fu">sum</span>(prediccion_svm.olor <span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb249-11"><a href="actualización-del-modelo.html#cb249-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-12"><a href="actualización-del-modelo.html#cb249-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es VENENOSAS</span></span>
<span id="cb249-13"><a href="actualización-del-modelo.html#cb249-13" aria-hidden="true" tabindex="-1"></a>precision <span class="ot">=</span> <span class="fu">sum</span>((prediccion_svm.olor<span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (prediccion_svm.olor <span class="sc">==</span> <span class="dv">1</span>))<span class="sc">/</span> <span class="fu">sum</span>(prediccion_svm.olor <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb249-14"><a href="actualización-del-modelo.html#cb249-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-15"><a href="actualización-del-modelo.html#cb249-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es COMESTIBLE</span></span>
<span id="cb249-16"><a href="actualización-del-modelo.html#cb249-16" aria-hidden="true" tabindex="-1"></a>npv <span class="ot">=</span> <span class="fu">sum</span>(prediccion_svm.olor<span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> prediccion_svm.olor <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(prediccion_svm.olor <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb249-17"><a href="actualización-del-modelo.html#cb249-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-18"><a href="actualización-del-modelo.html#cb249-18" aria-hidden="true" tabindex="-1"></a><span class="co"># F1_score</span></span>
<span id="cb249-19"><a href="actualización-del-modelo.html#cb249-19" aria-hidden="true" tabindex="-1"></a>f1score <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>precision<span class="sc">*</span>recall <span class="sc">/</span>(precision<span class="sc">+</span>recall)</span>
<span id="cb249-20"><a href="actualización-del-modelo.html#cb249-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-21"><a href="actualización-del-modelo.html#cb249-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla de medidas de precisión</span></span>
<span id="cb249-22"><a href="actualización-del-modelo.html#cb249-22" aria-hidden="true" tabindex="-1"></a>medidas.svmradial.olor<span class="ot">=</span><span class="fu">c</span>(<span class="at">accuracy =</span> accuracy, <span class="at">error =</span> error, <span class="at">sensitivity =</span> sensitivity, <span class="at">specificity =</span> specificity, <span class="at">precision =</span> precision, <span class="at">npv =</span> npv, <span class="at">f1=</span>f1score)</span>
<span id="cb249-23"><a href="actualización-del-modelo.html#cb249-23" aria-hidden="true" tabindex="-1"></a>medidas.svmradial.olor</span></code></pre></div>
<pre><code>##    accuracy       error sensitivity specificity   precision         npv 
##  0.97916667  0.02083333  0.95833333  1.00000000  1.00000000  0.96000000 
##          f1 
##  0.97872340</code></pre>
<p>Si realizamos el ajuste de SVM pero establecemos que el kernel es lineal, obtenemos lo siguiente:</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="actualización-del-modelo.html#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Para estimar el coste: </span></span>
<span id="cb251-2"><a href="actualización-del-modelo.html#cb251-2" aria-hidden="true" tabindex="-1"></a>norma2<span class="ot">&lt;-</span><span class="cf">function</span>(x) <span class="fu">sqrt</span>(<span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb251-3"><a href="actualización-del-modelo.html#cb251-3" aria-hidden="true" tabindex="-1"></a>cost_est<span class="ot">=</span><span class="fu">apply</span>(setas_validacion.olor[,<span class="sc">-</span><span class="dv">1</span>],<span class="dv">2</span>,norma2)</span>
<span id="cb251-4"><a href="actualización-del-modelo.html#cb251-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-5"><a href="actualización-del-modelo.html#cb251-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Ajustamos el modelo</span></span>
<span id="cb251-6"><a href="actualización-del-modelo.html#cb251-6" aria-hidden="true" tabindex="-1"></a>setas.svm.lineal.olor<span class="ot">=</span><span class="fu">svm</span>(setas_train.olor[,<span class="sc">-</span><span class="dv">1</span>],setas_train.olor[,<span class="dv">1</span>],<span class="at">type=</span><span class="st">&quot;C-classification&quot;</span>,<span class="at">kernel=</span><span class="st">&quot;linear&quot;</span>,<span class="at">cost=</span><span class="fu">mean</span>(cost_est),<span class="at">scale=</span>F)</span>
<span id="cb251-7"><a href="actualización-del-modelo.html#cb251-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-8"><a href="actualización-del-modelo.html#cb251-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla comparativa</span></span>
<span id="cb251-9"><a href="actualización-del-modelo.html#cb251-9" aria-hidden="true" tabindex="-1"></a>prediccion_svm.lineal.olor<span class="ot">=</span><span class="fu">predict</span>(setas.svm.lineal.olor,setas_test.olor[,<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb251-10"><a href="actualización-del-modelo.html#cb251-10" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(prediccion_svm.lineal.olor,setas_test.olor[,<span class="dv">1</span>])</span></code></pre></div>
<pre><code>##                           
## prediccion_svm.lineal.olor  0  1
##                          0 22  0
##                          1  2 24</code></pre>
<p>Podemos ver que respecto al kernel radial, las predicciones son las mismas pero necesita de menos vectores soportes para ajustar el modelo.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="actualización-del-modelo.html#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Medidas de precisión</span></span>
<span id="cb253-2"><a href="actualización-del-modelo.html#cb253-2" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">=</span> <span class="fu">sum</span>(prediccion_svm.lineal.olor <span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>])<span class="sc">/</span><span class="fu">nrow</span>(setas_test.olor)</span>
<span id="cb253-3"><a href="actualización-del-modelo.html#cb253-3" aria-hidden="true" tabindex="-1"></a>error <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span>accuracy</span>
<span id="cb253-4"><a href="actualización-del-modelo.html#cb253-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-5"><a href="actualización-del-modelo.html#cb253-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas VENENOSAS, sensitivity o recall</span></span>
<span id="cb253-6"><a href="actualización-del-modelo.html#cb253-6" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="ot">=</span> <span class="fu">sum</span>((prediccion_svm.lineal.olor <span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb253-7"><a href="actualización-del-modelo.html#cb253-7" aria-hidden="true" tabindex="-1"></a>recall <span class="ot">=</span> sensitivity</span>
<span id="cb253-8"><a href="actualización-del-modelo.html#cb253-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-9"><a href="actualización-del-modelo.html#cb253-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto sobre el total de las setas COMESTIBLES</span></span>
<span id="cb253-10"><a href="actualización-del-modelo.html#cb253-10" aria-hidden="true" tabindex="-1"></a>specificity <span class="ot">=</span>  <span class="fu">sum</span>(prediccion_svm.lineal.olor <span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(setas_test.olor[,<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb253-11"><a href="actualización-del-modelo.html#cb253-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-12"><a href="actualización-del-modelo.html#cb253-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es VENENOSAS</span></span>
<span id="cb253-13"><a href="actualización-del-modelo.html#cb253-13" aria-hidden="true" tabindex="-1"></a>precision <span class="ot">=</span> <span class="fu">sum</span>((prediccion_svm.lineal.olor<span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (prediccion_svm.lineal.olor <span class="sc">==</span> <span class="dv">1</span>))<span class="sc">/</span> <span class="fu">sum</span>(prediccion_svm.lineal.olor <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb253-14"><a href="actualización-del-modelo.html#cb253-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-15"><a href="actualización-del-modelo.html#cb253-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Acierto cuando el predicho es COMESTIBLE</span></span>
<span id="cb253-16"><a href="actualización-del-modelo.html#cb253-16" aria-hidden="true" tabindex="-1"></a>npv <span class="ot">=</span> <span class="fu">sum</span>(prediccion_svm.lineal.olor<span class="sc">==</span> setas_test.olor[,<span class="dv">1</span>] <span class="sc">&amp;</span> prediccion_svm.lineal.olor <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sum</span>(prediccion_svm.lineal.olor <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb253-17"><a href="actualización-del-modelo.html#cb253-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-18"><a href="actualización-del-modelo.html#cb253-18" aria-hidden="true" tabindex="-1"></a><span class="co"># F1_score</span></span>
<span id="cb253-19"><a href="actualización-del-modelo.html#cb253-19" aria-hidden="true" tabindex="-1"></a>f1score <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>precision<span class="sc">*</span>recall <span class="sc">/</span>(precision<span class="sc">+</span>recall)</span>
<span id="cb253-20"><a href="actualización-del-modelo.html#cb253-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-21"><a href="actualización-del-modelo.html#cb253-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla de medidas de precisión</span></span>
<span id="cb253-22"><a href="actualización-del-modelo.html#cb253-22" aria-hidden="true" tabindex="-1"></a>medidas.svmlineal.olor<span class="ot">=</span><span class="fu">c</span>(<span class="at">accuracy =</span> accuracy, <span class="at">error =</span> error, <span class="at">sensitivity =</span> sensitivity, <span class="at">specificity =</span> specificity, <span class="at">precision =</span> precision, <span class="at">npv =</span> npv, <span class="at">f1=</span>f1score)</span>
<span id="cb253-23"><a href="actualización-del-modelo.html#cb253-23" aria-hidden="true" tabindex="-1"></a>medidas.svmlineal.olor</span></code></pre></div>
<pre><code>##    accuracy       error sensitivity specificity   precision         npv 
##  0.95833333  0.04166667  1.00000000  0.91666667  0.92307692  1.00000000 
##          f1 
##  0.96000000</code></pre>
<p>Por tanto descartaría usar un SVM con kernel lineal.</p>
</div>
<div id="evaluación-2" class="section level3" number="7.2.6">
<h3><span class="header-section-number">7.2.6</span> Evaluación</h3>
<p>Por lo tanto si comparamos todos los modelos que hemos aplicado usando las medidas de precisión vemos lo siguiente</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="actualización-del-modelo.html#cb255-1" aria-hidden="true" tabindex="-1"></a>medidas.precision.olor<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">c</span>(medidas.knn.olor,medidas.arboles.olor,medidas.bosques.olor,medidas.svmradial.olor,medidas.svmlineal.olor),<span class="at">nrow=</span><span class="dv">5</span>,<span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb255-2"><a href="actualización-del-modelo.html#cb255-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(medidas.precision.olor)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;accuracy&quot;</span>, <span class="st">&quot;error&quot;</span>, <span class="st">&quot;sensitivity&quot;</span>, <span class="st">&quot;specificity&quot;</span>, <span class="st">&quot;precision&quot;</span>, <span class="st">&quot;npv&quot;</span>, <span class="st">&quot;f1score&quot;</span>)</span>
<span id="cb255-3"><a href="actualización-del-modelo.html#cb255-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(medidas.precision.olor)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;k-NN&quot;</span>,<span class="st">&quot;Arboles de decision&quot;</span>,<span class="st">&quot;Bosques aleatorios&quot;</span>,<span class="st">&quot;SVM radial&quot;</span>,<span class="st">&quot;SVM lineal&quot;</span>)</span>
<span id="cb255-4"><a href="actualización-del-modelo.html#cb255-4" aria-hidden="true" tabindex="-1"></a>medidas.precision.olor</span></code></pre></div>
<pre><code>##                      accuracy      error sensitivity specificity precision  npv
## k-NN                0.9583333 0.04166667   1.0000000   0.9166667 0.9230769 1.00
## Arboles de decision 0.8750000 0.12500000   1.0000000   0.7500000 0.8000000 1.00
## Bosques aleatorios  0.9166667 0.08333333   1.0000000   0.8333333 0.8571429 1.00
## SVM radial          0.9791667 0.02083333   0.9583333   1.0000000 1.0000000 0.96
## SVM lineal          0.9583333 0.04166667   1.0000000   0.9166667 0.9230769 1.00
##                       f1score
## k-NN                0.9600000
## Arboles de decision 0.8888889
## Bosques aleatorios  0.9230769
## SVM radial          0.9787234
## SVM lineal          0.9600000</code></pre>
<p>El mejor modelo para aplicar a nuestros datos es puede ser el k-NN con el vecino más próximo, los bosques aleatorio o el SVM con el kernel lineal, pues predice a la perfección los datos tanto los de entrenamiento como los de test. La conclusión a la que hemos llegado tras finalizar el análisis de los datos difiere un poco del resto de conclusiones.</p>
</div>
</div>
<div id="evaluación-de-los-tres-análisis" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> Evaluación de los tres análisis</h2>
<p>Por lo tanto si comparamos todos los modelos de los tres análsis que hemos aplicado usando las medidas de precisión vemos lo siguiente</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="actualización-del-modelo.html#cb257-1" aria-hidden="true" tabindex="-1"></a>medidas.precision.todas<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">c</span>(medidas.knn,medidas.arboles,medidas.bosques,medidas.svmradial,medidas.svmlineal,medidas.knn.sin.olor,medidas.arboles.sin.olor,medidas.bosques.sin.olor,medidas.svmradial.sin.olor,medidas.svmlineal.sin.olor,medidas.knn.olor,medidas.arboles.olor,medidas.bosques.olor,medidas.svmradial.olor,medidas.svmlineal.olor),<span class="at">nrow=</span><span class="dv">15</span>,<span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb257-2"><a href="actualización-del-modelo.html#cb257-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(medidas.precision.todas)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;accuracy&quot;</span>, <span class="st">&quot;error&quot;</span>, <span class="st">&quot;sensitivity&quot;</span>, <span class="st">&quot;specificity&quot;</span>, <span class="st">&quot;precision&quot;</span>, <span class="st">&quot;npv&quot;</span>, <span class="st">&quot;f1score&quot;</span>)</span>
<span id="cb257-3"><a href="actualización-del-modelo.html#cb257-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(medidas.precision.todas)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;k-NN&quot;</span>,<span class="st">&quot;Arboles de decision&quot;</span>,<span class="st">&quot;Bosques aleatorios&quot;</span>,<span class="st">&quot;SVM radial&quot;</span>,<span class="st">&quot;SVM lineal&quot;</span>,<span class="st">&quot;k-NN.sin.olor&quot;</span>,<span class="st">&quot;Arboles de decision.sin.olor&quot;</span>,<span class="st">&quot;Bosques aleatorios.sin.olor&quot;</span>,<span class="st">&quot;SVM radial.sin.olor&quot;</span>,<span class="st">&quot;SVM lineal.sin.olor&quot;</span>,<span class="st">&quot;k-NN.olor&quot;</span>,<span class="st">&quot;Arboles de decision.olor&quot;</span>,<span class="st">&quot;Bosques aleatorios.olor&quot;</span>,<span class="st">&quot;SVM radial.olor&quot;</span>,<span class="st">&quot;SVM lineal.olor&quot;</span>)</span>
<span id="cb257-4"><a href="actualización-del-modelo.html#cb257-4" aria-hidden="true" tabindex="-1"></a>medidas.precision.todas</span></code></pre></div>
<pre><code>##                               accuracy       error sensitivity specificity
## k-NN                         0.9981527 0.001847291   0.9987277   0.9976134
## Arboles de decision          0.9378079 0.062192118   0.9503817   0.9260143
## Bosques aleatorios           0.9987685 0.001231527   1.0000000   0.9976134
## SVM radial                   1.0000000 0.000000000   1.0000000   1.0000000
## SVM lineal                   0.9575123 0.042487685   0.9452926   0.9689737
## k-NN.sin.olor                0.9987685 0.001231527   0.9974555   1.0000000
## Arboles de decision.sin.olor 0.9421182 0.057881773   0.9325700   0.9510740
## Bosques aleatorios.sin.olor  0.9944581 0.005541872   0.9974555   0.9916468
## SVM radial.sin.olor          1.0000000 0.000000000   1.0000000   1.0000000
## SVM lineal.sin.olor          0.9605911 0.039408867   0.9529262   0.9677804
## k-NN.olor                    0.9583333 0.041666667   1.0000000   0.9166667
## Arboles de decision.olor     0.8750000 0.125000000   1.0000000   0.7500000
## Bosques aleatorios.olor      0.9166667 0.083333333   1.0000000   0.8333333
## SVM radial.olor              0.9791667 0.020833333   0.9583333   1.0000000
## SVM lineal.olor              0.9583333 0.041666667   1.0000000   0.9166667
##                              precision       npv   f1score
## k-NN                         0.9974587 0.9988053 0.9980928
## Arboles de decision          0.9233622 0.9521472 0.9366771
## Bosques aleatorios           0.9974619 1.0000000 0.9987294
## SVM radial                   1.0000000 1.0000000 1.0000000
## SVM lineal                   0.9661899 0.9497076 0.9556270
## k-NN.sin.olor                1.0000000 0.9976190 0.9987261
## Arboles de decision.sin.olor 0.9470284 0.9376471 0.9397436
## Bosques aleatorios.sin.olor  0.9911504 0.9975990 0.9942930
## SVM radial.sin.olor          1.0000000 1.0000000 1.0000000
## SVM lineal.sin.olor          0.9652062 0.9563679 0.9590269
## k-NN.olor                    0.9230769 1.0000000 0.9600000
## Arboles de decision.olor     0.8000000 1.0000000 0.8888889
## Bosques aleatorios.olor      0.8571429 1.0000000 0.9230769
## SVM radial.olor              1.0000000 0.9600000 0.9787234
## SVM lineal.olor              0.9230769 1.0000000 0.9600000</code></pre>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="evaluación.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": false,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
