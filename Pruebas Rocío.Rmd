---
title: "MINERIA DE DATOS"
author: "Rocío Fernández Cebrián"
date: "29/9/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```




ANALISIS CLUSTER
```{r cluster} 
clusters2.datos=kmeans(nuevos.datos.pca,centers=2,nstart=25)
#Números de clusters
SSW <- vector(mode = "numeric", length = 15)
n=dim(nuevos.datos.pca)[1]
#Variabilidad de todos los datos, es decir, todos los datos como un único cluster
SSW[1] <- (n - 1) * sum(apply(setas,2,var)) 

#Variabilidad de cada modelo, desde 2 clusters hasta 15 clusters
for (i in 2:15) SSW[i] <- sum(kmeans(setas,centers=i,nstart=25)$withinss)

#Dibujamos un gráfico con el resultado
plot(1:15, SSW, type="b", xlab="Number of Clusters", ylab="Sum of squares within groups",pch=19, col="steelblue4")


#Cluster con 5 centroides:
clusters8.datos=kmeans(setas,centers=8,nstart=25)
centroides=aggregate(setas,by=list(clusters8.datos$cluster),FUN=mean) 

pairs(setas,col= clusters8.datos$cluster,pch=19)
points(clusters8.datos$centers, col = 1:nk, pch = 19, cex=2)


library(cluster)
clusplot(setas, clusters8.datos$cluster, color=TRUE, shade=TRUE, labels=2,lines=0)
```

CALCULO DE DISTANCIAS
```{r funcion distancia dice}
library(vegan)
designdist(setas_train[1:10,2:117],"(2*a)/(2*a+b+c)",terms="binary",abcd=TRUE)

#Matriz de distancia:
library(philentropy)
distancia_dice=distance(setas[,2:117],method="dice")
```
```{r medoides,echo=TRUE}
#Cálculo de los medoides:
k50=fastkmed(distancia_dice,ncluster=18)
distanciaTrainMedoides=distancia_dice[,k50$medoid]
distancia_medoides=distancia_dice[k50$medoid,k50$medoid]
#Proporción de los medoides:
table(setas_train$Venenosas[k50$medoid])
```
Podemos ver que de los 50 medoides que hemos calculado, necesitamos 19 para explicar las setas no venenosas mientras que solo 11 para las venenosas. La proporción se mantiene cogiendo un número distinto de medoides, siendo entre un 70%-80% de los medoides setas no venenosas.

Con estos medoides podemos realizar un análisis de componente principales.
```{r pca,echo=TRUE}
#Análisis Componentes principales:
pca.train=prcomp(distanciaTrainMedoides)
plot(pca.train)
plot(pca.train$x,col=setas_train$Venenosas[k50$medoid]+1,pch=19)
pca.50=prcomp(distancia_medoides)
plot(pca.50)
plot(pca.50$x,col=setas_train$Venenosas[k50$medoid]+1,pch=19)
comestible=which(setas_train[,1]==0)
no.comestibles=which(setas_train[,1]==1)
par(mfrow=c(1,2))
plot(pca.train$x)
points(pca.train$x[comestible,1:2],col="black",pch=19)
points(pca.train$x[no.comestibles,1:2],col="red",pch=19)
plot(pca.train$x)
points(pca.train$x[no.comestibles,1:2],col="red",pch=19)
points(pca.train$x[comestible,1:2],col="black",pch=19)
```


